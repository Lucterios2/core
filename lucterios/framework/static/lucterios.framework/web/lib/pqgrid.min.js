/**
 * ParamQuery Pro v2.2.0
 * 
 * Copyright (c) 2012-2017 Paramvir Dhindsa (http://paramquery.com)
 * Released under GPL v3 license
 * http://paramquery.com/license
 * 
 */     	
(function(h){var b=h.paramquery=h.paramquery||{};h.paramquery.pqgrid=h.paramquery.pqgrid||{};b.xmlToArray=function(b,k){var n=k.itemParent,e=k.itemNames,g=[];h(b).find(n).each(function(b,k){var a=h(k),c=[];h(e).each(function(d,f){c.push(a.find(f).text().replace(/\r|\n|\t/g,""))});g.push(c)});return g};b.xmlToJson=function(b,k){var n=k.itemParent,e=k.itemNames,g=[];h(b).find(n).each(function(b,k){for(var a=h(k),c={},d=0,f=e.length;d<f;d++){var p=e[d];c[p]=a.find(p).text().replace(/\r|\n|\t/g,"")}g.push(c)});
return g};b.tableToArray=function(b){b=h(b);var k=[],n=[],e=b.find("tr:first"),g=b.find("tr:eq(1)");e.find("th,td").each(function(e,b){var a=h(b),c=a.html(),a=a.width(),d=g.find("td:eq("+e+")").attr("align");k.push({title:c,width:a,dataType:"string",align:d,dataIndx:e})});b.find("tr").each(function(e,g){if(0!=e){var a=[];h(g).find("td").each(function(c,d){a.push(h.trim(h(d).html()))});n.push(a)}});return{data:n,colModel:k}};b.formatCurrency=function(b){if(isNaN(b))return b;b=Math.round(10*b)/10;b+=
"";-1==b.indexOf(".")&&(b+=".0");var k=b.length,h=b.substring(0,k-2);b=b.substring(k-2,k);for(var h=h.match(/\d/g).reverse(),k=[],e=0;e<h.length;e++)0<e&&0==e%3&&k.push(","),k.push(h[e]);k=k.reverse();h=k.join("");return h+b};b.validation={is:function(b,k){if("string"==b||!b)return!0;b=b.substring(0,1).toUpperCase()+b.substring(1,b.length);return this["is"+b](k)},isFloat:function(b){var k=parseFloat(b);return isNaN(k)||k!=b?!1:!0},isInteger:function(b){var k=parseInt(b);return isNaN(k)||k!=b?!1:!0},
isDate:function(b){b=Date.parse(b);return isNaN(b)?!1:!0}}})(jQuery);
(function(h){var b={options:{curPage:0,totalPages:0,totalRecords:0,msg:"",rPPOptions:[10,20,30,40,50,100],rPP:20},_regional:{strDisplay:"Displaying {0} to {1} of {2} items.",strFirstPage:"First Page",strLastPage:"Last Page",strNextPage:"Next Page",strPage:"Page {0} of {1}",strPrevPage:"Previous Page",strRefresh:"Refresh",strRpp:"Records per page:{0}"}};h.extend(b.options,b._regional);b._create=function(){var b=this,k=this.options;this.element.addClass("pq-pager");this.first=h("<button type='button' title='"+
k.strFirstPage+"'></button>",{}).appendTo(this.element).button({icons:{primary:"ui-icon-seek-first"},text:!1}).bind("click.paramquery",function(k){1<b.options.curPage&&!1!==b._trigger("change",k,{curPage:1})&&b.option({curPage:1})});this.prev=h("<button type='button' title='"+k.strPrevPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-prev"},text:!1}).bind("click",function(k){if(1<b.options.curPage){var e=b.options.curPage-1;!1!==b._trigger("change",k,{curPage:e})&&b.option({curPage:e})}});
h("<span class='pq-separator'></span>").appendTo(this.element);this.pageHolder=h("<span class='pq-page-placeholder'></span>").appendTo(this.element);h("<span class='pq-separator'></span>").appendTo(this.element);this.next=h("<button type='button' title='"+this.options.strNextPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-next"},text:!1}).bind("click",function(k){var e=b.options.curPage+1;!1!==b._trigger("change",k,{curPage:e})&&b.option({curPage:e})});this.last=h("<button type='button' title='"+
this.options.strLastPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-end"},text:!1}).bind("click",function(k){var e=b.options.totalPages;!1!==b._trigger("change",k,{curPage:e})&&b.option({curPage:e})});h("<span class='pq-separator'></span>").appendTo(this.element);this.rPPHolder=h("<span class='pq-page-placeholder'></span>").appendTo(this.element);this.$refresh=h("<button type='button' title='"+this.options.strRefresh+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-refresh"},
text:!1}).bind("click",function(k){b._trigger("refresh",k)});h("<span class='pq-separator'></span>").appendTo(this.element);this.$msg=h("<span class='pq-pager-msg'></span>").appendTo(this.element);this._refresh()};b._refreshPage=function(){var b=this;this.pageHolder.empty();for(var k=this.options,n=k.strPage.split(" "),e=[],g=0,l=n.length;g<l;g++){var m=n[g];"{0}"==m?e.push("<input type='text' tabindex='0' class='ui-corner-all' />"):"{1}"==m?e.push("<span class='total'></span>"):e.push("<span>",m,
"</span>")}n=e.join("");n=h(n).appendTo(this.pageHolder);this.page=n.filter("input").bind("change",function(a){var c=h(this),d=c.val();if(isNaN(d)||1>d)return c.val(k.curPage),!1;d=parseInt(d);if(d>k.totalPages||!1===b._trigger("change",a,{curPage:d}))return c.val(k.curPage),!1;b.option({curPage:d})});this.$total=n.filter("span.total")};b._refresh=function(){this._refreshPage();var b=this,k=this.options;this.first.attr("title",k.strFirstPage);this.prev.attr("title",k.strPrevPage);this.next.attr("title",
k.strNextPage);this.last.attr("title",k.strLastPage);this.$refresh.attr("title",k.strRefresh);this.rPPHolder.empty();if(k.strRpp){var n=k.rPPOptions,e=k.strRpp;if(-1!=e.indexOf("{0}")){for(var g=["<select class='ui-corner-all'>"],l=0,m=n.length;l<m;l++){var a=n[l];g.push('<option value="',a,'">',a,"</option>")}g.push("</select>");n=g.join("");e=e.replace("{0}","</span>"+n);e="<span>"+e+"<span class='pq-separator'></span>"}else e="<span>"+e+"</span><span class='pq-separator'></span>";this.$rPP=h(e).appendTo(this.rPPHolder).filter("select").val(k.rPP).change(function(c){var a=
h(this).val();if(!1!==b._trigger("change",c,{rPP:a}))return b.options.rPP=a,!1})}k.curPage>=k.totalPages?(this.next.button({disabled:!0}),this.last.button({disabled:!0})):(this.next.button({disabled:!1}),this.last.button({disabled:!1}));1>=k.curPage?(this.first.button({disabled:!0}),this.prev.button({disabled:!0})):(this.first.button({disabled:!1}),this.prev.button({disabled:!1}));this.page.val(k.curPage);this.$total.text(k.totalPages);0<this.options.totalRecords?(e=k.rPP,n=k.curPage,g=k.totalRecords,
l=n*e,l>g&&(l=g),k=k.strDisplay,k=k.replace("{0}",(n-1)*e+1),k=k.replace("{1}",l),k=k.replace("{2}",g),this.$msg.html(k)):this.$msg.html("")};b._destroy=function(){this.element.empty().removeClass("pq-pager").enableSelection()};b._setOption=function(b,k){if("curPage"==b||"totalPages"==b)k=parseInt(k);this._super.call(this,b,k)};b._setOptions=function(){this._super.apply(this,arguments);this._refresh()};h.widget("paramquery.pqPager",b);h.paramquery.pqPager.regional={};h.paramquery.pqPager.regional.en=
b._regional})(jQuery);
(function(h){h.widget("paramquery.pqScrollBar",{options:{length:200,num_eles:3,cur_pos:0,ratio:0,timeout:350,pace:"optimum",direction:"vertical",theme:!1},_destroy:function(){this.element.removeClass("pq-sb-vert pq-sb-vert-t pq-sb-vert-wt").enableSelection().removeClass("pq-sb-horiz pq-sb-horiz-t pq-sb-horiz-wt").unbind("click.pq-scrollbar").empty();this.element.removeData()},_create:function(){this._createLayout()},_createLayout:function(){var b=this,r=this.options,k=r.direction,n=r.theme,e=this.element.empty();
"vertical"==k?(e.removeClass("pq-sb-vert-t pq-sb-vert-wt").addClass("pq-sb-vert"),n?(e.addClass("pq-sb-vert-t"),e.html("<div class='top-btn pq-sb-btn ui-state-default ui-corner-top'><div class='ui-icon ui-icon-triangle-1-n'></div></div><div class='pq-sb-slider ui-corner-all ui-state-default'></div><div class='bottom-btn pq-sb-btn ui-state-default ui-corner-bottom'><div class='ui-icon ui-icon-triangle-1-s'></div></div>")):(e.addClass("pq-sb-vert-wt"),e.html("<div class='top-btn pq-sb-btn'></div><div class='pq-sb-slider'><div class='vert-slider-top'></div><div class='vert-slider-bg'></div><div class='vert-slider-center'></div><div class='vert-slider-bg'></div><div class='vert-slider-bottom'></div></div><div class='bottom-btn pq-sb-btn'></div>"))):
(e.removeClass("pq-sb-horiz-t pq-sb-horiz-wt").addClass("pq-sb-horiz"),n?(e.addClass("pq-sb-horiz-t"),e.html("<div class='left-btn pq-sb-btn ui-state-default ui-corner-left'><div class='ui-icon ui-icon-triangle-1-w'></div></div><div class='pq-sb-slider pq-sb-slider-h ui-state-default ui-corner-all'></div><div class='right-btn pq-sb-btn ui-state-default ui-corner-right'><div class='ui-icon ui-icon-triangle-1-e'></div></div>")):(e.addClass("pq-sb-horiz-wt"),e.width(this.width),e.html("<div class='left-btn pq-sb-btn'></div><div class='pq-sb-slider pq-sb-slider-h'><span class='horiz-slider-left'></span><span class='horiz-slider-bg'></span><span class='horiz-slider-center'></span><span class='horiz-slider-bg'></span><span class='horiz-slider-right'></span></div><div class='right-btn pq-sb-btn'></div>")));
e.disableSelection().unbind(".pq-scrollbar").on("mouseup.pq-scrollbar",function(e){b._mouseup(e)}).on("mousedown.pq-scrollbar",function(e){if(!r.disabled&&!b.$slider.is(":hidden"))if("vertical"==k){var l=e.pageY,h=b.element.offset().top,a=h+r.length,c=b.$slider,d=c.offset().top,f=c.height(),p=d+f;l<d&&l>h+17?b.mousedownInterval=window.setInterval(function(){l>=c.offset().top?(window.clearInterval(b.mousedownInterval),b.mousedownInterval=null):b._pageUp(e)},0):l>p&&l<a-17&&(b.mousedownInterval=window.setInterval(function(){l<=
c.offset().top+f?(window.clearInterval(b.mousedownInterval),b.mousedownInterval=null):b._pageDown(e)},0))}else{var s=e.pageX,h=b.element.offset().left,a=h+r.length,d=b.$slider.offset().left,p=d+b.$slider.width();s<d&&s>h+17?(b.$slider.css("left",s-b.element.offset().left),b._updateCurPosAndTrigger(e)):s>p&&s<a-17&&(b.$slider.css("left",s-b.element.offset().left-b.$slider.width()),b._updateCurPosAndTrigger(e))}});e=this.$slider=h("div.pq-sb-slider",this.element);n&&e.attr("tabindex","0");this._bindSliderEvents(e);
this.$top_btn=h("div.top-btn,div.left-btn",this.element).click(function(e){if(!b.options.disabled)return b.decr_cur_pos(e),e.preventDefault(),!1}).mousedown(function(e){b.options.disabled||(b.mousedownTimeout=window.setTimeout(function(){b.mousedownInterval=window.setInterval(function(){b.decr_cur_pos(e)},0)},b.options.timeout))}).bind("mouseup mouseout",function(e){b._mouseup(e)});this.$bottom_btn=h("div.bottom-btn,div.right-btn",this.element).click(function(e){if(!b.options.disabled)return b.incr_cur_pos(e),
e.preventDefault(),!1}).mousedown(function(e){b.options.disabled||(b.mousedownTimeout=window.setTimeout(function(){b.mousedownInterval=window.setInterval(function(){b.incr_cur_pos(e)},0)},b.options.timeout))}).bind("mouseup mouseout",function(e){b._mouseup(e)});this._refresh()},_bindSliderEvents:function(b){var r=this,k="x";"vertical"==this.options.direction&&(k="y");b.draggable({axis:k,helper:function(b,e){r._setDragLimits();return this},start:function(b){r.topWhileDrag=null},drag:function(b){r.dragging=
!0;var e=r.options.pace;"optimum"==e?r._setNormalPace(b):"fast"==e&&r._updateCurPosAndTrigger(b)},stop:function(b){r._updateCurPosAndTrigger(b);r.dragging=!1}}).on("keydown.pq-scrollbar",function(b){var e=b.keyCode,g=r.options,k=g.cur_pos,m=g.ratio,a=g.num_eles,c=h.ui.keyCode;null==r.keydownTimeout&&(r.keydownTimeout=window.setTimeout(function(){e==c.DOWN||e==c.RIGHT?r.incr_cur_pos(b):e==c.UP||e==c.LEFT?r.decr_cur_pos(b):e==c.HOME?g.steps?0<k&&(g.cur_pos=0,r.updateSliderPos(),r.scroll(b)):0<m&&(g.ratio=
0,r.updateSliderPos(),r.drag(b)):e==c.END?g.steps?k<a&&(g.cur_pos=a,r.updateSliderPos(),r.scroll(b)):1>m&&(g.ratio=1,r.updateSliderPos(),r.drag(b)):"vertical"==g.direction&&(e==c.PAGE_DOWN?r._pageDown(b):e==c.PAGE_UP&&r._pageUp(b));r.keydownTimeout=null},0));if(e==c.DOWN||e==c.RIGHT||e==c.UP||e==c.LEFT||e==c.PAGE_DOWN||e==c.PAGE_UP||e==c.HOME||e==c.END)return b.preventDefault(),!1})},decr_cur_pos:function(b){var h=this.options;if(h.steps)0<h.cur_pos&&(h.cur_pos--,this.updateSliderPos(),this.scroll(b));
else if(0<h.ratio){var k=h.ratio-1/(h.num_eles-1);0>k&&(k=0);h.ratio=k;this.updateSliderPos();this.drag(b)}},incr_cur_pos:function(b){var h=this.options;if(h.steps)h.cur_pos<h.num_eles-1&&h.cur_pos++,this.updateSliderPos(),this.scroll(b);else{if(1>h.ratio){var k=h.ratio+1/(h.num_eles-1);1<k&&(k=1);h.ratio=k}this.updateSliderPos();this.drag(b)}},_mouseup:function(b){this.options.disabled||(window.clearTimeout(this.mousedownTimeout),this.mousedownTimeout=null,window.clearInterval(this.mousedownInterval),
this.mousedownInterval=null)},_setDragLimits:function(){var b=this.options;if("vertical"==b.direction){var h=this.element.offset().top+17,b=h+b.length-34-this.slider_length;this.$slider.draggable("option","containment",[0,h,0,b])}else h=this.element.offset().left+17,b=h+b.length-34-this.slider_length,this.$slider.draggable("option","containment",[h,0,b,0])},_refresh:function(){var b=this.options;1>=b.num_eles?this.element.css("display","none"):this.element.css("display","");this._validateCurPos();
this.$slider.css("display","");"vertical"==b.direction?this.element.height(b.length):this.element.width(b.length);this._setSliderBgLength();this.scroll_space=b.length-34-this.slider_length;(4>this.scroll_space||1>=b.num_eles)&&this.$slider.css("display","none");this.updateSliderPos(b.cur_pos)},_setSliderBgLength:function(){var b=this.options,r=b.theme,k=b.length,k=Math.round(((k-34)*k/(40*b.num_eles+k)-14)/2);1>k&&(k=1);this.slider_length=14+2*k;"vertical"==b.direction?r?this.$slider.height(this.slider_length-
2):(h("div.vert-slider-bg",this.element).height(k),this.$slider.height(this.slider_length)):r?this.$slider.width(this.slider_length-2):(h(".horiz-slider-bg",this.element).width(k),this.$slider.width(this.slider_length))},_updateCurPosAndTrigger:function(b,h){var k=this.options,n=k.direction,e=this.$slider;null==h&&(h="vertical"==n?parseInt(e[0].style.top,10):parseInt(e[0].style.left,10));n=(h-17)/(k.length-34-this.slider_length);if(k.steps){if(n*=k.num_eles-1,n=Math.round(n),k.cur_pos!=n){if(this.dragging){if(null!=
this.topWhileDrag&&(this.topWhileDrag<h&&k.cur_pos>n||this.topWhileDrag>h&&k.cur_pos<n))return;this.topWhileDrag=h}this.options.cur_pos=n;this.scroll(b)}}else k.ratio=n,this.drag(b)},_setNormalPace:function(b){this.timer&&(window.clearInterval(this.timer),this.timer=null);var h=this,k=this.options.direction;h.timer=window.setInterval(function(){var n=h.$slider,n="vertical"==k?parseInt(n[0].style.top,10):parseInt(n[0].style.left,10);h.prev_top==n&&(h._updateCurPosAndTrigger(b,n),window.clearInterval(h.timer),
h.timer=null);h.prev_top=n},20)},setNumEles:function(b){this.options.num_eles=b;this.updateSliderPos()},_validateCurPos:function(){var b=this.options;b.cur_pos>=b.num_eles&&(b.cur_pos=b.num_eles-1);0>b.cur_pos&&(b.cur_pos=0)},_updateSliderPosRatio:function(){var b=this.options,h=b.direction,k=b.ratio,n=this.$slider,b=b.length-34-this.slider_length;if(null==k)throw"ration N/A";k=k*b+17;"vertical"==h?n.css("top",k):n.css("left",k)},_updateSliderPosCurPos:function(){var b=this.options,h=this.scroll_space*
b.cur_pos/(b.num_eles-1);"vertical"==b.direction?this.$slider.css("top",17+h):this.$slider.css("left",17+h)},updateSliderPos:function(){var b=this.options;if(void 0===b.steps)throw"assert failed. steps N/A";b.steps?this._updateSliderPosCurPos():this._updateSliderPosRatio()},scroll:function(b){var h=this.options;this._trigger("scroll",b,{cur_pos:h.cur_pos,num_eles:h.num_eles})},drag:function(b){this._trigger("drag",b,{ratio:this.options.ratio})},_pageDown:function(b){this._trigger("pageDown",b,null)},
_pageUp:function(b){this._trigger("pageUp",b,null)},_setOption:function(b,h){"disabled"==b?(this._super.call(this,b,h),!0==h?this.$slider.draggable("disable"):this.$slider.draggable("enable")):"theme"==b?(this._super.call(this,b,h),this._createLayout()):"ratio"==b?0<=h&&1>=h&&this._super.call(this,b,h):this._super.call(this,b,h)},_setOptions:function(){this._super.apply(this,arguments);this._refresh()}})})(jQuery);
(function(h){var b=function(){};b.prototype.belongs=function(a){if(a.target==this.that.element[0])return!0};h.paramquery.cClass=b;var r=function(a){this.that=a;this.hidearrHS1=[];this.options=a.options;this.offset=null};h.paramquery.cGenerateView=r;b=r.prototype;b.generateView=function(a){var c=this.that,d=c.options,f=d.freezeCols,p=c.colModel,s,q,e=c.initH,b=c.finalH,g=d.groupModel,k=c.pqpanes;if(a){var g=this._generateTables(null,null,a),m=a.$cont;m.empty();k.v?m.append(["<div class='pq-cont-inner'>",
g,"</div><div class='pq-cont-inner'>",g,"</div>"].join("")):m.append("<div class='pq-cont-inner'>"+g+"</div>");var n=m.children("div"),g=n.children("table"),t=g[0].scrollHeight-1;m.height(t);if(k.v){var k=h(n[0]),m=g[0].scrollWidth,n=h(n[1]),r=h(g[1]),x=l.call(c,-1,f),f=l.call(c,f,e);k.css({width:x,zIndex:1});n.css({left:x-1,width:m,position:"absolute",height:t});r.css({left:-1*(f+x)})}c.tables||(c.tables=[]);f=-1;for(t=0;t<c.tables.length;t++)c.tables[t].cont==a.$cont[0]&&(f=t);-1==f?c.tables.push({$tbl:g,
cont:a.$cont[0]}):c.tables[f].$tbl=g}else{c._bufferObj_calcInitFinal();s=c.initV;q=c.finalV;var y=g?c.dataGM:c.data,m=c.$cont;null!=d.editModel.indices&&c.blurEditor({force:!0});g=this._generateTables(s,q,a);m.empty();0===c.totalVisibleRows?m.append("<div class='pq-cont-inner pq-grid-norows' >"+d.strNoRows+"</div>"):k.h&&k.v?m.append(["<div class='pq-cont-inner'>",g,"</div><div class='pq-cont-inner'>",g,"</div><div class='pq-cont-inner'>",g,"</div><div class='pq-cont-inner'>",g,"</div>"].join("")):
k.h||k.v?m.append(["<div class='pq-cont-inner'>",g,"</div><div class='pq-cont-inner'>",g,"</div>"].join("")):m.append("<div class='pq-cont-inner'>"+g+"</div>");c.$tbl=m.children("div").children("table");c._fixTableViewPort();c._trigger("afterTable",null,{dataModel:d.dataModel,colModel:p,pageData:y,initV:s,finalV:q,initH:e,finalH:b})}c._saveDims();this.scrollView();a||c._trigger("refresh",null,{dataModel:d.dataModel,colModel:p,pageData:y,initV:s,finalV:q,initH:e,finalH:b});c._saveDims();this.scrollView()};
b.scrollView=function(){var a=this.that,c=this.options,d=c.virtualY;c.virtualX||a.$hscroll.pqScrollBar("drag");d||a.$vscroll.pqScrollBar("drag")};b.setPanes=function(){var a=this.that,c=a.pqpanes,d=a.$cont.children("div"),f=a.$tbl,p=parseInt(a.options.freezeCols),s=a.initH;if(f&&f.length){var q=f[0].scrollWidth;if(c.h&&c.v){var s=h(d[0]),c=h(d[1]),e=h(f[1]),b=h(d[2]),g=h(f[2]),d=h(d[3]),k=h(f[3]),f=l.call(a,-1,p),a=a.calcHeightFrozenRows();s.css({width:f,height:a,zIndex:2});c.css({left:f,width:q,
height:a,position:"absolute"});e.css({left:-1*f});b.css({width:f,zIndex:1,top:a,position:"absolute"});g.css({top:-a});d.css({left:f,width:q,zIndex:1,top:a,position:"absolute"});k.css({top:-a,left:-1*f})}else c.v?(c=h(d[0]),d=h(d[1]),e=h(f[1]),f=l.call(a,-1,p),a=l.call(a,p,s),c.css({width:f,zIndex:1}),d.css({left:f,width:q,position:"absolute"}),e.css({left:-1*(a+f)})):c.h&&(p=h(d[0]),d=h(d[1]),f=h(f[1]),a=a.calcHeightFrozenRows(),p.css({height:a,zIndex:1}),d.css({width:q,top:a,position:"absolute"}),
f.css({top:-1*a}))}};b._generateTables=function(a,c,d){var f=this.that,p=f.colModel,s=f.options,q=s.virtualX,e=f.initH,b=f.finalH,g=s.numberCell,k=s.columnBorders,h=s.rowBorders,l=s.wrap,m=s.groupModel,n=s.freezeCols,s=parseInt(s.freezeRows),r=!1,y=0,D=d?d.data.length-1:c,v=m?!0:!1,B=d&&d.data?d.data:v?f.dataGM:f.data,F=f.rowIndxOffset;if(d||null!=a&&null!=D){d||f._trigger("beforeTableView",null,{pageData:B,initV:a,finalV:c,initH:e,finalH:b,colModel:p});r="pq-grid-table ";k&&(r+="pq-td-border-right ");
h&&(r+="pq-td-border-bottom ");k=["<table class='"+(l?r+"pq-wrap ":r+"pq-no-wrap ")+"' cellpadding=0 cellspacing=0 >"];this.hidearrHS1=[];k.push("<tr class='pq-row-hidden'>");g.show&&(y=g.width+1,k.push("<td style='width:"+y+"px;' ></td>"));for(r=0;r<=b;r++){if(r<e&&r>=n&&(q||d)&&(r=e,r>b))throw"initH>finalH";y=p[r];y.hidden||(y=y.outerWidth,k.push("<td style='width:",y,"px;' pq-col-indx='",r,"'></td>"))}k.push("</tr>");this.offsetRow=null;for(y=0;y<=D;y++)y<a&&y>=s&&(y=a),q=B[y],e=v?q.rowIndx-F:
y,q&&q.pq_hidden||(r=f.lastFrozenRow===e,m&&q.groupTitle?this._generateTitleRow(m,q,k,r):m&&q.groupSummary?this._generateSummaryRow(q.data,p,k,r):(b=q.pq_detail&&q.pq_detail.show,this._generateRow(q,e,p,k,d,r,b),b&&this._generateDetailRow(q,e,p,k,d,r)));f.scrollMode=!1;k.push("</table>");return k.join("")}};b._renderCell=function(a,c){var d=this.options,f=a.rowData,p=a.column,s=p.type,p=p.dataIndx,q=f[p];if(f){void 0!=c?s=c:"checkBoxSelection"==s?s="<input type='checkbox' "+(q?"checked='checked'":
"")+" />":"detail"==s?(s=d.detailModel,s="<div class='ui-icon "+(q&&q.show?s.expandIcon:s.collapseIcon)+"'></div>"):s=q;if(""===s||void 0==s)s="&nbsp;";var q="",e;a.tree&&(e=d.treeModel)&&e.labelIndx==p?(d=!f.pq_collapse,p=(f.pq_level+1)*e.indent,q="",q=f.pq_leaf?e.leafIcon:d?e.expandIcon+" pq-tree-expand-icon":e.collapseIcon+" pq-tree-expand-icon",f=["<div class='pq-tree-icon-container' style='width:",p,"px;'><div class='ui-icon ",q," pq-tree-icon' ></div></div>"].join(""),q="<div class='"+cls+"'>"+
f+s+"</div>"):q=s;return q}};b.renderCell=function(a){var c=this.that,d=this.options,f=a.rowData,p=a.rowIndx,s=a.rowIndxPage,q=a.column,e=a.colIndx,b=q.dataIndx,g=d.freezeCols,k=d.columnBorders,h="pq-col-indx='"+e+"'",l=!1,m="pq-grid-cell ";"right"==q.align?m+=" pq-align-right":"center"==q.align&&(m+=" pq-align-center");e==g-1&&k&&(m+=" pq-last-freeze-col");(g=q.cls)&&(m=m+" "+g);(g=f.pq_cellselect)&&(l=g[b]);l&&(m+=" pq-cell-select ui-state-highlight");var n;q.render&&(n=q.render.call(c.element[0],
{data:c.data,dataModel:d.dataModel,rowData:f,cellData:f[b],rowIndxPage:s,rowIndx:p,colIndx:e,column:q,dataIndx:b}));(c=f.pq_cellcls)&&(b=c[b])&&(m+=" "+b);return["<td class='",m,"' ",h," >",this._renderCell(a,n),"</td>"].join("")};b.refreshRow=function(a,c,d){var f=this.that,p=f.data[a];this._generateRow(p,a,c,d,null,f.lastFrozenRow===a,p.pq_detail&&p.pq_detail.show)};b._generateRow=function(a,c,d,f,p,s,q){var e="pq-grid-row";s&&(e+=" pq-last-freeze-row");q&&(e+=" pq-detail-master");var b=this.that,
g=this.options;s=g.freezeCols;var k=g.numberCell;q=g.treeModel.labelIndx?!0:!1;var h=g.virtualX,l=b.initH,b=b.finalH,m=this.offset;g.stripeRows&&c/2==parseInt(c/2)&&(e+=" pq-grid-oddRow");a.pq_rowselect&&(e+=" pq-row-select ui-state-highlight");g=a.pq_rowcls;null!=g&&(e+=" "+g);f.push("<tr pq-row-indx='",c,"' class='",e,"' >");k.show&&f.push(["<td class='pq-grid-number-cell ui-state-default'>",p?"&nbsp;":c+1,"</td>"].join(""));a={rowIndx:c+m,rowIndxPage:c,rowData:a};for(c=0;c<=b;c++){if(c<l&&c>=s&&
(h||p)&&(c=l,c>b))throw"initH>finalH";e=d[c];e.hidden||(a.column=e,a.colIndx=c,a.tree=q,f.push(this.renderCell(a)))}f.push("</tr>");return f};b={widgetEventPrefix:"pqgrid"};b.options={cancel:"input,textarea,button,select,option,.ui-resizable-handle,div[contenteditable],.pq-draggable",distance:3,collapsible:{on:!0,collapsed:!1,_collapsed:!1,refreshAfterExpand:!0},colModel:null,columnBorders:!0,dataModel:{cache:!1,dataType:"JSON",location:"local",sorting:"local",sortDir:"up",method:"GET"},direction:"",
draggable:!1,editable:!0,editModel:{cellBorderWidth:0,clicksToEdit:1,filterKeys:!0,keyUpDown:!0,reInt:/^([\-]?[1-9][0-9]*|[\-]?[0-9]?)$/,reFloat:/^[\-]?[0-9]*\.?[0-9]*$/,onBlur:"validate",saveKey:h.ui.keyCode.ENTER,allowInvalid:!1,invalidClass:"ui-state-error",validate:!0},editor:{select:!1,type:"textbox"},validation:{icon:"ui-icon-alert",cls:"ui-state-error"},flexHeight:!1,flexWidth:!1,freezeCols:0,freezeRows:0,calcDataIndxFromColIndx:!0,height:400,hoverMode:"null",_maxColWidth:"100%",_minColWidth:50,
minWidth:100,numberCell:{width:30,title:"",resizable:!0,minWidth:30,maxWidth:100,show:!0},pageModel:{curPage:1,totalPages:0,rPP:10,rPPOptions:[10,20,50,100]},resizable:!1,roundCorners:!0,rowBorders:!0,scrollModel:{pace:"fast",horizontal:!0,autoFit:!1,theme:!1},selectionModel:{triggerSelectChange:!0,type:"cell",mode:"block"},swipeModel:{on:!0,speed:50,ratio:.15,repeat:20},showBottom:!0,showHeader:!0,showTitle:!0,showToolbar:!0,showTop:!0,sortable:!0,sql:!1,stripeRows:!0,title:"&nbsp;",treeModel:null,
virtualX:!1,virtualY:!1,width:"auto",wrap:!0,hwrap:!0};b._regional={strAdd:"Add",strDelete:"Delete",strEdit:"Edit",strLoading:"Loading",strNextResult:"Next Result",strNoRows:"No rows to display.",strNothingFound:"Nothing found",strPrevResult:"Previous Result",strSearch:"Search",strSelectedmatches:"Selected {0} of {1} match(es)"};h.extend(b.options,b._regional);b._destroyResizable=function(){this.element.data("resizable")&&this.element.resizable("destroy")};b._disable=function(){null==this.$disable&&
(this.$disable=h("<div class='pq-grid-disable'></div>").css("opacity",.2).appendTo(this.element))};b._enable=function(){this.$disable&&(this.element[0].removeChild(this.$disable[0]),this.$disable=null)};b._destroy=function(){this._destroyResizable();this._destroyDraggable();this._mouseDestroy();this.element.off(this.eventNamespace);h(window).unbind(this.eventNamespace);this.element.empty();this.element.css("height","");this.element.css("width","");this.element.removeClass("pq-grid ui-widget ui-widget-content ui-corner-all").removeData()};
b.decidePanes=function(){var a=this.pqpanes={v:!1,h:!1},c=this.options,d=c.virtualX,f=c.virtualY,p=c.flexHeight,s=c.flexWidth,q=c.numberCell,e=c.freezeRows,c=c.freezeCols;!e||p||!c&&!q.show||s?e&&!p?f||(a.h=!0):!c&&!q.show||s||d||(a.v=!0):(f||(a.h=!0),d||(a.v=!0))};b.collapse=function(a){var c=this,d=this.element,f=this.options.collapsible,p=f.$collapsible.children("span"),s=function(){p.addClass("ui-icon-circle-triangle-s").removeClass("ui-icon-circle-triangle-n");d.hasClass("ui-resizable")&&d.resizable("destroy");
c.$toolbar.pqToolbar("disable");f.collapsed=!0;f._collapsed=!0;f.animating=!1;c._trigger("collapse")};a=a?a:{};if(f._collapsed)return!1;f.htCapture=d.height();!1===a.animate?(d.height(23),s()):(f.animating=!0,d.animate({height:"23px"},function(){s()}))};b.expand=function(a){var c=this,d=this.element,f=this.options.collapsible,p=f.htCapture,s=f.$collapsible.children("span"),q=function(){f._collapsed=!1;f.collapsed=!1;f.refreshAfterExpand?c.refresh():c._refreshResizable();s.addClass("ui-icon-circle-triangle-n").removeClass("ui-icon-circle-triangle-s");
c.$toolbar.pqToolbar("enable");f.animating=!1;c._trigger("expand")};a=a?a:{};if(!1===f._collapsed)return!1;!1===a.animate?(d.height(p),q()):(f.animating=!0,d.animate({height:p},function(){q()}))};b._createCollapse=function(){var a=this,c=this.$top,d=this.options.collapsible;if(d.on&&!d.$collapsible){var f=h("<div class='pq-slider-icon' style='z-index:5;' ><span class='ui-icon ui-icon-circle-triangle-n'></span></div>").appendTo(c);d.$collapsible=f;f.mouseover(function(c){f.addClass("ui-state-hover")}).mouseout(function(c){f.removeClass("ui-state-hover")}).click(function(c){d.collapsed?
a.expand():a.collapse()})}else!d.on&&d.$collapsible&&(d.$collapsible.remove(),delete d.$collapsible);d.collapsed&&!d._collapsed?a.collapse({animate:!1}):!d.collapsed&&d._collapsed&&a.expand({animate:!1})};b._create=function(){var a=this;this.decidePanes();this.setEditorPosTimer();this.iGenerateView=new r(this);this.iKeyNav=new e(this);this.iRefreshColumn=new m(this);this.rowHeight=22;this.hidearr=[];this.hidearrHS=[];this.tables=[];var a=this,c=this.options;this.$tbl=null;this._refreshGridWidthAndHeight();
this._calcThisColModel();this.iSort=new h.paramquery.cSort(this);this.iSort._refreshSorters();this._initTypeColumns();var d=this.element;d.empty().addClass("pq-grid ui-widget ui-widget-content"+(c.roundCorners?" ui-corner-all":"")).append(["<div class='pq-grid-top ui-widget-header",c.roundCorners?" ui-corner-top":"","'><div class='pq-grid-title",c.roundCorners?" ui-corner-top":"","'>&nbsp;</div></div><div class='pq-grid-inner' ><div class='pq-header-outer ui-widget-header'></div><div class='pq-cont-right' ><div class='pq-cont' tabindex='0'></div></div></div><div class='pq-grid-bottom ui-widget-header",
c.roundCorners?" ui-corner-bottom":"","'><div class='pq-grid-footer'>&nbsp;</div></div>"].join(""));this._trigger("render",null,{dataModel:this.options.dataModel,colModel:this.colModel});this.$top=h("div.pq-grid-top",d);this.$title=h("div.pq-grid-title",d);c.showTitle||this.$title.css("display","none");this.$toolbar=h("div.pq-grid-toolbar",d);this.$grid_inner=h("div.pq-grid-inner",d);this.$header_o=h("div.pq-header-outer",this.$grid_inner);c.showTop||this.$top.css("display","none");this.$bottom=h("div.pq-grid-bottom",
d);c.showBottom||this.$bottom.css("display","none");this.$footer=h("div.pq-grid-footer",d);this.$cont_o=h("div.pq-cont-right",this.$grid_inner);this.$cont_fixed=h("div.pq-cont-fixed",this.$grid_inner);d=this.$cont=h("div.pq-cont",this.$grid_inner);h(window).bind("resize"+a.eventNamespace,function(c){a._onWindowResize(c)});d.on("click","td.pq-grid-cell",function(c){if(!0!==h.data(c.target,a.widgetName+".preventClickEvent")&&h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onClickCell(c)});
d.on("click","tr.pq-grid-row",function(c){if(!0!==h.data(c.target,a.widgetName+".preventClickEvent")&&h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onClickRow(c)});d.on("contextmenu","td.pq-grid-cell",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onRightClickCell(c)});d.on("contextmenu","tr.pq-grid-row",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onRightClickRow(c)});d.on("dblclick","td.pq-grid-cell",function(c){if(h(c.target).closest(".pq-grid")[0]==
a.element[0])return a._onDblClickCell(c)});d.on("dblclick","tr.pq-grid-row",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onDblClickRow(c)});d.on("mousedown","td.pq-grid-cell",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onCellMouseDown(c)});d.on("mousedown","tr.pq-grid-row",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onRowMouseDown(c)});d.on("mousedown",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onContMouseDown(c)});
d.on("mouseenter","td.pq-grid-cell",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onCellMouseEnter(c,h(this))});d.on("mouseenter","tr.pq-grid-row",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onRowMouseEnter(c,h(this))});d.on("mouseleave","td.pq-grid-cell",function(c){if(h(c.target).closest(".pq-grid")[0]==a.element[0])return a._onCellMouseLeave(c,h(this))});d.on("mouseleave","tr.pq-grid-row",function(c){if(h(c.target).closest(".pq-grid")[0]==
a.element[0])return a._onRowMouseLeave(c,h(this))});d.bind("mousewheel DOMMouseScroll",function(c){return a._onMouseWheel(c)});this.$hvscroll=h("<div class='pq-hvscroll-square ui-widget-content'></div>").appendTo(this.$grid_inner);this.$vscroll=h("<div class='pq-vscroll'></div>").appendTo(this.$grid_inner);this.prevVScroll=0;d=c.scrollModel;void 0===d.lastColumn&&c.virtualX&&(d.lastColumn="auto");this.$vscroll.pqScrollBar({pace:d.pace,theme:d.theme,steps:c.virtualY,direction:"vertical",cur_pos:0,
pageDown:function(c,d){a.iKeyNav.pageDown()},pageUp:function(c,d){a.iKeyNav.pageUp()},drag:function(d,p){c.virtualY||a._syncViewWithScrollBarVert(p.ratio)},scroll:function(d,p){c.virtualY&&(a.scrollMode=!0,a.setFlexWHCallback(function(){a.iGenerateView.generateView()}),1>=(d.originalEvent&&"drag"==d.originalEvent.type?a._setScrollVNumEles():a._setScrollVNumEles(!0))&&(a._setScrollHLength(),a._setScrollHVLength()))}});this.$hscroll=h("<div class='pq-hscroll'></div>").appendTo(this.$grid_inner);this.$hscroll.pqScrollBar({direction:"horizontal",
pace:d.pace,theme:d.theme,steps:c.virtualX,cur_pos:0,drag:function(d,p){c.virtualX||a._syncViewWithScrollBarHor(p.ratio)},scroll:function(d,p){c.virtualX&&a.refresh()}});this.element.height("");this.disableSelection();window.opera?this.$grid_inner.bind("keypress.pq-grid",{that:this},function(c){h(c.target).closest(".pq-grid")[0]==a.element[0]&&a._onKeyPressDown(c)}):this.$grid_inner.bind("keydown.pq-grid",{that:this},function(c){h(c.target).closest(".pq-grid")[0]==a.element[0]&&a._onKeyPressDown(c)});
this._refreshOptions();this._refreshTitle();this.iRows=new h.paramquery.cRows(this);this.iCells=new h.paramquery.cCells(this);this.generateLoading();this._initPager();this._refreshResizable();this._refreshDraggable();this._mouseInit()};b._mouseCapture=function(a){var c=this.options;if(c.virtualX&&c.virtualY||!a.target)return!1;if(h(a.target).closest(".pq-grid")[0]==this.element[0]){if(c.flexHeight&&c.flexWidth)return!1;a=c.swipeModel;return!1==a.on||"touch"==a.on&&!h.support.touch?!1:!0}return!1};
b._saveDims=function(){var a=this.$cont;a.data("offsetWidth",a[0].offsetWidth);a.data("offsetHeight",a[0].offsetHeight);var c=this.$tbl;if(c)for(a=0;a<c.length;a++){var d=c[a],f=h(d);f.data("offsetHeight",d.offsetHeight);f.data("scrollWidth",d.scrollWidth)}if(c=this.$tbl_header)for(a=0;a<c.length;a++)d=c[a],f=h(d).parent(),f.data("offsetHeight",d.offsetHeight),f.data("scrollWidth",d.scrollWidth)};b._mousePQUp=function(a){h(document).unbind("mouseup."+this.widgetName,this._mousePQUpDelegate);this._trigger("mousePQUp",
a,null)};b._mouseDown=function(a){var c=this;if(h(a.target).closest(".pq-editor-focus").length)this._blurEditMode=!0,window.setTimeout(function(){c._blurEditMode=!1},0);else return this._saveDims(),this._mousePQUpDelegate=function(a){return c._mousePQUp(a)},h(document).bind("mouseup."+this.widgetName,this._mousePQUpDelegate),this._super.call(this,a)};b._mouseStart=function(a){this.blurEditor({force:!0});return!0};b._mouseDrag=function(a){return!1==this._trigger("mouseDrag",a,null)?!1:!0};b._mouseStop=
function(a){return!1==this._trigger("mouseStop",a,null)?!1:!0};b._refreshGridWidthAndHeight=function(){var a=this.options,c,d,f=-1<(a.width+"").indexOf("%")?!0:!1,p=-1<(a.height+"").indexOf("%")?!0:!1,s=this.element;if(f||p){var q=s.parent();if(!q.length)return;var e=q.width(),b=q[0]==document.body?h(document).height():q.height(),g=null,k=function(c){return(c=/(-|\+)([0-9]+)/.exec(c))&&3==c.length?parseInt(c[1]+c[2]):0},l=f?k(a.width):0,k=p?k(a.height):0;if(0==e){for(;"BODY"!=q[0].tagName.toUpperCase();){var m=
q.parent();if(null==m[0]){g=q;break}else q=m}if(g){var m=g.css("position"),n=g.css("left"),r=g.css("top");g.css({position:"absolute",left:"-2000",top:"-2000"}).appendTo(h(document.body));q=s.parent();f&&(e=q.width());p&&(b=q.height());g.css({position:m,left:n,top:r})}}f&&(c=parseInt(a.width)*e/100+l);p&&(d=parseInt(a.height)*b/100+k)}f||(c=a.width);p||(d=a.height);"auto"!=c&&c<a.minWidth&&(c=a.minWidth);d<a.minHeight&&(d=a.minHeight);s.width(c);s.height(d)};var k,n;b._onWindowResize=function(a){a=
this.options;var c=this.element.parent(),d,f;if(c.length&&(d=c.height(),f=c.width(),null==k||d!=k&&c.closest(".ui-resizable").length||f!=n)&&(k=d,n=f,!(h.support.touch&&a.editModel.indices&&h(document.activeElement).is(".pq-editor-focus")))){var p=this;a=a.autoSizeInterval;a=void 0===a?0:a;this.autoResizeTimeout&&(clearTimeout(this.autoResizeTimeout),delete this.autoResizeTimeout);this.autoResizeTimeout=window.setTimeout(function(){p._refreshAfterResize();delete p.autoResizeTimeout},a)}};b._onMouseWheel=
function(a){this._saveDims();var c=this.options;if(c.flexHeight)return!0;var d=this.$vscroll,f=0;a=a.originalEvent;a.wheelDelta?f=a.wheelDelta/120:a.detail&&(f=-1*a.detail/3);var p=d.pqScrollBar("option");a=parseInt(p.cur_pos);var s=parseInt(p.num_eles),p=p.ratio,q=a-f;c.virtualY?0<=q&&(d.pqScrollBar("option","cur_pos",a-f),d.pqScrollBar("scroll")):(c=p-f/(s-1),1<c?c=1:0>c&&(c=0),d.pqScrollBar("option","ratio",c),d.pqScrollBar("drag"));return!1};b._onDblClickCell=function(a){var c=h(a.currentTarget),
d=this.getCellIndices({$td:c}),f=d.rowIndxPage,p=f+this.rowIndxOffset,d=d.colIndx;if(null!=d){if(!1==this._trigger("cellDblClick",a,{$td:c,rowIndxPage:f,rowIndx:p,colIndx:d,column:this.colModel[d],rowData:this.data[f]}))return!1;1<this.options.editModel.clicksToEdit&&this.isEditableRow({rowIndx:p})&&this.isEditableCell({colIndx:d,rowIndx:p})&&this.editCell({rowIndxPage:f,colIndx:d})}};b._onClickCont=function(a){};b._onClickRow=function(a){var c=h(a.currentTarget),d=parseInt(c.attr("pq-row-indx")),
f=d+this.rowIndxOffset;if(!isNaN(d)&&!1==this._trigger("rowClick",a,{$tr:c,rowIndxPage:d,rowIndx:f,rowData:this.data[d]}))return!1};b._onRightClickRow=function(a){var c=h(a.currentTarget),d=parseInt(c.attr("pq-row-indx")),f=d+this.rowIndxOffset;if(!isNaN(d)&&!1==this._trigger("rowRightClick",a,{$tr:c,rowIndxPage:d,rowIndx:f,rowData:this.data[d]}))return!1};b._onDblClickRow=function(a){var c=h(a.currentTarget),d=parseInt(c.attr("pq-row-indx")),f=this.getRowIndxOffset();if(!1==this._trigger("rowDblClick",
a,{$tr:c,rowIndxPage:d,rowIndx:d+f,rowData:this.data[d]}))return!1};h.paramquery.getValueFromDataType=function(a,c,d){if("date"==c)return c=Date.parse(a),isNaN(c)?"":d?c:a;if("integer"==c)c=parseInt(a);else if("float"==c)c=parseFloat(a);else return"bool"==c?(c=h.trim(a).toLowerCase(),0==c.length?null:"true"==c||"yes"==c||"1"==c?!0:"false"==c||"no"==c||"0"==c?!1:Boolean(c)):h.trim(a);return isNaN(c)||null==c?null==a?a:null:c};b.__isValidCell=function(a){var c=a.column,d=c.validations;if(!d||!d.length)return{valid:!0};
var f=a.value,p=c.dataType,s=function(c){return h.paramquery.getValueFromDataType(c,p,!0)};a=a.rowData;if(!a)throw"rowData required.";for(var q=0;q<d.length;q++){var e=d[q],b=e.type,g=!1,k=e.msg,l=e.value;null==f?g=!1:"minLen"==b?(f=s(f),l=s(l),f.length>=l&&(g=!0)):"nonEmpty"==b?null!=f&&""!==f&&(g=!0):"maxLen"==b?(f=s(f),l=s(l),f.length<=l&&(g=!0)):"gt"==b?(f=s(f),l=s(l),f>l&&(g=!0)):"gte"==b?(f=s(f),l=s(l),f>=l&&(g=!0)):"lt"==b?(f=s(f),l=s(l),f<l&&(g=!0)):"lte"==b?(f=s(f),l=s(l),f<=l&&(g=!0)):"regexp"==
b?(new RegExp(l)).test(f)&&(g=!0):"function"==typeof b?(l={column:c,value:f,rowData:a,msg:k},!1==b.call(this.element[0],l)?(g=!1,l.msg!=k&&(k=l.msg)):g=!0):g=!0;if(!g)return{valid:!1,msg:k,column:c,dataIndx:c.dataIndx,validation:e}}return{valid:!0}};b._isValidCell=function(a){var c=a.rowData,d=a.valueDef,f=a.column,p=this.options,s=a.allowInvalid,q=f.dataIndx,e=p.validation,b=document.activeElement;a=this.__isValidCell({column:f,value:a.value,rowData:c});var f=a.valid,g,k,l,m,n;f||(e=e=h.extend({},
e,a.validation),g=a.msg,m=e.css,k=e.cls,l=e.icon,n="padding:3px 10px;"+e.style);if(!0===s)if(f)this.removeClass({rowData:c,dataIndx:q,cls:"ui-state-error"});else return this.addClass({rowData:c,dataIndx:q,cls:"ui-state-error"}),a;else if(!f){c=this.getRowIndx({rowData:c}).rowIndx;if(null==c)return a;if(!d)this.goToPage({rowIndx:c}),this.editCell({rowIndx:c,dataIndx:q});else if(h(b).hasClass("pq-editor-focus")&&(p=p.editModel.indices)){d=p.rowIndx;p=p.dataIndx;if(null!=c&&c!=d)throw"incorrect usage of isValid rowIndx: "+
c;if(q!=p)throw"incorrect usage of isValid dataIndx: "+q;this.editCell({rowIndx:d,dataIndx:q})}if((q=this.getEditCell())&&q.$cell){q=q.$cell;q.attr("title",g);try{q.tooltip("destroy")}catch(r){}q.tooltip({position:{my:"left center+5",at:"right center"},content:function(){h(this);return(""==l?"":"<span class='ui-icon "+l+" pq-tooltip-icon'></span>")+g},open:function(c,a){k&&a.tooltip.addClass(k);if(n){var d=a.tooltip.attr("style");a.tooltip.attr("style",d+";"+n)}m&&a.tooltip.css(m)}}).tooltip("open")}return a}if(d&&
(q=this.getEditCell())&&q.$cell){q=q.$cell;q.removeAttr("title");try{q.tooltip("destroy")}catch(x){}}return{valid:!0}};b.isValid=function(a){a=a||{};var c=a.allowInvalid,c=null==c?!1:c,d=a.dataIndx;if(a.hasOwnProperty("dataIndx")){var f=this.columns[d],p=a.rowData||this.getRowData(a),s=a.hasOwnProperty("value"),q=s?a.value:p[d],q=this._isValidCell({rowData:p,value:q,valueDef:s,column:f,allowInvalid:c});if(!q.valid)return q}else{if(a.hasOwnProperty("data")){d=a.data;a=[];if(!d)return null;for(var s=
0,e=d.length;s<e;s++)if(f=this.isValid({rowData:d[s],allowInvalid:c}),!1===c){if(!f.valid)return q}else a=a.concat(f);return!1===c?q:a}var p=a.rowData||this.getRowData(a),b=this.colModel;a=[];s=0;for(e=b.length;s<e;s++)if(f=b[s],!f.hidden&&(d=f.dataIndx,q=p[d],q=this._isValidCell({rowData:p,value:q,column:f,allowInvalid:c}),!q.valid)){if(!1===c)return q;a.push({rowData:p,dataIndx:d,column:f})}if(c&&a.length)return a}return{valid:!0}};b.isEditableRow=function(a){var c=this.options.editable;if(null!=
c){if("function"==typeof c){var d=a.rowIndx;a=a.rowData||this.getRowData({rowIndx:d});return c.call(this.element[0],{rowData:a,rowIndx:d})}return c}return!0};b.isEditableCell=function(a){var c=a.colIndx,d=a.dataIndx,c=null==c?this.getColIndx({dataIndx:d}):c,c=this.colModel[c],d=null==d?c.dataIndx:d,f=c.editable;if(a.checkVisible&&c.hidden)return!1;if(null!=f){if("function"==typeof f){var p=a.rowIndx;a=a.rowData||this.getRowData(a);return f.call(this.element[0],{rowIndx:p,rowData:a,column:c,dataIndx:d})}return f}return!0};
b._getRowPQData=function(a,c,d){return(d=null==d?this.data[a]:d)?d[c]:null};b._setRowPQData=function(a,c,d){if(d=null==d?this.data[a]:d)for(var f in c)d[f]=c[f]};b._onContMouseDown=function(a){this.blurEditor({blurIfFocus:!0});if(!1===this._trigger("contMouseDown",a,{dataModel:this.options.dataModel}))return!1;var c=h(a.target);a=c.closest(".pq-grid-cell");c=c.closest(".pq-grid-row");a.length||c.length||this.$cont.attr("tabindex",0).focus();return!0};b._onCellMouseDown=function(a){var c=h(a.currentTarget),
d=this.getCellIndices({$td:c});d.$td=c;d.dataModel=this.options.dataModel;return!1==this._trigger("cellMouseDown",a,d)?!1:!0};b._onRowMouseDown=function(a){var c=h(a.currentTarget),d=this.getRowIndx({$tr:c});d.$tr=c;d.dataModel=this.options.dataModel;return!1==this._trigger("rowMouseDown",a,d)?!1:!0};b._onCellMouseEnter=function(a,c){var d=this.options,f=this.getCellIndices({$td:c});if(!1===this._trigger("cellMouseEnter",a,f))return!1;"cell"==d.hoverMode&&this.highlightCell(c);return!0};b._onRowMouseEnter=
function(a,c){var d=this.options,f=this.getRowIndx({$tr:c}),p=f.rowIndxPage;if(!1===this._trigger("rowMouseEnter",a,f))return!1;"row"==d.hoverMode&&this.highlightRow(p);return!0};b._onCellMouseLeave=function(a,c){"cell"==this.options.hoverMode&&this.unHighlightCell(c);return!0};b._onRowMouseLeave=function(a,c){var d=this.getRowIndx({$tr:c}).rowIndxPage;"row"==this.options.hoverMode&&this.unHighlightRow(d);return!0};b._onCellMouseUp=function(a){var c=h(a.currentTarget),d=this.getCellIndices({$td:c});
d.$td=c;d.dataModel=this.options.dataModel;return!1==this._trigger("cellMouseUp",a,d)?!1:!0};b._onRowMouseUp=function(a){var c=h(a.currentTarget),c=this.getRowIndx({$tr:c});return!1==this._trigger("rowMouseUp",a,c)?!1:!0};b._onClickCell=function(a){var c=this.colModel,d=this.options.editModel,f=h(a.currentTarget),p=this.getCellIndices({$td:f}),s=p.rowIndxPage,q=s+this.rowIndxOffset,e=p.colIndx;p.rowIndx=q;if(null!=e){var c=c[e],b=c.dataIndx;p.dataIndx=b;p.evt=a;if(!1==this._trigger("cellClick",a,
{$td:f,rowIndxPage:s,rowIndx:q,colIndx:e,dataIndx:b,column:c,rowData:this.data[s]}))return!1;1==d.clicksToEdit&&this.isEditableRow({rowIndx:q})&&this.isEditableCell({colIndx:e,rowIndx:q})&&this.editCell(p)}};b._onRightClickCell=function(a){var c=h(a.currentTarget),d=this.getCellIndices({$td:c}),f=d.rowIndxPage,p=f+this.rowIndxOffset,d=d.colIndx,s=this.colModel;if(null!=d&&(s=s[d],!1==this._trigger("cellRightClick",a,{$td:c,rowIndxPage:f,rowIndx:p,colIndx:d,dataIndx:s.dataIndx,column:s,rowData:this.data[f]})))return!1};
b.highlightCell=function(a){a.addClass("pq-grid-cell-hover ui-state-hover")};b.unHighlightCell=function(a){a.removeClass("pq-grid-cell-hover ui-state-hover")};b.highlightRow=function(a){isNaN(a)||(a=this.getRow({rowIndxPage:a}))&&a.addClass("pq-grid-row-hover ui-state-hover")};b.unHighlightRow=function(a){isNaN(a)||(a=this.getRow({rowIndxPage:a}))&&a.removeClass("pq-grid-row-hover ui-state-hover")};b._getCreateEventData=function(){return{dataModel:this.options.dataModel,data:this.data,colModel:this.options.colModel}};
b._refreshOptions=function(){this._refreshDataOptions()};b._refreshDataOptions=function(){};b.enableSelection=function(){this.$cont.enableSelection()};b.disableSelection=function(){this.$cont.disableSelection();this.$header_o.find("tr.pq-grid-title-row").disableSelection()};b._findCellFromEvt=function(a){a=h(a.target).closest(".pq-grid-cell");if(null==a||0==a.length)return{rowIndxPage:null,colIndx:null,$td:null};var c=this.getCellIndices({$td:a});c.$td=a;return c};b._initPager=function(){var a=this,
c={change:function(c,f){a.blurEditor({force:!0});var p=a.options.pageModel;void 0!=f.curPage&&(p.prevPage=p.curPage,p.curPage=f.curPage);void 0!=f.rPP&&(p.rPP=f.rPP);"remote"==p.type?a.remoteRequest({callback:function(){a._onDataAvailable({apply:!0})}}):a.refreshView()},refresh:function(c){a.refreshDataAndView()}};this.options.pageModel.type&&this.$footer.pqPager(c)};b._refreshHideArrHS=function(){for(var a=this.colModel,c=this.hidearrHS,d=this.initH,f=this.finalH,p=parseInt(this.options.freezeCols),
s=0;s<p;s++)c[s]=!1;for(s=p;s<d;s++)c[s]=!0;for(s=d;s<=f;s++)c[s]=!1;s=f+1;for(a=a.length;s<a;s++)c[s]=!0};b.generateLoading=function(){this.$loading&&this.$loading.remove();this.$loading=h("<div class='pq-loading'></div>").appendTo(this.element);h(["<div class='pq-loading-bg'></div><div class='pq-loading-mask ui-state-highlight'><div>",this.options.strLoading,"...</div></div>"].join("")).appendTo(this.$loading);this.$loading.find("div.pq-loading-bg").css("opacity",.2)};b._refreshLoadingString=function(){this.$loading.find("div.pq-loading-mask").children("div").html(this.options.strLoading)};
b.showLoading=function(){null==this.showLoadingCounter&&(this.showLoadingCounter=0);this.showLoadingCounter++;this.$loading.show()};b.hideLoading=function(){0<this.showLoadingCounter&&this.showLoadingCounter--;this.showLoadingCounter||this.$loading.hide()};b.refreshDataFromDataModel=function(){this._trigger("beforeRefreshData",null,{});var a=this.options,c=a.pageModel,a=a.dataModel.data,d=c.type;this.rowIndxOffset=0;if(null==a||0==a.length)d&&(c.curPage=0,c.totalPages=0,c.totalRecords=0),this.data=
a;else{if(d&&"local"==d){c.totalRecords=a.length;c.totalPages=Math.ceil(a.length/c.rPP);c.curPage>c.totalPages&&(c.curPage=c.totalPages);1>c.curPage&&0<c.totalPages&&(c.curPage=1);var f=(c.curPage-1)*c.rPP,p=c.curPage*c.rPP;p>a.length&&(p=a.length);this.data=a.slice(f,p)}else"remote"==d?(f=Math.ceil(c.totalRecords/c.rPP),(c.totalPages=f)&&!c.curPage&&(c.curPage=1),p=c.rPP,p>a.length&&(p=a.length),this.data=a.slice(0,p)):this.data=a.slice(0);if("local"==d||"remote"==d)this.rowIndxOffset=c.rPP*(c.curPage-
1)}};h.paramquery.filter=function(){var a={begin:{text:"Begins With",TR:!0,string:!0},between:{text:"Between",TR:!0,string:!0,date:!0,number:!0},notbegin:{text:"Does not begin with",TR:!0,string:!0},contain:{text:"Contains",TR:!0,string:!0},notcontain:{text:"Does not contain",TR:!0,string:!0},equal:{text:"Equal To",TR:!0,string:!0,bool:!0},notequal:{text:"Not Equal To",TR:!0,string:!0},empty:{text:"Empty",TR:!1,string:!0,bool:!0},notempty:{text:"Not Empty",TR:!1,string:!0,bool:!0},end:{text:"Ends With",
TR:!0,string:!0},notend:{text:"Does not end with",TR:!0,string:!0},less:{text:"Less Than",TR:!0,number:!0,date:!0},lte:{text:"Less than or equal",TR:!0,number:!0,date:!0},range:{TR:!0,string:!0,number:!0,date:!0},regexp:{TR:!0,string:!0,number:!0,date:!0},great:{text:"Great Than",TR:!0,number:!0,date:!0},gte:{text:"Greater than or equal",TR:!0,number:!0,date:!0}};return{conditions:a,getAllConditions:function(){var c=[],d;for(d in a)c.push(d);return c}(),getConditions:function(c){var d=[],f;for(f in a)a[f][c]&&
d.push(f);return d},getTRConditions:function(){var c=[],d;for(d in a)a[d].TR&&c.push(d);return c}(),getWTRConditions:function(){var c=[],d;for(d in a)a[d].TR||c.push(d);return c}()}}();h.paramquery.filter.rules={};h.paramquery.filter.rules.en={begin:"Begins With",between:"Between",notbegin:"Does not begin with",contain:"Contains",notcontain:"Does not contain",equal:"Equal To",notequal:"Not Equal To",empty:"Empty",notempty:"Not Empty",end:"Ends With",notend:"Does not end with",less:"Less Than",lte:"Less than or equal",
great:"Great Than",gte:"Greater than or equal"};b.getQueryStringSort=function(){var a=this.iSort.sorters,c="",d=this.options,f=d.stringify;if(d.sql){for(d=0;d<a.length;d++)f=a[d],c+=(0<d?", ":"")+f.dataIndx+" "+("up"==f.dir?"asc":"desc");return c}return a.length?!1===f?a:JSON.stringify(a):""};b.getQueryStringCRUD=function(){return""};b.getQueryStringFilter=function(){var a=this.options,c=a.sql,d=a.stringify,f=a.filterModel,a=f.mode,p=this.getFilterData({CM:this.colModel,location:"remote"}),s="";if(f&&
f.on&&p)if(c){s=[];for(d=0;d<p.length;d++){var e=p[d],c=e.condition,f=e.dataIndx,e=h.trim(e.value);"contain"===c?s.push(f+" like '%"+e+"%'"):"notcontain"===c?s.push(f+" not like '%"+e+"%'"):"begin"===c?s.push(f+" like '"+e+"%'"):"end"===c?s.push(f+" like '%"+e+"'"):"equal"===c?s.push(f+"='"+e+"'"):"notequal"===c?s.push(f+"!='"+e+"'"):"empty"===c?s.push("isnull("+f+",'')=''"):"notempty"===c?s.push("isnull("+f+",'')!=''"):"less"===c?s.push(f+"<'"+e+"'"):"great"===c&&s.push(f+">'"+e+"'")}s=s.join(" "+
a+" ")}else p.length?(a={mode:a,data:p},s=!1===d?a:JSON.stringify(a)):s="";return s};b.remoteRequest=function(a){this.loading&&this.xhr.abort();var c=this,d="",f="",p=this.options,e=!1,q=this.colModel,b=p.dataModel,g=p.filterModel,k=p.pageModel;if("function"==typeof b.getUrl)(p=b.getUrl.call(this.element[0],{colModel:q,dataModel:b,groupModel:p.groupModel,pageModel:k,filterModel:g}))&&p.url&&(d=p.url),p&&p.data&&(f=p.data);else if("string"==typeof b.url){var d=b.url,f={},p={},l={};if("remote"==b.sorting){var m=
this.getQueryStringSort();m&&(f={pq_sort:m})}"remote"==k.type&&(l={pq_curpage:k.curPage,pq_rpp:k.rPP});"local"!=g.type&&(m=this.getQueryStringFilter())&&(e=!0,p={pq_filter:m});var m=b.postData,n=b.postDataOnce;m&&"function"==typeof m&&(m=m.call(this.element[0],{colModel:q,dataModel:b}));f=h.extend({pq_datatype:b.dataType},p,l,f,m,n)}d&&(this.loading=!0,this.showLoading(),this.xhr=h.ajax({url:d,dataType:b.dataType,async:null==b.async?!0:b.async,cache:b.cache,contentType:b.contentType,type:b.method,
data:f,beforeSend:function(a,d){if("function"==typeof b.beforeSend)return b.beforeSend.call(c.element[0],a,d)},success:function(d,f,p){"function"==typeof b.getData&&(d=b.getData.call(c.element[0],d,f,p));b.data=d.data;k.type&&"remote"==k.type&&(d.curPage&&(k.curPage=d.curPage),d.totalRecords&&(k.totalRecords=d.totalRecords));c.hideLoading();c.loading=!1;a&&a.callback&&a.callback();c._trigger("load",null,{dataModel:b,colModel:q});e&&c._trigger("filter",null,{type:"remote",dataModel:b,colModel:q,filterModel:g})},
error:function(a,d,f){c.hideLoading();c.loading=!1;if("function"==typeof b.error)b.error.call(c.element[0],a,d,f);else if("abort"!=f)throw"Error : "+f;}}))};b._fixFireFoxContentEditableIssue=function(){};b.setFlexWHCallback=function(a){a.call(this);a=this.options;a.flexHeight&&this._setGridHeightFromTable();a.flexWidth&&this._setGridWidthFromTable()};b._refreshTitle=function(){this.$title.html(this.options.title)};b._destroyDraggable=function(){var a=this.element,c=a.parent(".pq-wrapper");c.length&&
c.data("draggable")&&(c.draggable("destroy"),this.$title.removeClass("pq-draggable"),a.unwrap(".pq-wrapper"))};b._refreshDraggable=function(){var a=this.element,c=this.$title;this.options.draggable?(c.addClass("pq-draggable"),a.parent(".pq-wrapper").length||a.wrap("<div class='pq-wrapper' />"),a.parent(".pq-wrapper").draggable({handle:c})):this._destroyDraggable()};b._refreshResizable=function(){var a=this,c=this.element,d=this.options,f=-1<(d.width+"").indexOf("%"),p=-1<(d.height+"").indexOf("%"),
e="auto"==d.width,q=d.flexWidth,b=d.flexHeight;if(!d.resizable||(b||p)&&(q||f||e))this._destroyResizable();else{var g="e,s,se";if(b||p)g="e";else if(q||f||e)g="s";q=!0;c.hasClass("ui-resizable")&&(b=c.resizable("option","handles"),g==b?q=!1:this._destroyResizable());q&&c.resizable({helper:"ui-state-default",handles:g,minWidth:d.minWidth,minHeight:d.minHeight?d.minHeight:100,delay:0,start:function(c,a){h(a.helper).css({opacity:.5,background:"#ccc",border:"1px solid steelblue"})},resize:function(c,
a){},stop:function(c,q){p||(d.height=a.element.height());f||e||(d.width=a.element.width());a.refresh();a.element.css("position","relative");h(window).trigger("resize")}})}};b._refreshAfterResize=function(){var a=this.options,c=a.width,d=a.height,a=-1!=(c+"").indexOf("%")?!0:!1,c="auto"===c,d=-1!=(d+"").indexOf("%")?!0:!1;(a||c||d)&&this.refresh()};b.refresh=function(a){this._refresh(a)};b._refreshDataIndices=function(){for(var a="JSON"==this.getDataType()?!0:!1,c={},d={},f={},p=this.colModel,e=p.length,
q=0;q<e;q++){var b=p[q],g=b.dataIndx;null==g&&(g=a?"dataIndx_"+q:q,b.dataIndx=g);c[g]=b;d[g]=q;b.validations&&(f[g]=f)}this.columns=c;this.colIndxs=d;this.validations=f};b.refreshView=function(a){null!=this.options.editModel.indices&&this.blurEditor({force:!0});this.refreshDataFromDataModel();this.refresh(a)};b._refresh=function(a){a=a||{};var c=a.header,d=a.table;a=this.element;if(a[0].offsetWidth){this.$grid_inner[0].scrollTop=0;var f=this.options;f.virtualX&&f.virtualY?this.pqpanes={v:!1,h:!1}:
this.decidePanes();f.collapsible._collapsed=!1;var p=this;this._refreshGridWidthAndHeight();this.iRefreshColumn.refreshColumnWidths();this._setScrollHNumEles();this._bufferObj_calcInitFinalH();this._refreshHideArrHS();!1!==c&&this._createHeader();this._refreshHeaderSortIcons();this._refreshPager();this._setInnerGridHeight();this._setRightGridHeight();a.height("");this.setFlexWHCallback(function(){!1!==d?p.iGenerateView.generateView():(p._saveDims(),p.iGenerateView.scrollView())});this._refreshScrollbars();
this._refreshFreezeLine();this._createCollapse();f.dataModel.postDataOnce=void 0}};b._refreshScrollbars=function(a){this._setScrollHLength();this._setScrollVLength();this._setScrollVNumEles(!0);this._setScrollHLength();this._setScrollHVLength()};b._setScrollHVLength=function(){var a=this.options;(this.$hscroll.is(":hidden")||a.flexHeight||a.flexWidth)&&this.$hvscroll.css("visibility","hidden")};b._refreshPager=function(){var a=this.options,c=a.pageModel,d=this.$footer,f=c.rPP,p=c.totalRecords;c.type?
(a=a.pageModel,!1==d.hasClass("pq-pager")&&this._initPager(),d.pqPager("option",a),p>f&&this.$bottom.css("display","")):(d.hasClass("pq-pager")&&d.pqPager("destroy"),a.showBottom?this.$bottom.css("display",""):this.$bottom.css("display","none"))};b.getInstance=function(){return{grid:this}};b._addRowsData=function(a){var c=a.data,d=this.options.dataModel.data;a=a.rowIndx;null==d&&(d=[]);if(null==a)for(var f=0,p=c.length;f<p;f++){var e=c[f];d.push(e)}else if(a<d.length)for(f=0,p=c.length;f<p;f++)e=
c[f],d.splice(a,0,e),a++;else return!1;return!0};b.addRows=function(a){return this._addRowsData(a)?(this.refreshDataFromDataModel(),this.refresh(),!0):!1};b.refreshDataAndView=function(a){var c=this.options.dataModel;this.iSort._refreshSorters();if("remote"==c.location){var d=this;this.remoteRequest({callback:function(){d._onDataAvailable(a)}})}else this._onDataAvailable(a)};b.getColIndx=function(a){a=a.dataIndx;if(void 0===a)throw"dataIndx NA";for(var c=this.colModel,d=0,f=c.length;d<f;d++)if(c[d].dataIndx==
a)return d};b.getColumn=function(a){if(null==a.dataIndx)throw"dataIndx N/A";return this.columns[a.dataIndx]};b._onDataAvailable=function(){};b._setOption=function(a,c){var d=this.options;if("height"==a)this._super.call(this,a,c);else if("width"==a)this._super.call(this,a,c);else if("title"==a)this._super.call(this,a,c),this._refreshTitle();else if("roundCorners"==a)this._super.call(this,a,c),c?(this.element.addClass("ui-corner-all"),this.$top.addClass("ui-corner-top"),this.$bottom.addClass("ui-corner-bottom")):
(this.element.removeClass("ui-corner-all"),this.$top.removeClass("ui-corner-top"),this.$bottom.removeClass("ui-corner-bottom"));else if("freezeCols"==a)c=parseInt(c),!isNaN(c)&&0<=c&&c<=this.colModel.length-2&&this._super.call(this,a,c);else if("freezeRows"==a)c=parseInt(c),!isNaN(c)&&0<=c&&this._super.call(this,a,c);else if("resizable"==a)this._super.call(this,a,c),this._refreshResizable();else if("draggable"==a)this._super.call(this,a,c),this._refreshDraggable();else if("scrollModel"==a)this._super.call(this,
a,c);else if("dataModel"==a)this._super.call(this,a,c);else if("pageModel"==a)this._super.call(this,a,c);else if("selectionModel"===a)this._super.call(this,a,c);else if("colModel"===a||"columnTemplate"==a)this._super.call(this,a,c),this._calcThisColModel();else if("disabled"===a)this._super.call(this,a,c),!0===c?this._disable():this._enable();else if("numberCell"===a)this._super.call(this,a,c),this.decidePanes();else if("strLoading"===a)this._super.call(this,a,c),this._refreshLoadingString();else if("showTop"===
a)this._super.call(this,a,c),!0===c?this.$top.css("display",""):this.$top.css("display","none");else if("showTitle"===a)this._super.call(this,a,c),!0===c?this.$title.css("display",""):this.$title.css("display","none");else if("showToolbar"===a)this._super.call(this,a,c),!0===c?this.$toolbar.css("display",""):this.$toolbar.css("display","none");else if("toolbar"==a)this._super.call(this,a,c),this.$toolbar.remove(),this._super.call(this,a,c),this._createToolbar();else if("collapsible"===a)this._super.call(this,
a,c),this._createCollapse();else if("showBottom"===a)this._super.call(this,a,c),!0===c?this.$bottom.css("display",""):this.$bottom.css("display","none");else if("flexHeight"===a){this._super.call(this,a,c);var f=this.$vscroll;c&&f&&f.hasClass("pq-sb-vert")&&(d.virtualY?f.pqScrollBar("option","cur_pos",0):f.pqScrollBar("option","ratio",0))}else"flexWidth"===a?(this._super.call(this,a,c),f=this.$hscroll,c&&f&&f.hasClass("pq-sb-horiz")&&(d.virtualX?f.pqScrollBar("option","cur_pos",0):f.pqScrollBar("option",
"ratio",0))):this._super.call(this,a,c)};b._setOptions=function(){this._super.apply(this,arguments)};b._generateCellRowOutline=function(){var a=this.options,c=a.editModel;if(this.$div_focus){if(a.debug)throw"this.$div_focus already present assert failed";}else a=this.element,c.inline&&(a=this.getCell(c.indices),a.css("padding",0).empty()),this.$div_focus=h("<div class='pq-editor-outer'><div class='pq-editor-inner'></div></div>").appendTo(a),c=h.extend({all:!0},c.indices),c=this.getCell(c),c.css("height",
c.height()),c.empty(),this.refreshEditorPos()};b._removeCellRowOutline=function(a){if(this.$div_focus){a=this.$div_focus.find(".pq-editor-focus");a.hasClass("hasDatepicker")&&a.datepicker("hide").datepicker("destroy");if(a[0]==document.activeElement){var c=this._blurEditMode;this._blurEditMode=!0;a.blur();this._blurEditMode=c}this.$div_focus.remove();delete this.$div_focus;a=this.options.editModel;c=h.extend({},a.indices);a.indices=null;this.refreshCell(c)}};b.refreshEditorPos=function(){var a=this.options.editModel,
c=a.cellBorderWidth,d=this.$div_focus,f=this.getCell(a.indices),a=f[0].offsetWidth-(c?2*c:1),p=f[0].offsetHeight-(c?2*c:1),e=this.element.offset(),f=f.offset();d.css({height:p,width:a,borderWidth:c,left:f.left-e.left-1,top:f.top-e.top-1})};b.setEditorPosTimer=function(){var a=this,c=this.options;this._refreshEditorPosTimer&&(window.clearInterval(this._refreshEditorPosTimer),this._refreshEditorPosTimer=null);this._refreshEditorPosTimer=window.setInterval(function(){c.editModel.indices&&a.refreshEditorPos()},
200)};b._onHeaderCellClick=function(a,c){var d=this.colModel[a],f=this.options,p=d.dataIndx;!1!==this._trigger("headerCellClick",c,{column:d,colIndx:a,dataIndx:p})&&f.sortable&&!1!=d.sortable&&this.sort({colIndx:a,column:d,dataIndx:p})};b._selectRow=function(a,c){this.selectRow(a,c)};b._findfirstUnhiddenColIndx=function(){for(var a=0;a<this.colModel.length;a++)if(!this.colModel[a].hidden)return a};b.selectRow=function(a){var c=a.evt;if(c&&("keydown"==c.type||"keypress"==c.type)){if(!1==this.iRows.replace(a))return!1}else if(!1==
this.iRows.add(a))return!1;return!0};b.get$Tbl=function(a,c){var d=this.$tbl,f=[];if(d&&d.length){var p=this.pqpanes,e=this.options,q=e.freezeRows,e=e.freezeCols;p.h&&p.v?null==c?a>=q?f.push(d[2],d[3]):f.push(d[0],d[1]):f=c>=e&&a>=q?d[3]:c<e&&a>=q?d[2]:c>=e&&a<q?d[1]:d[0]:f=p.v?null==c?d:c>=e?d[1]:d[0]:p.h?a>=q?d[1]:d[0]:d[0];if(f)return h(f)}};b.scrollCell=function(a){this.scrollRow(a);this.scrollColumn(a)};b.scrollY=function(a){this.$vscroll.pqScrollBar("option","cur_pos",a).pqScrollBar("scroll")};
b.scrollRow=function(a){this.options.virtualY?this._scrollRowVirtualY(a):this._scrollRowNonVirtualY(a)};b._scrollRowNonVirtualY=function(a){var c=this.options,d=a.rowIndxPage,f=this.iHierarchy?!0:!1,p=a.rowIndx;a=this.$cont.data("offsetHeight")-this._getScollBarHorizontalHeight();d=null==d?p-this.rowIndxOffset:d;c=parseInt(c.freezeRows);if(!(d<c)){var c=this.get$Tbl(d),e=this.getRow({rowIndxPage:d});if(d=e[0]){var p=d.offsetTop+parseInt(c.css("marginTop")),q=d.offsetHeight;f&&(f=e.next("tr.pq-detail-child"))&&
f.length&&(q+=f[0].offsetHeight);d.offsetTop<-1*c[0].offsetTop?(f=-1*d.offsetTop-parseInt(c.css("top")),c.css("marginTop",f),this._syncScrollBarVert()):p+q>=a&&(f=a-q-d.offsetTop,c.css("marginTop",f),this._syncScrollBarVert())}}};b._scrollRowVirtualY=function(a){var c=this.options,d=a.rowIndxPage,f=this.iHierarchy?!0:!1,p=a.rowIndx;a=this.scrollCurPos;d=null==d?p-this.rowIndxOffset:d;p=parseInt(c.freezeRows);if(!(d<p)&&(c=this._calcCurPosFromRowIndxPage(d),null!=c)){c<a&&this.$vscroll.pqScrollBar("option",
"cur_pos",c).pqScrollBar("scroll");var e=this.get$Tbl(d),q=e.children("tbody").children("tr[pq-row-indx="+d+"]"),b=d=q.last();1<q.length&&(b=q.first());var g=d[0],q=parseInt(e.css("marginTop"));if(void 0==g)this.$vscroll.pqScrollBar("option","cur_pos",c).pqScrollBar("scroll");else{var g=g.offsetTop+g.offsetHeight,k=this.$cont[0].offsetHeight,l=this._getScollBarHorizontalHeight(),b=b.prev("tr");if(!b.hasClass("pq-row-hidden")&&!b.hasClass("pq-last-freeze-row")&&g>k-l-q){b=g-(k-l-q);q=e.children().children("tr");
g=e=0;p?(p=q.filter("tr.pq-last-freeze-row").last().next(),0==p.length&&(p=q.filter("tr.pq-row-hidden").next())):p=q.filter("tr.pq-row-hidden").next();do{e+=p[0].offsetHeight;if(p[0]==d[0])break;else if(f&&!1!=p.hasClass("pq-detail-child")||g++,e>=b)break;p=p.next()}while(1);f=a+g;f>c&&(f=c);a=this.$vscroll.pqScrollBar("option","num_eles");a<f+1&&(a=f+1);this.$vscroll.pqScrollBar("option",{num_eles:a,cur_pos:f}).pqScrollBar("scroll")}}}};b.getTableForVertScroll=function(){var a=this.pqpanes,c=this.$tbl;
if(c&&c.length)return a.h&&a.v?c=h([c[2],c[3]]):a.v?c=h([c[0],c[1]]):a.h&&(c=h(c[1])),c};b.getTableForHorScroll=function(){var a=this.pqpanes,c=[],d=this.$tbl;if(d&&d.length)return a.h&&a.v?c.push(d[1],d[3]):a.v?c.push(d[1]):a.h?c.push(d[0],d[1]):c.push(d[0]),this.tables.length&&(d=this.tables[0].$tbl,a.v?c.push(d[1]):c.push(d[0])),h(c)};b.getTableHeaderForHorScroll=function(){var a=this.pqpanes,c=this.$tbl_header;if(c&&c.length)return c=a.v?h(c[1]):h(c[0]),c.parent()};b.blurEditor=function(a){if(this.$div_focus){var c=
this.$div_focus.find(".pq-editor-focus");if(a&&a.blurIfFocus)document.activeElement==c[0]&&c.blur();else return c.triggerHandler("blur",a)}};b._syncViewWithScrollBarVert=function(a){if(null!=a){var c=this.getTableForVertScroll();if(c&&c.length){var d=this.options;d.editModel.indices&&this.blurEditor({force:!0});var f=c.data("offsetHeight"),p=this.$cont.data("offsetHeight")-this._getScollBarHorizontalHeight();a=-1*(f-p)*a-1;if((!f||!p)&&d.debug)throw"_syncViewWithScrollBarVert !tblHt || !contHt";-1<
a&&(a=-1);c.css({marginTop:a})}}};b._syncViewWithScrollBarHor=function(a){if(null!=a){var c=this.getTableForHorScroll(),d=this.getTableHeaderForHorScroll();if(c||d){this.options.editModel.indices&&this.blurEditor({force:!0});var f=(c?c:d).data("scrollWidth"),p=this.$cont.data("offsetWidth")-this._getSBWidth();a*=-1*(f-p);f&&p&&(0<a&&(a=0),c&&c.css("marginLeft",a),d&&d.css("marginLeft",a))}}};b._syncScrollBarVert=function(){var a=this.getTableForVertScroll();if(a&&a.length){var c=a.data("offsetHeight"),
d=this.$cont.data("offsetHeight")-this._getScollBarHorizontalHeight(),c=c-d,a=(-1*parseInt(a.css("marginTop"))-1)/(c-1);0<=a&&1>=a&&this.$vscroll.hasClass("pq-sb-vert")&&this.$vscroll.pqScrollBar("option","ratio",a)}};b._syncScrollBarHor=function(){var a=this.getTableForHorScroll(),c=this.getTableHeaderForHorScroll();if(a||c){var a=a?a:c,c=a.data("scrollWidth"),d=this.$cont.data("offsetWidth")-this._getSBWidth(),c=c-d,a=-1*parseInt(a.css("marginLeft"))/c;0<=a&&1>=a&&this.$hscroll.hasClass("pq-sb-horiz")&&
this.$hscroll.pqScrollBar("option","ratio",a)}};b._scrollColumnNonVirtual=function(a){var c=a.colIndx,c=null==c?this.getColIndx({dataIndx:a.dataIndx}):c,d=this.options.freezeCols;if(!(c<d)){a=this._calcRightEdgeCol(c).width;var c=this._calcRightEdgeCol(c-1).width,d=this._calcRightEdgeCol(d-1).width,f=this._getSBWidth(),p=this.getTableForHorScroll(),e=this.getTableHeaderForHorScroll(),f=this.$cont[0].offsetWidth-f,q,b;if(p)q=parseInt(p.css("marginLeft")),b=p[0].offsetLeft;else if(e)q=parseInt(e.css("marginLeft")),
b=e[0].offsetLeft-d;else return;a+q>f?(q=f-a,p&&p.css("marginLeft",q),e&&e.css("marginLeft",q),this._syncScrollBarHor()):c<-1*b&&(q=-1*c+d,p&&p.css("marginLeft",q),e&&e.css("marginLeft",q),this._syncScrollBarHor())}};b._scrollColumnVirtual=function(a){var c=a.colIndx,c=null==c?this.getColIndx({dataIndx:a.dataIndx}):c;a=this.options.freezeCols;var d=this._calcRightEdgeCol(c).width,f=this._getSBWidth(),p=this.$cont[0].offsetWidth;if(d>p-f){for(var d=l.call(this,-1,c+1)-(p-f),f=this.colModel,p=f.length,
e=0,q=0,b=a;b<p;b++){var g=f[b];g.hidden||(e+=g.outerWidth);if(b==c){q=b-a-this._calcNumHiddenUnFrozens(b);break}else if(e>=d){q=b-a-this._calcNumHiddenUnFrozens(b)+1;break}}this.$hscroll.pqScrollBar("option","cur_pos",q).pqScrollBar("scroll");return!0}return this.hidearrHS[c]?(this.hidearrHS[c]=!1,c=c-a-this._calcNumHiddenUnFrozens(c),this.$hscroll.pqScrollBar("option","cur_pos",c).pqScrollBar("scroll"),!0):!1};b.scrollColumn=function(a){return this.options.virtualX?this._scrollColumnVirtual(a):
this._scrollColumnNonVirtual(a)};b.selection=function(a){var c=a.method,d=a.type;if("row"==d)return this.iRows[c](a);if("cell"==d)return this.iCells[c](a)};b._bringPageIntoView=function(a){a=a.rowIndx;var c=this.options.pageModel;if("local"==c.type&&0<=a){var d=c.curPage,f=c.rPP;a>=(d-1)*f&&a<d*f||(c.curPage=Math.ceil((a+1)/f),this.refreshDataFromDataModel(),this.refresh())}};b.goToPage=function(a){var c=this.options.pageModel;if("local"==c.type||"remote"==c.type){var d=a.rowIndx,f=c.rPP;a=null==
a.page?Math.ceil((d+1)/f):a.page;a!=c.curPage&&(c.curPage=a,"local"==c.type?(this.refreshDataFromDataModel(),this.refresh()):this.refreshDataAndView())}};b.setSelection=function(a){if(null==a)return this.iRows.removeAll({raiseEvent:!0}),this.iCells.removeAll({raiseEvent:!0}),!1;var c=this.data,d,f;if(a.rowData)d=this.getRowIndx(a).rowIndx;else{var p=this.rowIndxOffset;d=a.rowIndx;f=a.rowIndxPage;d=null==d?f+p:d}p=null==a.colIndx&&void 0!==a.dataIndx?this.getColIndx({dataIndx:a.dataIndx}):a.colIndx;
if(0>d||0>p||p>=this.colModel.length||null==c||0==c.length)return!1;a.rowIndx=d;a.colIndx=p;this._bringPageIntoView(a);f=d-this.rowIndxOffset;a.rowIndxPage=f;this.scrollRow({rowIndxPage:f});if(null==p)return this._selectRow(a);this.scrollColumn({colIndx:p});return this.selectCell(a)};b.getColModel=function(){return this.colModel};b.saveEditCell=function(a){var c=this.options,d=c.editModel;if(!d.indices)return null;var f=h.extend({},d.indices),d=a?a.evt:null,p=f.rowIndxPage,e=p+this.rowIndxOffset,
q=this.colModel[f.colIndx],f=q.dataIndx,b=this.data[p],g=c.dataModel,k;if(null==b)return null;k=b[f];if(null!=p){var l=this.getEditCellData();"<br>"==l&&(l="");null==k&&""===l&&(l=null);q={rowIndx:e,rowIndxPage:p,dataIndx:f,column:q,newVal:l,value:l,oldVal:k,rowData:b,dataModel:g};if(!1===this._trigger("cellBeforeSave",d,q))return!1;b={};b[f]=l;if(!1===this.updateRow({row:b,rowIndx:e,refresh:!1,silent:!0,source:"edit",checkEditable:!1}))return!1;this._trigger("cellSave",d,q);c.flexHeight?(this._setGridHeightFromTable(),
this._fixIEFooterIssue()):a&&this.scrollRow({rowIndxPage:p});return!0}};b._digestData=function(a){if(!1===this._trigger("beforeValidate",null,a))return!1;var c=this.options,d=c.editModel,f=c.dataModel.data,p=c.colModel,e=c.pageModel,q=c.historyModel,b=a.validate,b=null==b?d.validate:b,g=e.type,k=a.allowInvalid,k=null==k?d.allowInvalid:k,l=d.invalidClass,m=c.trackModel,d=a.track,d=null==d?null==c.track?m.on:c.track:d,n=a.history,n=null==n?q.on:n,r=a.checkEditable,r=null==r?!0:r,u=a.checkEditableAdd,
u=null==u?r:u,x=this.columns,y=this.colIndxs,D=a.source,q=this.rowIndxOffset,v=h.paramquery.getValueFromDataType,m=a.rowList,B=m.length;f||(f=c.dataModel.data=[]);for(var F=[],I=0;I<B;I++){var E=m[I],H=E.newRow,K=E.rowData,J=E.type,N=E.checkEditable,M=E.rowIndx,S=E.oldRow;null==N&&("update"==J?N=r:"add"==J&&(N=u));if("update"==J){if(!S||!K)throw"assert failed: oldRow and rowData required while update";if(N&&!0!==c.editable&&!1===this.isEditableRow({rowIndx:M,rowData:K}))continue}else if("delete"==
J){F.push(E);continue}if("add"==J)for(var P=0,Q=p.length;P<Q;P++){var R=p[P],L=R.dataIndx;H[L]=H[L]}for(L in H){R=x[L];P=y[L];if(R){if(N&&null!=R.editable&&!1===this.isEditableCell({rowIndx:M,colIndx:P,dataIndx:L})){delete H[L];continue}var P=R.dataType,Q=v(H[L],P),T=K?K[L]:void 0,T=void 0!==T?v(T,P):void 0;H[L]=Q;if(b&&R.validations)if("edit"==D){if(!1==this.isValid({dataIndx:L,rowIndx:M,value:Q}).valid)return!1;this.removeClass({rowData:K,dataIndx:L,cls:l,refresh:!1})}else!1===this.__isValidCell({column:R,
rowData:"add"==J?H:K,value:Q}).valid?!1===k?(delete H[L],"add"==J&&this.addClass({rowData:H,dataIndx:L,cls:l,refresh:!1})):this.addClass({rowData:"add"==J?H:K,dataIndx:L,cls:l,refresh:!1}):this.removeClass({rowData:K,dataIndx:L,cls:l,refresh:!1});if("update"==J&&Q===T){if("edit"==D)return null;delete H[L];continue}}"update"==J&&(S[L]=T)}if(H)if("update"==J)for(L in H){F.push(E);break}else F.push(E)}m=a.rowList=F;B=m.length;if(!B)return!1;n&&(this.iHistory.increment(),this.iHistory.push({rowList:m}));
for(I=0;I<B;I++)if(E=m[I],J=E.type,H=E.newRow,M=E.rowIndx,c=E.rowIndxPage,K=E.rowData,"update"==J)for(L in d&&this.iUCData.update({rowData:K,row:H,refresh:!1}),H)Q=H[L],K[L]=Q;else if("add"==J)d&&this.iUCData.add({rowData:H}),null==M&&null==c?f.push(H):(c=M-q,c="remote"==g?c:M,f.splice(c,0,H)),"remote"==g&&e.totalRecords++;else if("delete"==J){M=this.getRowIndx({rowData:K}).rowIndx;if(d)this.iUCData["delete"]({rowIndx:M,rowData:K});c=M-q;c="remote"==g?c:M;(c=f.splice(c,1))&&c.length&&"remote"==g&&
e.totalRecords--}this._trigger("change",null,a);return!0};b._fixTableViewPort=function(){var a=this.element[0];a.scrollTop=0;a.scrollLeft=0;a=this.$header_o[0];a.scrollLeft=0;a.scrollTop=0;this.iGenerateView.setPanes()};b._fixIEFooterIssue=function(){h(".pq-grid-footer").css({position:"absolute"});h(".pq-grid-footer").css({position:"relative"})};b.refreshColumn=function(a){var c=this.colModel,d=a.colIndx,f=a.dataIndx,d=null==d?this.getColIndx({dataIndx:f}):d,f=null==f?c[d]:f,p=this.rowIndxOffset;
a.colIndx=d;for(var e=this.initV,q=this.finalV,b=e;b<=q;b++){var g=b;a.rowIndx=g+p;a.rowIndxPage=g;a.colIndx=d;a.column=c[d];a.skip=!0;this.refreshCell(a)}this._fixTableViewPort();this._refreshScrollbars();this._trigger("refreshColumn",null,{dataModel:this.options.dataModel,colModel:c,initV:e,finalV:q,colIndx:d,dataIndx:f})};b.refreshCell=function(a){if(this.data){var c=this.rowIndxOffset,d=a.skip,f=a.rowIndx,p=a.rowIndxPage,f=a.rowIndx=null==f?p+c:f,p=a.rowIndxPage=null==p?f-c:p,c=a.dataIndx,e=a.colIndx,
e=a.colIndx=null==e?this.getColIndx({dataIndx:c}):e,q=this.getCell({all:!0,rowIndxPage:p,colIndx:e}),b=a.column,g=this.colModel;a.column=b?b:g[e];var k=this.options.treeModel;if(b=this.data[p])a.tree=k.labelIndx?!0:!1,a.rowData=b,q&&0<q.length&&(a=this.iGenerateView.renderCell(a),q.replaceWith(a),d||(this._fixTableViewPort(),this._refreshScrollbars(),this._trigger("refreshCell",null,{dataModel:this.options.dataModel,colModel:g,rowData:b,rowIndx:f,rowIndxPage:p,colIndx:e,dataIndx:c})))}};b.refreshRow=
function(a){if(this.data){var c=this.rowIndxOffset,d=a.rowIndx;a=a.rowIndxPage;d=null==d?a+c:d;a=null==a?d-c:a;var c=this.getRow({all:!0,rowIndxPage:a}),f=this.colModel,p=this.data[a],e=!1,q=document.activeElement;h(q);if(q==c[0]||1<c.length&&q==c[1])e=!0;if(!p||!c||!c.length)return null;q=[];this.iGenerateView.refreshRow(a,f,q);f=q.join("");c.replaceWith(f);this._fixTableViewPort();this._refreshScrollbars();e&&this.getRow({all:!0,rowIndxPage:a}).attr("tabindex",0).focus();this._trigger("refreshRow",
null,{rowData:p,rowIndx:d,rowIndxPage:a});return!0}};b.quitEditMode=function(a){if(!this._quitEditMode){var c=!1,d=!1,f=!1,p=this.options.editModel,e=p.indices,q=void 0;this._quitEditMode=!0;a&&(c=a.old,d=a.silent,f=a.fireOnly,q=a.evt);e&&(d||c||this._trigger("editorEnd",q,e),f||(this._removeCellRowOutline(a),p.indices=null));this._quitEditMode=null}};b._fixIE=function(){var a=this.$cont[0];a.scrollLeft=0;a.scrollTop=0};b.getData=function(){return this.data};b.getViewPortRowsIndx=function(){return{beginIndx:this.initV,
endIndx:this.finalV}};b.getViewPortIndx=function(){return{initV:this.initV,finalV:this.finalV,initH:this.initH,finalH:this.finalH}};b.getRowIndxOffset=function(){return this.rowIndxOffset};b.selectCell=function(a){var c=a.evt;if(c&&("keydown"==c.type||"keypress"==c.type)){if(!1==this.iCells.replace(a))return!1}else if(!1===this.iCells.add(a))return!1;return!0};b.getEditCell=function(){var a=this.options.editModel;if(a.indices){var a=this.getCell(a.indices),c=this.$div_focus.children(".pq-editor-inner"),
d=c.find(".pq-editor-focus");return{$td:a,$cell:c,$editor:d}}return null};b.editCell=function(a){this.scrollRow(a);this.scrollColumn(a);var c=this.getCell(a);if(c&&c.length)return this._editCell(a)};b.getFirstEditableColIndx=function(a){if(null==a.rowIndx)throw"rowIndx NA";if(!this.isEditableRow(a))return-1;for(var c=this.colModel,d=0;d<c.length;d++)if(a.colIndx=d,this.isEditableCell(a)&&!c[d].hidden)return d;return-1};b.editFirstCellInRow=function(a){var c=this.rowIndxOffset,d=a.rowIndx;a=a.rowIndxPage;
d=null==d?a+c:d;a=null==a?d-c:a;c=this.getFirstEditableColIndx({rowIndx:d});-1!=c&&this.editCell({rowIndxPage:a,colIndx:c})};b._editCell=function(a){var c=this,d=a.evt,f=this.rowIndxOffset,p=a.rowIndxPage,e=a.rowIndx,e=null==e?p+f:e,p=null==p?e-f:p,f=a.colIndx;a=a.dataIndx;var f=null==f?this.getColIndx({dataIndx:a}):f,q=this.colModel[f];a=q.dataIndx;var b=q.editor,g=this.options,k=g.editModel,g=g.editor,l=b?h.extend({},g,b):g,b=c.data[p],g=!1;if(k.indices){var m=k.indices;if(m.rowIndxPage==p&&m.colIndx==
f){this.refreshEditorPos();var n=this.$div_focus.find(".pq-editor-focus");window.setTimeout(function(){n.focus()},0);return!1}if(!1===this.blurEditor({evt:d}))return!1;this.quitEditMode({evt:d})}k.indices={rowIndxPage:p,rowIndx:e,colIndx:f,column:q,dataIndx:a};this._generateCellRowOutline();m=this.$div_focus.children(".pq-editor-inner");"right"==q.align?m.addClass("pq-align-right"):"center"==q.align?m.addClass("pq-align-center"):m.addClass("pq-align-left");var r=b[a],u=l.type,x=l.select,y=l.init,
D="pq-editor-focus "+(l.cls?l.cls:""),v=D+" pq-cell-editor ",B=l.attr?l.attr:"",F=l.style,I=(F=F?F:"")?"style='"+F+"'":"",E=m.width()-8,H="style='width:"+E+"px;"+F+"'",K=F?"style='"+F+"'":"",F={rowIndx:e,rowIndxPage:p,$cell:m,cellData:r,rowData:b,cls:D,dataIndx:a,column:q};"function"==typeof u?l=u.call(c.element[0],F):"checkbox"==u?(l=l.subtype,m.html("<input "+(r?"checked='checked'":"")+" class='"+v+"' "+B+" "+K+" type=checkbox name='"+a+"' />"),E=m.children("input"),"triple"==l&&(E.pqval({val:r}),
m.click(function(c){h(this).children("input").pqval({incr:!0})}))):"textarea"==u||"select"==u||"textbox"==u?("textarea"==u?l="<textarea class='"+v+"' "+B+" "+H+" name='"+a+"' ></textarea>":"select"==u?(u=(u=l.options)?u:[],"function"===typeof u&&(u=u.call(c.element[0],{column:q,rowData:b})),v=[B," class='",v,"' ",H," name='",a,"'"].join(""),l=h.paramquery.select({options:u,attr:v,prepend:l.prepend,labelIndx:l.labelIndx,valueIndx:l.valueIndx,groupIndx:l.groupIndx})):l="<input class='"+v+"' "+B+" "+
H+" type=text name='"+a+"' />",h(l).appendTo(m).width(E).val(r)):(m.html("<div contenteditable='true' tabindx='0' "+I+" "+B+" class='pq-editor-default "+D+"'></div>"),m.children().html(r),g=!0);"function"==typeof y&&y.call(c.element[0],F);var c=this,n=m.children(".pq-editor-focus"),J=k.filterKeys;(r=q.editModel)&&void 0!==r.filterKeys&&(J=r.filterKeys);var N={$cell:m,$editor:n,dataIndx:a,column:q,colIndx:f,rowIndx:e,rowIndxPage:p,rowData:b};k.indices=N;n.data({FK:J}).on("click",function(c){h(this).focus()}).on("keydown",
function(a){c.iKeyNav._keyDownInEdit(a)}).on("keypress",function(a){return c.iKeyNav._keyPressInEdit(a,{FK:J})}).on("keyup",function(a){return c.iKeyNav._keyUpInEdit(a,{FK:J})}).on("blur",function(a,d){var f=c.options.editModel,p=f.onBlur,e="save"==p,b="validate"==p,q=f.cancelBlurCls,s=d?d.force:!1;if(!c._quitEditMode&&!c._blurEditMode&&f.indices){f=h(a.target);if(!s){if(!1===c._trigger("editorBlur",a,N)||!p||q&&f.hasClass(q))return;if(f.hasClass("hasDatepicker")){if(f.datepicker("widget").is(":visible"))return!1}else if(f.hasClass("ui-autocomplete-input")&&
f.autocomplete("widget").is(":visible"))return}c._blurEditMode=!0;if(!c.saveEditCell({evt:a,silent:s||e||!b})&&!s&&b)return c._deleteBlurEditMode(),!1;c.quitEditMode({evt:a});c._deleteBlurEditMode()}}).on("focus",function(a){c._trigger("editorFocus",a,N)});c._trigger("editorBegin",d,N);n.focus();window.setTimeout(function(){!1===h(document.activeElement).hasClass("pq-editor-focus")&&c.element.find(".pq-editor-focus").focus()},0);c.element[0].scrollLeft=0;c.element[0].scrollTop=0;if(x)if(g)try{var M=
n[0],S=document.createRange();S.selectNodeContents(M);var P=window.getSelection();P.removeAllRanges();P.addRange(S)}catch(Q){}else n.select()};b._deleteBlurEditMode=function(a){var c=this;a=a?a:{};c._blurEditMode&&(a.timer?window.setTimeout(function(){delete c._blurEditMode},0):delete c._blurEditMode)};b.getRow=function(a){var c=a.rowIndxPage,d=a.rowIndx,f=this.rowIndxOffset,c=null==c?d-f:c;a=a.all?this.$tbl:this.get$Tbl(c);var p;a&&a.length&&(d=a.children("tbody"),null!=c&&(p=d.children("tr[pq-row-indx="+
c+"]"),p.length>a.length&&(p=p.filter(".pq-detail-master"))));return p};b.getCell=function(a){var c=a.rowIndxPage,d=a.rowIndx,c=null==c?d-this.rowIndxOffset:c,d=a.colIndx,f=a.dataIndx,d=null==d?this.getColIndx({dataIndx:f}):d;a=a.all?this.$tbl:this.get$Tbl(c,d);var p;return void 0!=a&&(p=a.children().children("tr[pq-row-indx="+c+"]").children("td[pq-col-indx="+d+"]"),0==p.length)?null:p};b.getCellHeader=function(a){var c=a.colIndx;a=a.dataIndx;c=null==c?this.getColIndx({dataIndx:a}):c;a=this.$tbl_header;
var d,f=this.options.freezeCols;void 0!=a&&(1<a.length&&(a=c>=f?h(a[1]):h(a[0])),d=a.children().children("tr.pq-grid-title-row:last").children("td[pq-col-indx="+c+"]"));return 0==d.length||"hidden"==d[0].style.visibility?null:d};b.getEditorIndices=function(){var a=this.options.editModel.indices;return a?h.extend({},a):null};b.getEditCellData=function(){var a=this.options,c=a.editModel.indices;if(!c)return null;var d=c.rowIndxPage,f=c.rowIndx,c=this.colModel[c.colIndx],p=c.editor,a=a.editor,a=p?h.extend({},
a,p):a,e=c.dataIndx,p=this.$div_focus.children(".pq-editor-inner"),b;"function"==typeof a.getData?b=a.getData.call(this.element[0],{$cell:p,dataIndx:e,rowIndx:f,rowIndxPage:d,column:c}):(d=a.type,"checkbox"==d?(b=p.children(),b="triple"==a.subtype?b.pqval():b.is(":checked")?!0:!1):"contenteditable"==d?b=p.children().html():(d=p.find('*[name="'+e+'"]'))&&d.length?b=d.val():(d=p.find(".pq-editor-focus"))&&d.length&&(b=d.val()));return b};b.getCellIndices=function(a){var c=a.$td;if(null==c||0==c.length||
c.closest(".pq-grid")[0]!=this.element[0])return{rowIndxPage:null,colIndx:null};a=c.parent("tr").attr("pq-row-indx");var d;null!=a&&(a=parseInt(a),d=a+this.rowIndxOffset);var c=c.attr("pq-col-indx"),f;null!=c&&(c=parseInt(c),f=this.colModel[c].dataIndx);return{rowIndxPage:a,rowIndx:d,colIndx:c,dataIndx:f}};b.getRowsByClass=function(a){var c=this.options,d="remote"==c.pageModel.type?!0:!1,f=this.rowIndxOffset,c=c.dataModel.data,p=[];if(null==c)return p;for(var e=0,b=c.length;e<b;e++){var g=c[e];a.rowData=
g;this.hasClass(a)&&(g={rowData:g},g.rowIndx=d?e+f:e,p.push(g))}return p};b.getCellsByClass=function(a){var c=this.options,d="remote"==c.pageModel.type?!0:!1,f=this.rowIndxOffset,c=c.dataModel.data,p=this.colModel,e=p.length,b=[],g=function(c){for(var a=0;a<e;a++){var g=p[a].dataIndx;c.dataIndx=g;this.hasClass(c)&&(g={rowData:m,dataIndx:g,colIndx:a},g.rowIndx=d?k+f:k,b.push(g))}};if(null==c)return b;if(null!=a.rowIndx||null!=a.rowIndxPage||null!=a.rowData)a.rowData=a.rowData||this.getRowData(a),g(a);
else for(var k=0,l=c.length;k<l;k++){var m=c[k];a.rowData=m;g(a)}return b};b.addClass=function(a){var c=a.rowIndx,d=a.dataIndx,f=a.cls,p=this.rowIndxOffset,e=a.refresh;if(a=a.rowData||this.getRowData(a)){!1!==e&&null==c&&(c=this.getRowIndx({rowData:a}).rowIndx);for(var f=f.split(" "),b=[],g=0;g<f.length;g++){var k=f[g];if(null==d){if(!1===this.hasClass({rowData:a,cls:k})){var l=a.pq_rowcls;a.pq_rowcls=l?h.trim(l)+" "+k:k;!1!==e&&null!=c&&(l=this.getRow({rowIndxPage:c-p}))&&l.addClass(k)}}else{"function"!=
typeof d.push?b.push(d):b=d;for(var l=0,m=b.length;l<m;l++)if(d=b[l],!1===this.hasClass({rowData:a,dataIndx:d,cls:k})){var n=a.pq_cellcls;if(n){var r=n[d];n[d]=r?h.trim(r)+" "+k:k}else n={},n[d]=k,a.pq_cellcls=n;!1!==e&&null!=c&&(n=this.getCell({rowIndxPage:c-p,dataIndx:d}))&&n.addClass(k)}}}}};b.removeClass=function(a){var c=a.rowIndx,d=this.getRowData(a),f=a.dataIndx,p=a.cls;a=a.refresh;var e=null!=f&&d?d.pq_cellcls:null,b=d?d.pq_rowcls:null;if(null!=d)if(!1!==a&&null==c&&(c=this.getRowIndx({rowData:d}).rowIndx),
null==f)b&&(d.pq_rowcls=this._removeClass(b,p),null!=c&&!1!==a&&(c=this.getRow({rowIndx:c}))&&c.removeClass(p));else if(e&&e){b=[];"function"!=typeof f.push?b.push(f):b=f;for(var g=0,k=b.length;g<k;g++){var f=b[g],l=e[f];l&&(d.pq_cellcls[f]=this._removeClass(l,p),null!=c&&!1!==a&&(f=this.getCell({rowIndx:c,dataIndx:f}))&&f.removeClass(p))}}};b.hasClass=function(a){var c=a.dataIndx,d=a.cls;a=this.getRowData(a);d=new RegExp("\\b"+d+"\\b");return a?null==c?(c=a.pq_rowcls)&&d.test(c)?!0:!1:(a=a.pq_cellcls)&&
a[c]&&d.test(a[c])?!0:!1:null};b._removeClass=function(a,c){if(a){for(var d=a.split(" "),f=c.split(" "),p=[],e=0,b=d.length;e<b;e++){for(var g=d[e],k=!1,l=0,m=f.length;l<m;l++)if(g===f[l]){k=!0;break}k||p.push(g)}return 1<p.length?p.join(" "):1===p.length?p[0]:null}};b.getRowIndx=function(a){var c=a.$tr;if(a=a.rowData){var d=this.options,c="remote"==d.pageModel.type?!0:!1,d=d.dataModel.data,f=!1;if(d)for(var p=0,e=d.length;p<e;p++)if(d[p]==a){f=!0;break}return f?(a=this.rowIndxOffset,{rowIndxPage:c?
p:p-a,rowIndx:c?p+a:p}):{}}if(null==c||0==c.length)return{rowIndxPage:null};p=c.attr("pq-row-indx");if(null==p)return{rowIndxPage:null};p=parseInt(p);return{rowIndxPage:p,rowIndx:p+this.rowIndxOffset}};var e=function(a){this.options=a.options;this.that=a;var c=this,d=a.widgetEventPrefix.toLowerCase();a.element.on(d+"celleditkeyup"+a.eventNamespace,function(a,d){return c.filterKeys(a,d)})},g=e.prototype;g._incrRowIndx=function(a,c){var d=this.that,f=a;c=null==c?1:c;for(var d=d.data,p=0,e=a+1,b=d.length;e<
b&&(d[e].pq_hidden||(p++,f=e,p!=c));e++);return f};g._decrRowIndx=function(a,c){var d=a,f=this.that.data;c=null==c?1:c;for(var p=0,e=a-1;0<=e&&(f[e].pq_hidden||(p++,d=e,p!=c));e--);return d};b.addColumn=function(a,c){var d=this.options,f=d.dataModel.data;d.colModel.push(a);this._calcThisColModel();for(d=0;d<f.length;d++)f[d].push("")};b.rowNextSelect=function(){var a=this.selection({type:"row",method:"getSelection"}),c,d=this.rowIndxOffset;a&&a[0]&&(a=a[0].rowIndx,c=this.iKeyNav._incrRowIndx(a-d));
null!=c&&(this.setSelection(null),this._setSelection({rowIndxPage:c}));return c};b.rowPrevSelect=function(){var a=this.selection({type:"row",method:"getSelection"}),c,d=this.rowIndxOffset;a&&a[0]&&(a=a[0].rowIndx,c=this.iKeyNav._decrRowIndx(a-d));null!=c&&(this.setSelection(null),this.setSelection({rowIndxPage:c}));return c};g._incrIndx=function(a,c){var d=this.that,f=d._getLastVisibleRowIndxPage(d.data),d=d.colModel,p=d.length;if(null==c){if(a==f)return null;a=this._incrRowIndx(a);return{rowIndxPage:a}}var e;
do{c++;if(c>=p){if(a==f)return null;a=this._incrRowIndx(a);c=0}e=d[c]}while(e&&e.hidden);return{rowIndxPage:a,colIndx:c}};g._decrIndx=function(a,c){var d=this.that,f=d.colModel,e=f.length,d=d._getFirstVisibleRowIndxPage(d.data);if(null==c){if(a==d)return null;a=this._decrRowIndx(a);return{rowIndxPage:a}}var b;do{c--;if(0>c){if(a==d)return null;a=this._decrRowIndx(a);c=e-1}b=f[c]}while(b&&b.hidden);return{rowIndxPage:a,colIndx:c}};g._incrEditIndx=function(a,c){var d=this.that,f=d.colModel,e=f.length,
b,q=d.rowIndxOffset,g=d._getLastVisibleRowIndxPage(d.data);do{c++;if(c>=e){if(a==g)return null;do{a=this._incrRowIndx(a);var k=a+q;b=d.isEditableRow({rowIndx:k});if(a==g&&!1==b)return null}while(!1==b);c=0}b=f[c];k=a+q;k=d.isEditableCell({rowIndx:k,colIndx:c,checkVisible:!0})}while(b&&(b.hidden||!1==k));return{rowIndxPage:a,colIndx:c}};g._decrEditIndx=function(a,c){var d=this.that,f=d.colModel,e=f.length,b,q=d.rowIndxOffset,g=d._getFirstVisibleRowIndxPage(d.data);do{c--;if(0>c){if(a==g)return null;
do{a=this._decrRowIndx(a);var k=a+q;b=d.isEditableRow({rowIndx:k});if(a==g&&!1==b)return null}while(!1==b);c=e-1}b=f[c];k=a+q;k=d.isEditableCell({rowIndx:k,colIndx:c,checkVisible:!0})}while(b&&(b.hidden||!1==k));return{rowIndxPage:a,colIndx:c}};g._incrEditRowIndx=function(a,c){var d=this.that,f=d.rowIndxOffset,e=d._getLastVisibleRowIndxPage(d.data);if(a==e)return null;do{a=this._incrRowIndx(a);var b=a+f,q=d.isEditableRow({rowIndx:b}),b=d.isEditableCell({rowIndx:b,colIndx:c}),q=q&&b;if(a==e&&!q)return null}while(!q);
return{rowIndxPage:a,colIndx:c}};g._decrEditRowIndx=function(a,c){var d=this.that,f=d.rowIndxOffset,e=d._getFirstVisibleRowIndxPage(d.data);if(a==e)return null;do{a=this._decrRowIndx(a);var b=a+f,q=d.isEditableRow({rowIndx:b}),b=d.isEditableCell({rowIndx:b,colIndx:c}),q=q&&b;if(a==e&&!q)return null}while(!q);return{rowIndxPage:a,colIndx:c}};b._onKeyPressDown=function(a){if(0<h(a.target).closest(".pq-grid-header").length)return!1==this._trigger("headerKeyDown",a,{dataModel:this.options.dataModel})?
!1:!0;if(!1===this.iKeyNav._bodyKeyPressDown(a)||!1==this._trigger("keyDown",a,{dataModel:this.options.dataModel}))return!1};g._saveAndMove=function(a,c){if(null==a)return c.preventDefault(),!1;var d=this.that,f=this.options.selectionModel,e=a.rowIndxPage,b=a.colIndx;d._blurEditMode=!0;if(!1===d.saveEditCell({evt:c}))return d._deleteBlurEditMode({timer:!0,msg:"_saveAndMove saveEditCell"}),c.preventDefault(),!1;d.quitEditMode(c);"row"==f.type?(d.setSelection(null),d.setSelection({rowIndxPage:e}),d.scrollColumn({colIndx:b})):
"cell"==f.type?(d.setSelection(null),d.setSelection({rowIndxPage:e,colIndx:b})):(d.scrollRow({rowIndxPage:e}),d.scrollColumn({colIndx:b}));!1!==a.edit&&d._editCell({rowIndxPage:e,colIndx:b});d._deleteBlurEditMode({timer:!0,msg:"_saveAndMove"});c.preventDefault();return!1};g._keyPressInEdit=function(a,c){var d=this.that,f=d.options.editModel.indices;c=c?c:{};var e=c.FK,b=f.column.dataType;if(!1===d._trigger("editorKeyPress",a,h.extend({},f))||e&&("float"==b||"integer"==b)&&(d="float"==b?"0123456789.-":
"0123456789-",f=(f=a.charCode)?f:a.keyCode,(f=String.fromCharCode(f))&&-1==d.indexOf(f)))return!1};g.getValText=function(a){a=a[0].nodeName.toLowerCase();var c="text";-1!=h.inArray(a,["input","textarea","select"])&&(c="val");return c};g._keyUpInEdit=function(a,c){var d=this.that,f=d.options;c=c?c:{};var e=c.FK,f=f.editModel,b=f.indices;d._trigger("editorKeyUp",a,h.extend({},b));d=b.column.dataType;if(e&&("float"==d||"integer"==d)){var e=h(a.target),b="integer"==d?f.reInt:f.reFloat,f=this.getValText(e),
q=e.data("oldVal"),g=e[f]();if(!1==b.test(g))if(b.test(q))e[f](q);else if(d="float"==d?parseFloat(q):parseInt(q),isNaN(d))e[f](0);else e[f](d)}};g._keyDownInEdit=function(a){var c=this.that,d=c.options,f=d.editModel.indices;if(f){var e=h(a.target),b=h.ui.keyCode,q=d.selectionModel,g=d.editModel,f=h.extend({},f),d=f.rowIndxPage,k=f.colIndx,l=f.column.editModel,g=l?h.extend({},g,l):g,l=this.getValText(e);e.data("oldVal",e[l]());if(!1==c._trigger("cellEditKeyDown",a,f)||!1==c._trigger("editorKeyDown",
a,f))return!1;if(a.keyCode==b.TAB)return f=a.shiftKey?this._decrEditIndx(d,k):this._incrEditIndx(d,k),null==f&&(f={rowIndxPage:d,colIndx:k}),this._saveAndMove(f,a);if(a.keyCode==g.saveKey)return f={rowIndxPage:d,colIndx:k,edit:!1},this._saveAndMove(f,a);if(a.keyCode==b.ESCAPE)return c.quitEditMode({evt:a}),"cell"==q.type?c.getCell({rowIndxPage:d,colIndx:k}).attr("tabindex",0).focus():"row"==q.type&&(c=c.getRow({rowIndxPage:d}),h(c[0]).attr("tabindex",0).focus()),a.preventDefault(),!1;if(a.keyCode==
b.PAGE_UP||a.keyCode==b.PAGE_DOWN)return a.preventDefault(),!1;if(g.keyUpDown){if(a.keyCode==b.DOWN)return f=this._incrEditRowIndx(d,k),this._saveAndMove(f,a);if(a.keyCode==b.UP)return f=this._decrEditRowIndx(d,k),this._saveAndMove(f,a)}}};g.select=function(a){var c=this.that,d=a.rowIndx,f=a.colIndx,e=c.options.selectionModel;a=a.evt;a.shiftKey&&"single"!=e.mode?"row"==e.type?(c.scrollRow({rowIndx:d}),c.iRows.extendSelection({rowIndx:d,evt:a})):"cell"==e.type&&(c.scrollCell({rowIndx:d,colIndx:f}),
c.iCells.extendSelection({rowIndx:d,colIndx:f,evt:a})):c.setSelection({rowIndx:d,colIndx:f,evt:a,setFirst:!0})};g._bodyKeyPressDown=function(a){var c=this.that,d,f,e=c.rowIndxOffset,b=this.options,q=c.colModel,g=b.selectionModel,k,l,m=h.ui.keyCode;if(b.editModel.indices)c.$div_focus.find(".pq-cell-focus").focus();else{if("row"==g.type){f=a.ctrlKey?c.iRows.getFocusSelection({old:!0}):c.iRows.getFocusSelection({old:!1});if(null==f)return;k=f.rowIndx;b=k-e;if(null==k)return;if(!1==c._trigger("rowKeyDown",
a,{rowData:c.data[b],rowIndx:k,rowIndxPage:b}))return!1}else if("cell"==g.type){d=a.ctrlKey?c.iCells.getFocusSelection({old:!0}):c.iCells.getFocusSelection({old:!1});if(null==d)return;l=d;k=l.rowIndx;var b=k-e,n=l.dataIndx;l=c.getColIndx({dataIndx:n});if(null==k||null==l)return;if(!1==c._trigger("cellKeyDown",a,{rowData:c.data[b],rowIndx:k,rowIndxPage:b,colIndx:l,dataIndx:n,column:q[l]}))return!1;if(a.cancelBubble)return}else return;if(a.keyCode==m.LEFT){if(l=this._decrIndx(b,l))k=l.rowIndxPage+e,
this.select({rowIndx:k,colIndx:l.colIndx,evt:a});a.preventDefault()}else if(a.keyCode==m.RIGHT){if(l=this._incrIndx(b,l))k=l.rowIndxPage+e,this.select({rowIndx:k,colIndx:l.colIndx,evt:a});a.preventDefault()}else if(a.keyCode==m.UP)b=this._decrRowIndx(b),null!=b&&this.select({rowIndx:b+e,colIndx:l,evt:a}),a.preventDefault();else if(a.keyCode==m.DOWN)b=this._incrRowIndx(b),null!=b&&this.select({rowIndx:b+e,colIndx:l,evt:a}),a.preventDefault();else if(a.keyCode==m.PAGE_DOWN||a.keyCode==m.SPACE){if(c=
this.pageDown(b))b=c.rowIndxPage,null!=b&&this.select({rowIndx:b+e,colIndx:l,evt:a});a.preventDefault()}else if(a.keyCode==m.PAGE_UP){if(c=this.pageUp(b))b=c.rowIndxPage,null!=b&&this.select({rowIndx:b+e,colIndx:l,evt:a});a.preventDefault()}else a.keyCode==m.HOME?("row"==g.type||a.ctrlKey?(k=c._getFirstVisibleRowIndxPage(c.data)+e,this.select({rowIndx:k,colIndx:l,evt:a})):"cell"==g.type&&(l=c._getFirstVisibleColIndx(),this.select({rowIndx:k,colIndx:l,evt:a})),a.preventDefault()):a.keyCode==m.END?
("row"==g.type||a.ctrlKey?(k=c._getLastVisibleRowIndxPage(c.data)+e,this.select({rowIndx:k,colIndx:l,evt:a})):"cell"==g.type&&(l=c._getLastVisibleColIndx(),this.select({rowIndx:k,colIndx:l,evt:a})),a.preventDefault()):a.keyCode==m.ENTER?("row"==g.type?null!=f&&c.editFirstCellInRow({rowIndx:b+e}):null!=d&&(d=c.getCell({rowIndxPage:b,colIndx:l}))&&0<d.length&&(k=b+e,e=c.isEditableRow({rowIndx:k}),d=c.isEditableCell({rowIndx:k,colIndx:l}),e&&d&&c.editCell({rowIndxPage:b,colIndx:l})),a.preventDefault()):
a.ctrlKey&&"65"==a.keyCode&&("row"==g.type&&"single"!=g.mode?c.iRows.selectAll({all:g.all}):"cell"==g.type&&"single"!=g.mode&&c.iCells.selectAll({all:g.all}),a.preventDefault())}};g.incrPageSize=function(){for(var a=this.that,c=a.$tbl,d=c.children("tbody").children("tr.pq-grid-row").not(".pq-group-row,.pq-summary-row"),f=a.$cont[0].offsetHeight,c=parseInt(c.css("marginTop")),e=a._getScollBarHorizontalHeight(),f=f-e-c,c=d.length-1;0<=c;c--){var b=d[c];if(b.offsetTop<f)break}return{rowIndxPage:a.getRowIndx({$tr:h(b)}).rowIndxPage}};
g.pageNonVirtual=function(a,c){var d=this.that,f=d.$cont[0].offsetHeight-d._getScollBarHorizontalHeight(),e=d.getRow({rowIndxPage:a}),b=0,q=0,g=h(e[0])[c]("tr.pq-grid-row"),k=g.length;if(0<k){do{e=g[q];b+=e.offsetHeight;if(b>=f)break;q++}while(q<k);q=0<q?q-1:q;do if(e=h(g[q]),a=d.getRowIndx({$tr:e}).rowIndxPage,null!=a)break;else q--;while(0<=q)}return a};g.pageDown=function(a){var c=this.that,d=c.options,f=c.$vscroll.pqScrollBar("option"),e=f.cur_pos,b=f.num_eles,f=f.ratio;if(d.virtualY){if(e<b-
1){a=this.incrPageSize().rowIndxPage;var q=c._calcCurPosFromRowIndxPage(a);if(null==q)return;c.$vscroll.pqScrollBar("option","cur_pos",q).pqScrollBar("scroll")}}else null!=a?a=this.pageNonVirtual(a,"nextAll"):1>f&&(d=c.$cont.data("offsetHeight")-c._getScollBarHorizontalHeight(),c.iMouseSelection.updateTableY(-1*d),c._syncScrollBarVert());return{rowIndxPage:a,curPos:q}};g.pageUp=function(a){var c=this.that,d=c.options,f=c.$vscroll.pqScrollBar("option"),e=f.cur_pos,f=f.ratio;if(d.virtualY){if(0<e){a=
this.decrPageSize().rowIndxPage;var b=c._calcCurPosFromRowIndxPage(a);if(null==b)return;c.$vscroll.pqScrollBar("option","cur_pos",b).pqScrollBar("scroll")}}else null!=a?a=this.pageNonVirtual(a,"prevAll"):0<f&&(d=c.$cont[0].offsetHeight-c._getScollBarHorizontalHeight(),c.iMouseSelection.updateTableY(d),c._syncScrollBarVert());return{rowIndxPage:a,curPos:b}};g.decrPageSize=function(){var a=this.that,c=a.$tbl.children("tbody").children("tr.pq-grid-row").not(".pq-group-row,.pq-summary-row"),d=a.options.freezeRows,
f=0;if(c.length){var e;d?(e=c.filter("tr.pq-last-freeze-row"),e.length&&(e=e.next())):2<=c.length&&(e=h(c[1]));e&&e.length&&(f=a.getRowIndx({$tr:e}).rowIndxPage,f=f-a.pageSize+4,0>f&&(f=0))}return{rowIndxPage:f}};b._calcNumHiddenFrozens=function(){for(var a=0,c=this.options.freezeCols,d=0;d<c;d++)this.colModel[d].hidden&&a++;return a};b._calcNumHiddenUnFrozens=function(a){var c=0;a=null!=a?a:this.colModel.length;for(var d=this.options.freezeCols;d<a;d++)this.colModel[d].hidden&&c++;return c};b._setScrollHLength=
function(){if(this.options.scrollModel.horizontal){this.$hscroll.css("visibility","");this.$hvscroll.css("visibility","");var a=this.$cont[0].offsetWidth,c=this._getSBWidth();0==c?this.$hscroll.css("right",0):this.$hscroll.css("right","");this.$hscroll.pqScrollBar("option","length",a-c)}else this.$hscroll.css("visibility","hidden"),this.$hvscroll.css("visibility","hidden")};b._setScrollHNumEles=function(){var a=this.options,c=a.scrollModel,d=0;a.flexWidth||(d="fullScroll"==c.lastColumn?this.colModel.length-
a.freezeCols-this._calcNumHiddenUnFrozens():this.calcColsOutsideCont(this.colModel)+1);this.$hscroll.pqScrollBar("option","num_eles",d)};b.calcColsOutsideCont=function(a){var c=this.options.numberCell,d=this.$tbl?this.$tbl[this.$tbl.length-1]:null,d=d?d.scrollWidth:0,f=this.options.freezeCols,e=this.$cont[0].offsetWidth-this._getSBWidth(),d=0;c.show&&(d+=c.outerWidth);for(c=0;c<a.length;c++){var b=a[c];b.hidden||(d+=b.outerWidth)}var q=0,g=0;d>e&&g++;for(c=f;c<a.length;c++)if(b=a[c],!b.hidden)if(q+=
b.outerWidth,f=d-q,f>e)g++;else break;return g};b._getScollBarHorizontalHeight=function(){var a=17,c=this.$hscroll;if("hidden"==c.css("visibility")||!1==this.options.scrollModel.horizontal||"none"==c.css("display"))a=0;return a};b._getSBWidth=function(){var a=17,c=this.$vscroll;if(null==this.initV||"hidden"==c.css("visibility")||this.options.flexHeight||"none"==c.css("display"))a=0;return a};b._setScrollVNumEles=function(a){var c=this.iHierarchy?!0:!1,d=this.$vscroll.pqScrollBar("option"),f=parseInt(d.num_eles),
e=parseInt(d.cur_pos),d=this.options,f=this._getScollBarHorizontalHeight(),f=this.$cont[0].offsetHeight-f+1,d=(d.groupModel?this.dataGM:this.data)?this.totalVisibleRows:0,b,q=0;this.$tbl&&0<this.$tbl.length&&(b=this.$tbl[this.$tbl.length-1],q=b.offsetHeight,b=h(b));if(0<q&&q>f){b=b.children().children("tr");for(var g=q=e=0;g<b.length;g++){var k=b[g],e=e+k.offsetHeight;if(e>=f){c&&h(k).hasClass("pq-detail-child")?(q--,q=1<q?q-1:1):q=1<q?q-1:0;break}else c?!1==h(k).hasClass("pq-detail-child")&&q++:
q++}0==q&&(q=b.length-1);f=d-q+1}else f=e+1;f>d&&(f=d);a?this.$vscroll.pqScrollBar("option","num_eles",f):this.$vscroll.pqScrollBar("setNumEles",f);return f};b._getFirstVisibleRowIndxPage=function(a){for(var c=0,d=a.length;c<d;c++)if(!a[c].pq_hidden)return c};b._getLastVisibleRowIndxPage=function(a){for(var c=a.length-1;0<=c;c--)if(!a[c].pq_hidden)return c;return null};b._getFirstVisibleColIndx=function(){for(var a=this.colModel,c=a.length,d=0;d<c;d++)if(!a[d].hidden)return d;return null};b._getLastVisibleColIndx=
function(){for(var a=this.colModel,c=a.length-1;0<=c;c--)if(!a[c].hidden)return c;return null};b.getTotalVisibleColumns=function(){for(var a=this.colModel,c=a.length,d=0,f=0;f<c;f++)a[f].hidden||d++;return d};b._getTotalVisibleRows=function(a,c,d,f){var e=0,b=f?f.length:0,q=c,g=0,k=0,l=null,m=!1,h=!1,n=this.iHierarchy?!0:!1,r=this.options.detailModel.offset,u=0,x=n?this.$cont[0].offsetHeight:void 0;if(null==f||0==b)return{initV:l,finalV:l,tvRows:e,lastFrozenRow:l};for(var y=0,D=b>c?c:b;y<D;y++){var v=
f[y],B=v.pq_hidden;B||(l=y,e++,n&&((v=v.pq_detail)&&v.show?(v=v.height||0,v>r&&(v=r),u+=v+22):u+=22))}if(b<c)return{initV:l,finalV:l,tvRows:e,lastFrozenRow:l};d-=e;y=c;for(D=b;y<D;y++)v=f[y],B=v.pq_hidden,m?h||(B?g++:k==d?h=!0:(g++,k++)):B?q++:k==a?(m=!0,g=q,k=0):(q++,k++),B||(e++,n&&m&&((v=v.pq_detail)&&v.show?(v=v.height||0,v>r&&(v=r),u+=v+22):u+=22,u>x&&(h=!0)));q>=b&&(q=b-1);g<q&&(g=q);return{initV:q,finalV:g,tvRows:e,lastFrozenRow:l}};b._setScrollVLength=function(){var a=this.$cont.height(),
c=this._getScollBarHorizontalHeight();this.$vscroll.css("bottom",c);this.$vscroll.pqScrollBar("option","length",a-c)};b._setInnerGridHeight=function(){var a=this.options;a.flexHeight||(a=this.element.height()-(a.showTop?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight,this.$grid_inner.height(a+"px"))};b._setRightGridHeight=function(){var a=this.options,c=this.$header,d=0;c?(d=c[0].offsetHeight,this.$header_o.height(d-2)):this.$header_o.height(0);a.flexHeight||(this.$vscroll.css("visibility",
""),this.$tbl&&this.$tbl.css("marginBottom",0),a=this.element.height()-this.$header_o[0].offsetHeight-(a.showTop?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight,this.$cont.height(a-0+"px"))};b._setGridHeightFromTable=function(){var a=this._getScollBarHorizontalHeight(),c=this.$tbl;c&&c.length&&c.css("marginBottom",a);this.$cont.height("");this.element.height("");this.$grid_inner.height("");this.$vscroll.css("visibility","hidden")};b._setGridWidthFromTable=function(){var a,c=this._getSBWidth();
this.$tbl&&this.$tbl[0]&&0<this.$tbl[0].scrollWidth?(a=this.$tbl[0].scrollWidth,this.element.width(a+c+"px")):(a=l.call(this,-1,this.colModel.length),this.element.width(a+"px"))};b._bufferObj_minRowsPerGrid=function(){return Math.ceil(this.$cont[0].offsetHeight/this.rowHeight)};b._calcCurPosFromRowIndxPage=function(a){var c=this.options,d=c.groupModel,f=d?this.dataGM:this.data,e=c.freezeRows;if(a<e)return 0;for(var c=0,b=e,q=f.length;e<q;e++){var g=f[e];if(!d||!g.groupSummary&&!g.groupTitle){if(b==
a)break;b++}g.pq_hidden||c++}return c>=q?null:c};b._calcCurPosFromColIndx=function(a){var c=this.colModel,d=this.options.freezeCols;if(a<d)return 0;for(var f=0,e=d,b=c.length;d<b;d++){var g=c[d];if(e==a)break;e++;g.hidden||f++}return f>=b?null:f};b._bufferObj_calcInitFinal=function(){var a=this.options,c=a.virtualY,d=a.freezeRows,f=a.flexHeight,a=a.groupModel?this.dataGM:this.data;if(null==a||0==a.length)d=this._getTotalVisibleRows(e,d,b,a),this.totalVisibleRows=d.tvRows,this.initV=d.initV,this.finalV=
d.finalV,this.lastFrozenRow=d.lastFrozenRow;else if(c){var c=this.$vscroll.pqScrollBar("option"),e=parseInt(c.cur_pos);if(isNaN(e)||0>e)throw"cur_pos NA";this.scrollCurPos=e;var b=this._bufferObj_minRowsPerGrid();this.pageSize=b;d=this._getTotalVisibleRows(e,d,b,a);this.totalVisibleRows=d.tvRows;this.initV=d.initV;this.lastFrozenRow=d.lastFrozenRow;this.finalV=f?a.length-1:d.finalV}else d=this._getTotalVisibleRows(0,d,b,a),this.lastFrozenRow=d.lastFrozenRow,this.totalVisibleRows=d.tvRows,this.initV=
0,this.finalV=a.length-1};b._bufferObj_calcInitFinalH=function(){var a=this.options,c=a.virtualX,d=this.colModel,f=d.length;if(c){for(var e=parseInt(this.$hscroll.pqScrollBar("option","cur_pos")),b=parseInt(a.freezeCols),g=a.flexWidth,k=b,m=0,h=b;h<f;h++)if(d[h].hidden)k++;else if(m==e)break;else k++,m++;k>f-1&&(k=f-1);this.initH=k;if(g||!c)this.finalH=f-1;else{c=l.call(this,-1,b);e=this.$cont[0].offsetWidth-this._getSBWidth();for(h=k;h<f;h++)if(k=d[h],!k.hidden){k=k.outerWidth;if(!k&&a.debug)throw"outerwidth N/A";
c+=k;if(c>e)break}a=h;a>f-1&&(a=f-1);this.finalH=a}}else this.initH=0,this.finalH=f-1};var l=function(a,c,d){var f=0,e=this.options,b=e.columnBorders?1:0,g=e.numberCell,e=this.colModel;-1==a&&(g.show&&(f=d?f+(parseInt(g.width)+1):f+g.outerWidth),a=0);if(d)for(;a<c;a++){if(d=e[a],!d.hidden){if(!d._width)throw"assert failed";f+=d._width+b}}else for(;a<c;a++)d=e[a],d.hidden||(f+=d.outerWidth);return f};h.paramquery.pqgrid.calcWidthCols=l;b.calcHeightFrozenRows=function(){var a=this.$tbl,c=0;a&&a.length&&
((a=h(a[0]).find("tr.pq-last-freeze-row"))&&a.length?(a=a[0],c=a.offsetTop+a.offsetHeight):c=0);return c};b._calcRightEdgeCol=function(a){var c=0,d=0,f=this.colModel,e=this.hidearrHS,b=this.options.numberCell;b.show&&(c+=b.outerWidth,d++);for(b=0;b<=a;b++){var g=f[b];g.hidden||!1!=e[b]||(c+=g.outerWidth,d++)}return{width:c,cols:d}};b._refreshFreezeLine=function(){var a=this.options,c=a.numberCell,d=this.$cont_o,a=a.freezeCols;this.$freezeLine&&this.$freezeLine.remove();a&&(a=l.call(this,-1,a)-1,isNaN(a)||
0==a||0<a&&c.show&&a==c.width||(this.$freezeLine=h("<div class='pq-grid-vert-freezeline' ></div>").appendTo(d),this.$freezeLine.css({height:d[0].offsetHeight,left:a})))};b._getDragHelper=function(a){var c=parseInt(this.options.freezeCols);a=h(a.currentTarget);this.$cl=h("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner);this.$clleft=h("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner);a=parseInt(a.attr("pq-grid-col-indx"));var d=this.$grid_inner.outerHeight();this.$cl.height(d);
this.$clleft.height(d);var d=h("td[pq-grid-col-indx="+a+"]",this.$header)[0],f=d.offsetLeft;this.pqpanes.v?a>=c&&(f+=this.$header[1].offsetLeft):f+=this.$header[0].offsetLeft;this.$clleft.css({left:f});f+=d.offsetWidth;this.$cl.css({left:f})};b._setDragLimits=function(a){if(!(0>a)){var c=this.colModel[a],d=this.$header_left;a>=this.options.freezeCols&&this.pqpanes.v&&(d=this.$header_right);var f=d.find("td[pq-grid-col-indx='"+a+"']").offset().left+c._minWidth,c=f+c._maxWidth-c._minWidth;d.find("div.pq-grid-col-resize-handle[pq-grid-col-indx="+
a+"]").draggable("option","containment",[f,0,c,0])}};b.nestedCols=function(a,c,d){var f=a.length,e=[];null==c&&(c=1);for(var b=c,g=0,k=0,l=0;l<f;l++){var m=a[l];if(!0===d||!1===d)m.hidden=d;if(null!=m.colModel&&0<m.colModel.length){var h=this.nestedCols(m.colModel,c+1,m.hidden),e=e.concat(h.colModel);0<h.colSpan?(h.depth>b&&(b=h.depth),m.colSpan=h.colSpan,g+=h.colSpan):(m.colSpan=0,m.hidden=!0);m.childCount=h.childCount;k+=h.childCount}else m.hidden?m.colSpan=0:(m.colSpan=1,g++),m.childCount=0,k++,
e.push(m)}return{depth:b,colModel:e,colSpan:g,width:0,childCount:k}};b.getHeadersCells=function(){for(var a=this.options.colModel,c=this.colModel.length,d=this.depth,f=[],e=0;e<d;e++){f[e]=[];for(var b=0,g=0,k=0;k<c;k++){var l;if(0==e)l=a[b];else{var m=f[e-1][k];l=m.colModel;if(null==l||0==l.length)l=m;else{for(var m=k-m.leftPos,h=0,n=0,r=0;r<l.length;r++)if(h+=0<l[r].childCount?l[r].childCount:1,m<h){n=r;break}l=l[n]}}m=l.childCount?l.childCount:1;k==g?(l.leftPos=k,f[e][k]=l,g+=m,a[b+1]&&b++):f[e][k]=
f[e][k-1]}}return this.headerCells=f};b.getDataType=function(){var a=this.colModel;if(a&&a[0])return"string"==typeof a[0].dataIndx?"JSON":"ARRAY";throw"dataType unknown";};b.assignRowSpan=function(){for(var a=this.colModel.length,c=this.headerCells,d=this.depth,f=0;f<a;f++)for(var e=0;e<d;e++){var b=c[e][f];if(!(0<f&&b==c[e][f-1]||0<e&&b==c[e-1][f])){for(var g=1,k=e+1;k<d;k++)b==c[k][f]&&g++;b.rowSpan=g}}return c};b._calcThisColModel=function(){var a=this.options,c=a.columnTemplate,a=this.nestedCols(a.colModel);
this.colModel=a.colModel;this.depth=a.depth;var a=this.colModel,d=a.length;if(c)for(var f=0;f<d;f++){var e=a[f],b=h.extend({},c,e,!0);h.extend(e,b,!0)}this.getHeadersCells();this.assignRowSpan();this._refreshDataIndices()};var m=function(a){this.that=a},g=m.prototype;g._computeOuterWidths=function(){for(var a=this.that,c=a.options,d=c.columnBorders?1:0,c=c.numberCell,a=a.colModel,f=a.length,e=0;e<f;e++){var b=a[e];b.outerWidth=b._width+d}c.show&&(c.outerWidth=c.width+1)};g.autoFit=function(){var a=
this.that,c=a.colModel,d=a.$cont,f=c.length,e=l.call(a,-1,f,!0),a=d[0].offsetWidth-a._getSBWidth();if(e!=a){for(var e=e-a,b,a=[],d=0;d<f;d++){var g=c[d],k=g._percent,m=g._resized;g.hidden||k||m||(0>e?(k=g._maxWidth-g._width)&&a.push({availWd:-1*k,colIndx:d}):(k=g._width-g._minWidth)&&a.push({availWd:k,colIndx:d}));m&&(b=g,delete g._resized)}a.sort(function(c,a){return c.availWd>a.availWd?1:c.availWd<a.availWd?-1:0});d=0;for(f=a.length;d<f;d++){var g=a[d],k=g.availWd,g=g.colIndx,m=Math.round(e/(f-
d)),g=c[g],h;h=g._width;Math.abs(k)>Math.abs(m)?(h-=m,e-=m):(h-=k,e-=k);g.width=g._width=h}0!=e&&b&&(h=b._width-e,h>b._maxWidth?h=b._maxWidth:h<b._minWidth&&(h=b._minWidth),b.width=b._width=h)}};g.autoLastColumn=function(){var a=this.that,c=a.options,d=c.columnBorders?1:0,f=a.colModel,e=f.length,c=c.freezeCols,b=a.$cont[0].offsetWidth-a._getSBWidth(),g=l.call(a,-1,c,!0),b=b-g,g=!1,a=a._getLastVisibleColIndx();if(null!=a&&(a=f[a],!a._percent)){for(var k=a._width,m,h=a._minWidth,n=a._maxWidth,e=e-1;e>=
c;e--){var r=f[e];if(!r.hidden&&(r=r._width+d,b-=r,0>b)){g=!0;m=k+b>=h?k+b:k+r+b;break}}g||(m=k+b);m>n?m=n:m<h&&(m=h);a.width=a._width=m}};g.numericVal=function(a,c){return-1<(a+"").indexOf("%")?parseInt(a)*c/100:parseInt(a)};g.refreshColumnWidths=function(){var a=this.that,c=a.options,d=c.numberCell,f=c.flexWidth,e=c.columnBorders?1:0,b=a.colModel,g=c.scrollModel,k=g.lastColumn,g=g.autoFit,l=a.$cont,m=b.length,h=a._getSBWidth(),n=c._minColWidth,r=c._maxColWidth;if(l&&l[0].offsetWidth){var t=l[0].offsetWidth,
u=0;d.show&&(d.width<d.minWidth&&(d.width=d.minWidth),d.outerWidth=d.width+1,u=d.outerWidth);d=t-h-u;n=Math.floor(this.numericVal(n,d));r=Math.ceil(this.numericVal(r,d));h=0;if(5>d||isNaN(d)){if(c.debug)throw"availWidth N/A";}else{delete a.percentColumn;for(c=0;c<m;c++)if(t=b[c],!t.hidden){var x=t.width,u=-1<(x+"").indexOf("%")?!0:null,y=t.minWidth,D=t.maxWidth,y=y?this.numericVal(y,d):n,D=D?this.numericVal(D,d):r;D<y&&(D=y);if(void 0!=x){var v=0;!f&&u?(a.percentColumn=!0,t.resizable=!1,t._percent=
!0,x=this.numericVal(x,d)-e,v=Math.floor(x),h+=x-v,1<=h&&(v+=1,h-=1)):x&&(v=parseInt(x));v<y?v=y:v>D&&(v=D);t._width=v}else t._width=y;u||(t.width=t._width);t._minWidth=y;t._maxWidth=D}l&&!1==f&&(g&&this.autoFit(),"auto"==k&&this.autoLastColumn());this._computeOuterWidths()}}};b._createHeader=function(){var a=this,c=this.options,d=c.hwrap,f=parseInt(c.freezeCols),e=c.numberCell,b=this.colModel,g=this.depth,k=c.virtualX,m=a.initH,n=a.finalH,r=this.headerCells,w=this.$header,z=this.$header_o;if(!1===
c.showHeader)w&&w.empty(),this.$header_o.css("display","none");else{this.$header_o.css("display","");w="pq-grid-header-table ";w=["<table class='"+(d?w+"pq-wrap ":w+"pq-no-wrap ")+"' cellpadding=0 cellspacing=0 >"];if(1<=g){w.push("<tr>");e.show&&w.push("<td style='width:"+(e.width+1)+"px;' ></td>");for(c=0;c<=n;c++){if(c<m&&c>=f&&k&&(c=m,c>n))throw"initH>finalH";d=b[c];d.hidden||(d=d.outerWidth,w.push("<td style='width:"+d+"px;' pq-col-indx="+c+"></td>"))}w.push("</tr>")}for(d=0;d<g;d++){w.push("<tr class='pq-grid-title-row'>");
0==d&&e.show&&w.push(["<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='",g,"'><div class='pq-td-div'>",e.title?e.title:"&nbsp;","</div></td>"].join(""));for(c=0;c<=n;c++){if(c<m&&c>=f&&k&&(c=m,c>n))throw"initH>finalH";this._createHeaderCell(d,c,r,w,"pq-grid-col ",f,m,g)}w.push("</tr>")}this.ovCreateHeader(w,"pq-grid-col ");w.push("</table>");e=w.join("");z.empty();this.pqpanes.v?z.append(["<span class='pq-grid-header pq-grid-header-left ui-state-default'>",e,"</span><span class='pq-grid-header ui-state-default'>",
e,"</span>"].join("")):z.append(["<span class='pq-grid-header ui-state-default'>",e,"</span>"].join(""));w=this.$header=h(".pq-grid-header",z);this.$tbl_header=w.children("table");d=l.call(this,-1,f);e=this.$header_left=h(w[0]);this.pqpanes.v&&(e=this.$header_left=h(w[0]),z=this.$header_right=h(w[1]),e.css({width:d,zIndex:10}),f=l.call(this,f,m),z.css({left:-1*f+"px"}));w.click(function(c){if(!a.iDragColumns||"stop"==a.iDragColumns.status){var d=h(c.target),f=d.closest(".pq-g-ficon");if(f.length)return d=
f.attr("pq-col-indx"),c.stopImmediatePropagation(),a.iHeaderIconSearch.createDOM(d,f,c);f=d.closest("td.pq-grid-col");if(f.length&&(c.stopImmediatePropagation(),d=f.attr("pq-grid-col-indx"),null!=d))return a._onHeaderCellClick(d,c)}});this._refreshResizeColumn(m,n,b);this._trigger("refreshHeader",null,null)}};b._createHeaderCell=function(a,c,d,f,e,b,g,k){var l=d[a][c],m=l.colSpan,h=l.halign,n=l.align,r=l.title;if(!(0<a&&l==d[a-1][c]||0<c&&l==d[a][c-1]||l.hidden)){d=e;null!=h?d+=" pq-align-"+h:null!=
n&&(d+=" pq-align-"+n);c==b-1&&1==k&&(d+=" pq-last-freeze-col");c<=b-1?d+=" pq-left-col":c>=g&&(d+=" pq-right-col");(b=l.cls)&&(d=d+" "+b);b="";if(null==l.colModel||0==l.colModel.length)b="pq-grid-col-indx='"+c+"'";f.push(["<td ",b," ","pq-col-indx="+c," ","pq-row-indx="+a,"  class='",d,"' rowspan=",l.rowSpan," colspan=",m,"><div class='pq-td-div'>",r?r:"","<span class='pq-col-sort-icon'>&nbsp;</span></div></td>"].join(""))}};b.ovCreateHeader=function(){};b._refreshResizeColumn=function(a,c,d){var f=
this,e=this.options,b=e.filterModel.ficon?!0:!1,g=e.numberCell,k=f.$header.height(),e=parseInt(e.freezeCols),l=[],m=[];if(g.show&&g.resizable){var n=f.$header_left.find("td.pq-grid-number-col")[0],n=parseInt(n.offsetLeft)+(n.offsetWidth-10);l.push("<div pq-grid-col-indx='-1' style='left:",n,"px;height:",k,"px;' class='pq-grid-col-resize-handle'>&nbsp;</div>")}for(g=0;g<=c;g++){if(g<a&&g>=e&&(g=a,g>c))throw"initH>finalH";var r=d[g];if(!r.hidden){var z=r.ficon,t=z||null==z&&b,z=l;if(!1!==r.resizable||
t)n=f.$header_left,this.pqpanes.v&&g>=e&&(n=f.$header_right,z=m),n=n.find("td[pq-grid-col-indx="+g+"]")[0],t=parseInt(n.offsetLeft),n=t+(n.offsetWidth-5);!1!==r.resizable&&z.push("<div pq-grid-col-indx='",g,"' style='left:",n,"px;height:",k,"px;' class='pq-grid-col-resize-handle'>&nbsp;</div>")}}f.$header_left.append(l.join(""));m.length&&f.$header_right.append(m.join(""));var u,x,y;f.$header.find(".pq-grid-col-resize-handle").draggable({axis:"x",helper:function(c,a){var d=h(c.target),e=parseInt(d.attr("pq-grid-col-indx"));
f._setDragLimits(e);f._getDragHelper(c,a);return d},start:function(c,a){u=a.position.left;y=parseInt(f.$cl[0].style.left)},drag:function(c,a){x=a.position.left;f.$cl[0].style.left=y+(x-u)+"px"},stop:function(c,a){return f._refreshResizeColumnStop(c,a,d,u)}})};b._refreshResizeColumnStop=function(a,c,d,f){var e=this.options.numberCell;this.$clleft.remove();this.$cl.remove();f=c.position.left-f;c=h(c.helper);c=parseInt(c.attr("pq-grid-col-indx"));if(-1==c){d=null;var b=parseInt(e.width);e.width=b+f}else d=
d[c],b=parseInt(d.width),d.width=b+f,d._resized=!0;this.refresh();this._trigger("columnResize",a,{colIndx:c,column:d,dataIndx:d?d.dataIndx:null,oldWidth:b,newWidth:d?d.width:e.width})};b._refreshHeaderSortIcons=function(){var a=this.options.dataModel;if(void 0!=a.sortIndx){var c=this.$header;c.find(".pq-grid-col").removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active");c.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");var d=this.getColIndx({dataIndx:a.sortIndx}),
f="ui-state-active pq-col-sort-"+("up"==a.sortDir?"asc":"desc"),a="ui-icon ui-icon-triangle-1-"+("up"==a.sortDir?"n":"s");c.find(".pq-grid-col[pq-grid-col-indx="+d+"]").addClass(f);c.find(".pq-grid-col[pq-grid-col-indx="+d+"] .pq-col-sort-icon").addClass(a)}};b.createTable=function(a){this.iGenerateView.generateView(a)};h.widget("paramquery._pqGrid",h.ui.mouse,b);h.measureTime=function(a,c){(new Date).getTime();a();(new Date).getTime()}})(jQuery);
(function(h){function b(c){var a=this;this.that=c;this.type="detail";this.refreshComplete=!0;this.detachView=!1;var f=c.widgetEventPrefix.toLowerCase(),e=c.eventNamespace;c.element.on(f+"cellclick"+e,function(c,f){if(a.belongs(c))return a.cellClick(c,f)});c.element.on(f+"cellkeydown"+e,function(c,f){if(a.belongs(c)&&c.keyCode==h.ui.keyCode.ENTER)return a.cellClick(c,f)});c.element.on(f+"aftertable"+e,function(c,f){if(a.belongs(c))return a.aftertable(c,f)});c.element.on(f+"beforetableview"+e,function(c,
f){if(a.belongs(c))return a.beforeTableView(c,f)});c.element.on(f+"beforerefreshdata"+e,function(c,f){if(a.belongs(c))return a.beforeRefreshData(c,f)})}var r=h.paramquery.cClass,k={getFocusElement:function(){var c=document.activeElement;if(c){var c=h(c),a=c.closest(".pq-grid");if(a.length)return a[0]==this.element[0]?{$ae:c,$grid:a}:{$ae:c,$childGrid:a}}},inViewPort:function(c){var a=this.$cont[0],f=a.offsetHeight-this._getScollBarHorizontalHeight(),a=a.offsetWidth-this._getSBWidth()+1;c=c[0];var e=
h(c.offsetParent),b=parseInt(e.css("marginTop")),e=parseInt(e.css("marginLeft"));if(f>=c.offsetTop+c.offsetHeight+b)if("TD"==c.nodeName.toUpperCase()){if(a>=c.offsetLeft+c.offsetWidth+e)return!0}else return!0}},n=b.prototype=new r;n.aftertable=function(c,a){var f=this.that,e=f.options.detailModel.init,b=f.data;if(this.refreshComplete){this.refreshComplete=!1;for(var g=f.$tbl.children("tbody").children("tr.pq-detail-child"),k=0;k<g.length;k++){var l=h(g[k]),m=l.attr("pq-row-indx"),n=b[m],m=n.pq_detail.child;
m||"function"!=typeof e||(m=e.call(f.element[0],{rowData:n}),n.pq_detail.child=m);n=m.find(".pq-header-outer");l.children("td.pq-detail-child").append(m);if(0==n.height())try{m.pqGrid("refresh")}catch(r){}}this.refreshComplete=!0;this.detachView=!1}};n.beforeTableView=function(c,a){this.detachView||this.detachInitView(c,a)};n.beforeRefreshData=function(c,a){this.detachView||this.detachInitView(c,a)};n.detachInitView=function(c,a){var f=this.that,e=f.data;if(e&&e.length){for(var f=f.$tbl.children("tbody").children("tr.pq-grid-row"),
b,g,k,l=0;l<f.length;l++){var m=h(f[l]);g=m.attr("pq-row-indx");var n=e[g];null!=g&&g!=b&&(b=g,n.pq_detail&&(g=null,k=0,n.pq_detail.child&&(m=m.next(),m.hasClass("pq-detail-child")&&(m=m.children("td.pq-detail-child").children(),m.length&&(k=m[0].offsetHeight,g=m.detach()))),g&&g.length&&(n.pq_detail.child=g,n.pq_detail.height=k)))}this.detachView=!0}};n.cellClick=function(c,a){var f=this.that,e=a.column,b=a.rowData,g=a.rowIndx,k=this.type;e&&e.type===k&&(null==b.pq_detail?f.rowExpand({rowIndx:g,
scrollRow:!0}):!1===b.pq_detail.show?f.rowExpand({rowIndx:g,scrollRow:!0}):f.rowCollapse({rowIndx:g,scrollRow:!0}))};k.rowExpand=function(c){var a=this.getRowData(c),f=this.options.detailModel;null!=a&&(null==a.pq_detail?a.pq_detail={show:!0}:!1===a.pq_detail.show&&(a.pq_detail.show=!0),!f.cache&&(f=a.pq_detail.child)&&(f.remove(),a.pq_detail.child=null,a.pq_detail.height=0),this.refresh(),c.scrollRow&&this.scrollRow({rowIndx:c.rowIndx}))};k.rowInvalidate=function(c){c=this.getRowData(c);c.pq_detail.child.remove();
c.pq_detail.child=null};k.rowCollapse=function(c){var a=this.getRowData(c),f=this.options.detailModel;null!=a&&null!=a.pq_detail&&!0===a.pq_detail.show&&(!f.cache&&(f=a.pq_detail.child)&&(f.remove(),a.pq_detail.child=null,a.pq_detail.height=0),a.pq_detail.show=!1,this.refresh(),c.scrollRow&&this.scrollRow({rowIndx:c.rowIndx}))};var e=function(c){function a(d,f,e){c.filter({data:[{dataIndx:d,value:f,value2:e}]})}this.that=c;var f=this;this.dataHS={};var e=c.widgetEventPrefix.toLowerCase(),b=c.eventNamespace;
c.element.on(e+"headerkeydown"+b,function(c,a){if(f.belongs(c)){var d=h(c.originalEvent.target);return d.hasClass("pq-search-hd-field")?f.onKeyDown(c,a,d):!0}});c.element.on(e+"createheader"+b,function(c,a){if(f.belongs(c))return f._onCreateHeader()});this.changeListener={change:function(c,f){a(f.dataIndx,f.value,f.value2)}};this.keyupListener={keyup:function(c,f){a(f.dataIndx,f.value,f.value2)}};this.clickListener={click:function(c,f){a(f.dataIndx,f.value)}}},r=e.prototype=new r;r.get$Ele=function(c,
a){var f=this.that,e=f.options.freezeCols,b=h(f.$tbl_header[0]),g=".pq-search-hd-field[name='"+a+"']",f=h(f.$tbl_header[2==f.$tbl_header.length?1:0]);return c>=e?f.find(g):b.find(g)};r.onKeyDown=function(c,a,f){a=this.that;if(c.keyCode===h.ui.keyCode.TAB){var e=f.attr("name"),b=a.getColIndx({dataIndx:e}),g=a.colModel,k,l=c.shiftKey,m=g[b];if("between"==m.filter.condition&&(a.scrollColumn({colIndx:b}),e=this.get$Ele(b,e),e[0]==f[0]?l||(k=e[1]):l&&(k=e[0]),k))return k.focus(),c.preventDefault(),!1;
do{l?b--:b++;if(0>b||b>=g.length)break;m=g[b];f=m.filter;if(!m.hidden&&f){a.scrollColumn({colIndx:b});e=m.dataIndx;k=this.get$Ele(b,e);"between"==f.condition&&(k=l?h(k[1]):h(k[0]));if(k)return k.focus(),c.preventDefault(),!1;break}}while(1)}else return!0};r._bindFocus=function(){function c(c){f._fixTableViewPort();c=h(c.target).attr("name");if(f.scrollColumn({dataIndx:c})){var a=f.getColIndx({dataIndx:c});e.get$Ele(a,c).focus()}}function a(d){d.addEventListener?d.addEventListener("focus",c,!0):d.onfocusin=
function(){var a=window.event;a.target=a.srcElement;c(a)}}for(var f=this.that,e=this,b=f.$header.find(".pq-grid-header-search"),g=0;g<b.length;g++)a(b[g])};r._onCreateHeader=function(){var c=this.that,a=c.options,f=a.columnBorders;if(a.filterModel.header){this._bindFocus();var e=c.colModel,b=c.initH,g=c.finalH,k=a.freezeCols,a=a.virtualX,l=c.$tbl_header,m=h(l[0]),n=h(l[1]),r="input,select";if(1<l.length){m.find(r).css("visibility","hidden");for(var z=0;z<k;z++){var t=e[z],r="*[name='"+t.dataIndx+
"']";m.find(r).css("visibility","visible");n.find(r).css("visibility","hidden")}}for(z=0;z<=g;z++){if(z<b&&z>=k&&a&&(z=b,z>g))throw"initH>finalH";t=e[z];if(!t.hidden){var u=t.filter;if(u){var r=t.dataIndx,x=m;z>=k&&1<l.length&&(x=n);x=x.find("*[name='"+r+"']");if(0!=x.length){var y=u.type,D=u.value,v=u.value2;"checkbox"==y&&"triple"==u.subtype?x.pqval({val:D}):"select"==y&&(x.val(D),y=this.getWidth(t,f),x.css({width:y}));(y=u.init)&&y.call(x,{dataIndx:r,column:t});if(t=u.listeners)for(u=0;u<t.length;u++){y=
t[u];"string"==typeof y&&(y=this[y+"Listener"]);for(var B in y)(function(a,d,f){a.bind(B,function(e){var b=c.getColumn({dataIndx:f}),g=b.filter;"checkbox"==g.type?D="triple"==g.subtype?a.pqval({incr:!0}):a.is(":checked")?!0:!1:"between"==g.condition?(D=h(a[0]).val(),v=h(a[1]).val()):D=a.val();return d.call(this,e,{column:b,dataIndx:f,value:D,value2:v})})})(x,y[B],r)}}}}}}};r.getWidth=function(c,a){var f=parseInt(c.width)+(a?1:0);return f-15};r.createDOM=function(c,a){var f=this.that,e=f.initH,b=f.finalH,
g=f.options,k=g.freezeCols,l=g.virtualX,m=f.colModel,n=g.columnBorders,g=g.numberCell;c.push("<tr class='pq-grid-header-search'>");g.show&&c.push("<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='1'><div class='pq-grid-header-table-div'>&nbsp;</div></td>");for(g=0;g<=b;g++){if(g<e&&g>=k&&l&&(g=e,g>b))throw"initH>finalH";var r=m[g];if(!r.hidden){var z=a,t=r.halign;t||(t=r.align);"right"==t?z+=" pq-align-right":"center"==t&&(z+=" pq-align-center");(t=r.cls)&&(z=z+" "+t);if(t=r.filter){var u=
r.dataIndx,x=t.type,y=t.value,D=t.condition,v=this.getWidth(r,n),B=t.cls,B="pq-search-hd-field "+(B?B:""),F=t.style,F=F?F:"",I=t.attr,I=I?I:"",E="",H;if("between"==D){var K=t.value2,K=null!=K?K:"";H=v/2-9}"textbox"===x?(y=y?y:"",B+=" ui-corner-all pq-search-txt","between"==D?(E=this._input(u,y,H,B+" pq-from",F,I),E+="-"+this._input(u,K,H,B+" pq-to",F,I)):E=this._input(u,y,v,B,F,I)):"textarea"===x?(y=y?y:"",B+=" ui-corner-all pq-search-txt","between"==D?(E=this._textarea(u,y,H,B,F,I),E+="-"+this._textarea(u,
K,H,B,F,I)):E=this._textarea(u,y,v,B,F,I)):"select"===x?t.cache?E=t.cache:(x=t.options,"function"===typeof x&&(x=x.call(f.element[0],{column:r,value:y,dataIndx:u,cls:B,style:F,attr:I})),B+=" ui-corner-all",r=["name='",u,"' class='",B,"' style='width:",v,"px;",F,"' ",I].join(""),E=h.paramquery.select({options:x,attr:r,prepend:t.prepend,valueIndx:t.valueIndx,labelIndx:t.labelIndx,groupIndx:t.groupIndx}),t.cache=E):"checkbox"==x?E=["<input ",null==y||!1==y?"":"checked=checked"," name='",u,"' type=checkbox class='"+
B+"' style='"+F+"' "+I+"/>"].join(""):"string"==typeof x?E=x:"function"==typeof x&&(E=x.call(f.element[0],{width:v,value:y,value2:K,column:r,dataIndx:u,cls:B,attr:I,style:F}));c.push(["<td class='",z,"'><div class='pq-grid-header-table-div' style='padding:0px 2px;' >",E,"</div></td>"].join(""))}else c.push(["<td class='",z,"'><div class='pq-grid-header-table-div' >&nbsp;</div></td>"].join(""))}}c.push("</tr>")};r._input=function(c,a,f,e,b,g){return['<input value="',a,"\" name='",c,"' type=text style='width:",
f,"px;"+b+"' class='"+e+"' "+g+" />"].join("")};r._textarea=function(c,a,f,e,b,g){return["<textarea name='",c,"' style='width:",f,"px;"+b+"' class='"+e+"' "+g+" >",a,"</textarea>"].join("")};h.paramquery.select=function(c){var a=c.options,e=c.groupIndx,b=c.labelIndx,g=c.valueIndx,k=c.prepend,l,m;c=["<select ",c.attr," >"];if(k)for(l in k)c.push('<option value="',l,'">',k[l],"</option>");if(e){if(a&&a.length){for(var k=0,h=a.length;k<h;k++){var n=a[k],r=n[g];null!=r&&(l=n[e],m!=l&&(null!=m&&c.push("</optgroup>"),
c.push('<optgroup label="',l,'">'),m=l),g!=b?(n=n[b],c.push('<option value="',r,'">',n,"</option>")):c.push("<option>",r,"</option>"))}c.push("</optgroup>")}}else if(a&&a.length)for(k=0,h=a.length;k<h;k++)if(n=a[k],null!=b&&null!=g)r=n[g],null!=r&&(b==g?c.push("<option>",r,"</option>"):(n=n[b],c.push('<option value="',r,'">',n,"</option>")));else if("object"==typeof n)for(l in n)c.push('<option value="',l,'">',n[l],"</option>");else c.push("<option>",n,"</option>");c.push("</select>");return c.join("")};
h.fn.pqval=function(c){if(c){if(c.incr)return c=this.data("pq_value"),this.prop("indeterminate",!1),c?(c=!1,this.removeAttr("checked")):!1===c?(c=null,this.prop("indeterminate",!0),this.removeAttr("checked")):(c=!0,this.attr("checked","checked")),this.data("pq_value",c),c;c=c.val;this.data("pq_value",c);this.prop("indeterminate",!1);null==c?(this.prop("indeterminate",!0),this.removeAttr("checked")):c?this.attr("checked","checked"):this.removeAttr("checked");return this}return this.data("pq_value")};
var g={_generateTitleRow:function(c,a,e,b){var g=this.that.options.numberCell,k=a.groupTitle,l=c.title,m=a.level,h=a.GMRowIndx;c=(c=(c=c.icon)?c[m]:null)&&c.length&&2==c.length&&"function"===typeof c.push?c:["ui-icon-minus","ui-icon-plus"];if(l&&null!=l[m]){if(!1===l[m])return;k=l[m].replace("{0}",k);k=k.replace("{1}",a.items)}else k=k+" - "+a.items+" item(s)";e.push(["<tr class='pq-group-row pq-grid-row",b?" pq-last-freeze-row":"","' title=\"",a.groupTitle,"\" level='",m,"' GMRowIndx='",h,"'>"].join(""));
g.show&&e.push("<td class='pq-grid-number-cell ui-state-default'>&nbsp;</td>");b=c[0];a.collapsed&&(b=c[1]);e.push("<td class='pq-grid-cell' colSpan='100' >","<div class='pq-td-div' style='margin-left:",16*m,"px;'>","<span class='ui-icon ",b,"'></span>",k,"</div></td>");e.push("</tr>")},_generateSummaryRow:function(c,a,e,b){var g=this.that,k=g.options,l=k.virtualX,m=g.initH,g=g.finalH,h=k.freezeCols,n=k.numberCell,k=k.columnBorders;e.push("<tr class='pq-summary-row pq-grid-row"+(b?" pq-last-freeze-row":
"")+"'>");n.show&&e.push("<td class='pq-grid-number-cell ui-state-default'>&nbsp;</td>");for(b=0;b<=g;b++){if(b<m&&b>=h&&l&&(b=m,b>g))throw"initH>finalH";var n=a[b],r=n.dataIndx;if(!n.hidden){var z="pq-grid-cell ";"right"==n.align?z+=" pq-align-right":"center"==n.align&&(z+=" pq-align-center");b==h-1&&k&&(z+=" pq-last-freeze-col");n.cls&&(z=z+" "+n.cls);n=["<td class='",z,"' style='' >",null==c[r]?"&nbsp;":c[r],"</td>"].join("");e.push(n)}}e.push("</tr>");return e},_generateDetailRow:function(c,a,
e,b,g,k){e="pq-grid-row pq-detail-child";k&&(e+=" pq-last-freeze-row");var l=this.that.options;k=l.numberCell;var m="pq-grid-cell ";if(!l.wrap||g)m+="pq-wrap-text ";l.stripeRows&&a/2==parseInt(a/2)&&(e+=" pq-grid-oddRow");c.pq_rowselect&&(e+=" pq-row-select ui-state-highlight");c=c.pq_rowcls;null!=c&&(e+=" "+c);b.push("<tr pq-row-indx='"+a+"' class='"+e+"' >");k.show&&b.push("<td class='pq-grid-number-cell ui-state-default'>&nbsp;</td>");b.push("<td class='"+m+" pq-detail-child' colSpan='20'></td>");
b.push("</tr>");return b}},l=function(c){this.that=c},r=l.prototype;r._refreshDataFromDataModel=function(){this._groupData();this.initcollapsed()};r.bindEvents=function(){var c=this;this.that.$cont.on("click","tr.pq-group-row",function(a){return c.onClickGroupRow(a)})};r.showHideRows=function(c,a,e){for(var b=[],g=this.that.dataGM,k=g.length;c<k;c++){var l=g[c],m=l;if(m.groupSummary)if(l.level<a)break;else l.pq_hidden=e;else if(m.groupTitle)if(l.collapsed&&b.push({indx:c,level:l.level}),l.level<=
a)break;else l.pq_hidden=e;else l.pq_hidden=e}return b};r.onClickGroupRow=function(c){var a=h(c.currentTarget);c=this.that;var e=parseInt(a.attr("level")),a=parseInt(a.attr("GMRowIndx")),b=!0,b=c.dataGM[a];b=b.collapsed?b.collapsed=!1:b.collapsed=!0;if(b)this.showHideRows(a+1,e,!0);else for(a=this.showHideRows(a+1,e,!1),b=0;b<a.length;b++){var g=a[b].indx,e=a[b].level;this.showHideRows(g+1,e,!0)}c.refresh()};r.initcollapsed=function(){var c=this.that.dataGM;if(c)for(var a=0,e=c.length;a<e;a++){var b=
c[a];if(void 0!==b.groupTitle){var g=b.level;b.collapsed&&this.showHideRows(a+1,g,!0)}}};r.max=function(c,a){var e;"integer"==a||"float"==a?(e=Math.max.apply(Math,c),"float"===a&&(e=e.toFixed(2))):(c="date"==a?c.sort(function(c,a){c=Date.parse(c);a=Date.parse(a);return c-a}):c.sort(),e=c[c.length-1]);return e};r.min=function(c,a){var e;"integer"==a||"float"==a?(e=Math.min.apply(Math,c),"float"===a&&(e=e.toFixed(2))):(c="date"==a?c.sort(function(c,a){c=Date.parse(c);a=Date.parse(a);return c-a}):c.sort(),
e=c[0]);return e};r.count=function(c){return c.length};r.sum=function(c,a){var e=0,b;b="float"===a?parseFloat:"integer"===a?parseInt:function(c){return c};for(var g=0,k=c.length;g<k;g++)e+=b(c[g]);"float"===a&&(e=e.toFixed(2));return e};r._groupData=function(){for(var c=this.that,a=c.data,e=c.options,b=e.groupModel,g=e.pageModel,e=c.colModel,g=g.type?(g.curPage-1)*g.rPP:0,k=e.length,l=b.dataIndx,m=l.length,n=b.collapsed,r=[],w=0;w<m;w++){r[w]=!1;for(var z=0;z<k;z++){var t=e[z],u=t.summary;if(u){var x=
u.type;if(x&&"function"==typeof x.push&&x[w]){r[w]=!0;break}}}}if(b&&a&&0<a.length){for(var b=[],z=[],y=[],D=[],v=[],w=0;w<m;w++)D[w]="",y[w]="",v[w]={};for(var B=0,F=a.length;B<=F;B++){for(var I=a[B],t=!1,E=null,w=0;w<m;w++)y[w]=B<F?h.trim(I[l[w]]):"",D[w]!=y[w]&&(t=!0),t&&null==E&&(E=w);if(t){for(t=0;t<m;t++)D[t]=y[t];if(0<B){for(w=m-1;w>=E;w--)if(r[w]){for(var H=[],K=0;K<k;K++)if(t=e[K],x=(u=t.summary)?u.type?u.type[w]:null:null){var J=t.dataIndx,N="",u=u.title?u.title[w]:null,M="{0}";"function"==
typeof x?N=x(v[w][J],t.dataType):(M=x+": {0}",N=this[x](v[w][J],t.dataType));u&&(M=u);H[J]=M.replace("{0}",N)}b.push({groupSummary:!0,level:w,data:H})}for(t=E;t<m;t++)b[z[t]].items=v[t][e[0].dataIndx].length}if(B==F)break;for(w=m-1;w>=E;w--)for(x=0;x<k;x++)t=e[x],v[w][t.dataIndx]=[];for(t=E;t<m;t++)b.push({groupTitle:y[t],level:t,GMRowIndx:b.length,collapsed:n&&null!=n[t]?n[t]:!1}),z[t]=b.length-1}if(B==F)break;I.rowIndx=B+g;I.pq_hidden=!1;b.push(I);for(E=0;E<k;E++)for(t=e[E],J=t.dataIndx,w=0;w<m;w++)v[w][J].push(I[J])}c.dataGM=
b}else c.dataGM=null};var m=function(c){this.that=c;this.$drag_helper=null;var a=c.options.dragColumns,e=a.topIcon,b=a.bottomIcon,g=this;this.status="stop";this.$arrowTop=h("<div class='pq-arrow-down ui-icon "+e+"'></div>").appendTo(c.element);this.$arrowBottom=h("<div class='pq-arrow-up ui-icon "+b+"' ></div>").appendTo(c.element);this.hideArrows();if(a&&a.enabled)c.$header_o.on("mousedown","td.pq-grid-col",function(c,a){if(!h(c.target).is("input,select,textarea")&&!c.pq_composed){g.setDraggables(c,
a);c.pq_composed=!0;var d=h.Event("mousedown",c);h(c.target).trigger(d)}})},r=m.prototype;r.showFeedback=function(c,a){var e=this.that,b=c[0],g=b.offsetLeft+b.offsetParent.offsetParent.offsetLeft+(a?0:b.offsetWidth)-8,k=e.$grid_inner[0].offsetTop+e.$header[0].offsetHeight;this.$arrowTop.css({left:g,top:e.$grid_inner[0].offsetTop+b.offsetTop-16,display:""});this.$arrowBottom.css({left:g,top:k,display:""})};r.showArrows=function(){this.$arrowTop.show();this.$arrowBottom.show()};r.hideArrows=function(){this.$arrowTop.hide();
this.$arrowBottom.hide()};r.updateDragHelper=function(c){var a=this.that.options.dragColumns,e=a.acceptIcon,a=a.rejectIcon,b=this.$drag_helper;b&&(c?(b.children("span.pq-drag-icon").addClass(e).removeClass(a),b.removeClass("ui-state-error")):(b.children("span.pq-drag-icon").removeClass(e).addClass(a),b.addClass("ui-state-error")))};r.setDraggables=function(c,a){var e=h(c.currentTarget),b=this.that,g=b.options.dragColumns.rejectIcon,k=this;e.hasClass("ui-draggable")||b.getHeaderColumnFromTD(e)&&e.draggable({distance:10,
cursorAt:{top:-18,left:-10},helper:function(){var a=h(this);k.status="helper";k._setupDroppables(a);b.$header.find(".pq-grid-col-resize-handle").hide();var c=a.attr("pq-col-indx"),d=a.attr("pq-row-indx");a.droppable("destroy");a=h("<div class='pq-col-drag-helper ui-widget-content ui-corner-all' ><span class='pq-drag-icon ui-icon "+g+"'></span>"+b.headerCells[d][c].title+"</div>");k.$drag_helper=a;return a[0]},zIndex:"1000",appendTo:b.element,revert:"invalid",drag:function(a,c){k.status="drag";var d=
h("td.pq-drop-hover",b.$header);if(0<d.length){k.showArrows();k.updateDragHelper(!0);var e=d.width();a.clientX-d.offset().left+h(document).scrollLeft()<e/2?(k.leftDrop=!0,k.showFeedback(d,!0)):(k.leftDrop=!1,k.showFeedback(d,!1))}else k.hideArrows(),b.$toolbar.hasClass("pq-drop-hover")?k.updateDragHelper(!0):k.updateDragHelper()},stop:function(a,c){k.status="stop";b.$header.find(".pq-grid-col-resize-handle").show();k.hideArrows()}})};r._columnIndexOf=function(a,d){for(var e=0,b=a.length;e<b;e++)if(a[e]==
d)return e;return-1};r._setupDroppables=function(a){var d=this.that,e=this,b={hoverClass:"pq-drop-hover ui-state-highlight",tolerance:"pointer",drop:function(a,c){if(!d.dropPending){var b=parseInt(c.draggable.attr("pq-col-indx")),g=parseInt(c.draggable.attr("pq-row-indx")),k=parseInt(h(this).attr("pq-col-indx")),l=h(this).attr("pq-row-indx"),m=d.options.colModel,p=d.headerCells,n=p[g][b],b=0==g?m:p[g-1][b].colModel,m=0==l?m:p[l-1][k].colModel,k=p[l][k],n=e._columnIndexOf(b,n),n=b.splice(n,1)[0],k=
e._columnIndexOf(m,k);m.splice(k+1-(e.leftDrop?1:0),0,n);d.dropPending=!0;window.setTimeout(function(){d._calcThisColModel();d.refresh();d.dropPending=!1},0)}}};a=d.$header_left.find("td.pq-left-col");var g=d.pqpanes.v?d.$header_right.find("td.pq-right-col"):d.$header_left.find("td.pq-right-col");a=a.add(g);a.each(function(a,c){var d=h(c);d.hasClass("ui-droppable")||d.droppable(b)})};k.options={detailModel:{cache:!0,offset:100,expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e"},
dragColumns:{enabled:!0,acceptIcon:"ui-icon-check",rejectIcon:"ui-icon-closethick",topIcon:"ui-icon-circle-arrow-s",bottomIcon:"ui-icon-circle-arrow-n"},track:null,treeModel:{collapsed:!0,indent:15,leafIcon:"ui-icon-radio-off",expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e"},filterModel:{on:!0,mode:"AND",header:!1}};k._create=function(){h.extend(h.paramquery.cGenerateView.prototype,g);var a=this;this.iHistory=new h.paramquery.cHistory(this);this.iGroupView=new l(this);this.iHeaderSearch=
new e(this);this.iUCData=new h.paramquery.cUCData(this);this.iMouseSelection=new h.paramquery.cMouseSelection(this);this._super.apply(this);this.iGroupView.bindEvents();this.iDragColumns=new m(this);this._createToolbar();this.refreshHeader();this.refreshDataAndView({header:!1});this.refresh({table:!0});var d=a.widgetEventPrefix.toLowerCase();a.element.one(d+"load."+a.widgetName,function(d,e){a.refresh()})};k._createToolbar=function(){var a=this.options,d=a.toolbar;if(d){var e=d.cls,b=d.style,g=d.attr,
d=d.items,e=h("<div class='"+(e?e:"")+"' style='"+(b?b:"")+"' "+(g?g:"")+" ></div>").appendTo(h(".pq-grid-top",this.element));e.pqToolbar({items:d,gridInstance:this});a.showToolbar||e.css("display","none");this.$toolbar=e}};k.isLeftOrRight=function(a){return a>this.freezeCols?"right":"left"};k.ovCreateHeader=function(a,d){this.options.filterModel.header&&this.iHeaderSearch.createDOM(a,d)};k._createHeader=function(){this._super.apply(this);this.options.showHeader&&this._trigger("createHeader")};k.exportExcel=
function(a){a.format="xml";return h.paramquery.pqgrid.exportToExcel.call(this,a)};k.exportCsv=function(a){a.format="csv";return h.paramquery.pqgrid.exportToExcel.call(this,a)};k.filter=function(a){var d=this,e=this.options,b=void 0===a.apply?!0:a.apply,g=void 0===a.sort?!0:a.sort,k=e.dataModel,e=e.filterModel;if(void 0!=a){var l="replace"==a.oper?!0:!1;a=a.data;for(var m=this.colModel,m=b?m:h.extend(!0,[],m),n=0,r=m.length,w=a.length,z=0;z<r;z++){for(var t=m[z],u=!1,x=0;x<w&&n!=w;x++){var y=a[x];
if(y.dataIndx==t.dataIndx){u=!0;n++;var x=t.filter,D=y.condition,v=y.value;x?x.on=!0:x=t.filter={on:!0};D&&(x.condition=D);D=x.condition;x.value=v;if("between"==D)x.value2=y.value2;else if("range"==D){y=[];if(v)if("string"==typeof v){var D=x.options,B=v.indexOf('"'),F=v.lastIndexOf('"'),v=v.substr(B,F+1),v=JSON.parse("["+v+"]");if(D)for(B=0,F=D.length;B<F;B++){var I=D[B];-1!=h.inArray(I,v)&&y.push(I)}else y=v.split(",s*")}else"function"==typeof v.push&&(y=v);x.value=y}break}}l&&!u&&t.filter&&(t.filter.on=
!1)}}var E={header:!1,apply:b,sort:g,CM:m};if("remote"==k.location&&"local"!=e.type)this.remoteRequest({apply:b,CM:m,callback:function(){return d._onDataAvailable(E)}});else return d._onDataAvailable(E)};k._initTypeColumns=function(){for(var a=this.colModel,d=0,e=a.length;d<e;d++){var g=a[d];"checkBoxSelection"===g.type?new h.paramquery.cCheckBoxColumn(this,g.dataIndx):"detail"===g.type&&(g.dataIndx="pq_detail",this.iHierarchy=new b(this))}};k.refreshHeader=function(){this._createHeader()};k.refreshDataFromDataModel=
function(){this._super.apply(this);this.options.groupModel&&this.iGroupView._refreshDataFromDataModel()};r=(h.paramquery.cSort=function(a){this.that=a}).prototype;r._refreshSorters=function(a){var d=this.that.options,e=d.dataModel,b=e.sortIndx,g=h.isArray(b),k=d.groupModel,l=k?k.dataIndx:null,m=k?k.dir:null,n=-1,d=[];if(k)for(k=0;k<l.length;k++){var r=l[k];r==a&&(n=k);d.push({dataIndx:r,dir:m&&m[k]?m[k]:"up"})}-1!==n?(a="up"===d[n].dir?"down":"up",d[n].dir=a,m[n]=a):null!=a&&(g?(m=h.inArray(a,e.sortIndx),
-1!=m?"up"==e.sortDir[m]?e.sortDir[m]="down":1==b.length?e.sortDir[m]="up":(e.sortIndx.splice(m,1),e.sortDir.splice(m,1)):(m=e.sortIndx.length,e.sortIndx[m]=a,e.sortDir[m]="up")):e.sortIndx==a?e.sortDir="up"==e.sortDir?"down":"up":(e.sortIndx=a,e.sortDir="up"));if(null!=e.sortIndx)if(g)for(k=0;k<b.length;k++)g=b[k],-1==this.inSorters(d,g)&&d.push({dataIndx:g,dir:e.sortDir[k]});else-1==this.inSorters(d,e.sortIndx)&&d.push({dataIndx:e.sortIndx,dir:e.sortDir});this.sorters=d};r.inSorters=function(a,
d){for(var e=-1,b=0;b<a.length;b++)if(a[b].dataIndx==d){e=b;break}return e};r._sortLocalData=function(a){for(var d=this.that,e=d.colModel,b=this.sorters,g=0;g<b.length;g++){var k=b[g],l=d.getColIndx({dataIndx:k.dataIndx});k.dataType=e[l].dataType}return this.__sortLocalData(b,a)};r.__sortLocalData=function(a,d){function e(a,c,d,b){a=a[d];c=c[d];a=a?parseInt(a,10):0;c=c?parseInt(c,10):0;return(a-c)*b}function b(a,c,d,e){a=a[d];c=c[d];a=a?Date.parse(a):0;c=c?Date.parse(c):0;return(a-c)*e}function g(a,
c,d,e){a=(a[d]+"").replace(/,/g,"");c=(c[d]+"").replace(/,/g,"");a=a?parseFloat(a):0;c=c?parseFloat(c):0;return(a-c)*e}function k(a,c,d,e){a=a[d];c=c[d];a=a?a:"";c=c?c:"";d=0;a>c?d=1:a<c&&(d=-1);return d*e}function l(a,c,d,e){a=a[d];c=c[d];a=a?a.toUpperCase():"";c=c?c.toUpperCase():"";d=0;a>c?d=1:a<c&&(d=-1);return d*e}function m(a,c,d,e){a=a[d];c=c[d];d=0;if(a&&!c||!1===a&&null===c)d=1;else if(c&&!a||!1===c&&null===a)d=-1;return d*e}function n(){for(var h=[],r=[],z=[],t=a.length,u=0;u<t;u++){var x=
a[u],y="up"==x.dir?1:-1,D=x.dataType;r[u]=x.dataIndx;z[u]=y;h[u]="integer"==D?e:"float"==D?g:"function"==typeof D?function(a){return function(c,d,e,b){return a(c[e],d[e])*b}}(D):"date"==D?b:"stringi"==D?l:"bool"==D?m:k}d=d.sort(function(a,c){for(var d=0,e=0;e<t&&(d=h[e](a,c,r[e],z[e]),0==d);e++);return d})}if(null!=d&&0!=d.length){if(!a||!a.length)return d;h.measureTime(n,"innerSort");return d}};k._refreshHeaderSortIcons=function(){var a=this.iSort.sorters,d=this.$header;if(d){d.find(".pq-grid-col").removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active");
d.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");for(var e=0;e<a.length;e++){var b=a[e],g=this.getColIndx({dataIndx:b.dataIndx}),k=b.dir,b="ui-state-active pq-col-sort-"+("up"==k?"asc":"desc"),k="ui-icon ui-icon-triangle-1-"+("up"==k?"n":"s");d.find(".pq-grid-col[pq-grid-col-indx="+g+"]").addClass(b);d.find(".pq-grid-col[pq-grid-col-indx="+g+"] .pq-col-sort-icon").addClass(k)}}};k.getHeaderColumnFromTD=function(a){a=a.attr("pq-grid-col-indx");if(null!=a)return this.colModel[a]};
k.getIndxInSorters=function(a){for(var d=this.sorters,e=0,b=d.length;e<b;e++)if(d[e].dataIndx==a)return e;return-1};k.getLargestRowCol=function(a){for(var d=0;d<a.length;d++);};k.bringCellToView=function(a){this._bringCellToView(a)};k._setUrl=function(a){this.options.dataModel.getUrl=function(){return{url:this.url+(null!=a?a:"")}}};k.getDataPage=function(){return this.data};k.getData=function(a){var d=a.dataIndx,e=d.length;a=a.data;var b=this.options.dataModel,g=b.data,b=b.dataUF,k=[],l=function(a){for(var c=
0,b=a.length;c<b;c++){for(var g=a[c],l={},m=0;m<e;m++){var h=d[m];l[h]=g[h]}k.push(l)}};a?l(a):(g&&l(g),b&&l(b));a=[];for(g=0;g<e;g++)b=d[g],l=this.getColumn({dataIndx:b}),a.push({dataIndx:b,dir:"up",dataType:l.dataType});k=this.iSort.__sortLocalData(a,k);a=[];g=void 0;for(b=0;b<k.length;b++){var l=k[b],m=JSON.stringify(l);m!==g&&(a.push(l),g=m)}return a};k.getFilterData=function(c){var d=c.CM;if(!d)throw"CM N/A";var e=d.length,b=c.location;c=this.options.filterModel.multiple;for(var g=h.paramquery.filter.getAllConditions,
k=h.paramquery.filter.getTRConditions,l=[],m=function(a,c,d){return"between"==a?null!=c&&""!==c||null!=d&&""!==d?!0:!1:-1!=h.inArray(a,g)?null!=c&&""!==c||-1==h.inArray(a,k)?!0:!1:!0},n=function(c,d){return"remote"==b?(null==c?"":c).toString():a.convert(c,d)},r=0;r<e;r++){var w=d[r],z=w.dataIndx,t=w.dataType,t=t&&"function"!=typeof t?t:"string",u=w.filter;if(c){if((u=w.filterModel)&&u.on){for(var x=[],y=u.mode,D=u.filters,w=0;w<D.length;w++){var u=D[w],v=u.value,B=u.condition;m(B,v)&&(v=n(v,t),x.push({value:v,
condition:B}))}l.push({dataIndx:z,mode:y,dataType:t,filters:x})}}else if(u&&u.on&&(v=u.value,x=u.value2,B=u.condition,m(B,v,x))){if("between"==B)""===v||null==v?(B="lte",v=n(x,t)):""===x||null==x?(B="gte",v=n(v,t)):(v=n(v,t),x=n(x,t));else if("regexp"==B)if("remote"==b)v=v.toString();else{if("string"==typeof v)try{var F=u.modifiers,F=F?F:"gi",v=new RegExp(v,F)}catch(I){v=/.*/}}else if("range"==B)if(null==v)continue;else if("string"==typeof v)v=n(v,t),v=v.split(/\s*,\s*/);else{if(v&&"function"==typeof v.push){if(0==
v.length)continue;v=v.slice();w=0;for(u=v.length;w<u;w++)v[w]=n(v[w],t)}}else v=n(v,t);l.push({dataIndx:z,value:v,value2:x,condition:B,dataType:t,cbFn:"remote"==b?"":a.conditions[B]})}}return l};var a=function(a){this.that=a},r=a.prototype;a.conditions={equal:function(a,d){if(a==d)return!0},contain:function(a,d){if(-1!=a.indexOf(d))return!0},notcontain:function(a,d){if(-1==a.indexOf(d))return!0},empty:function(a){if(0==a.length)return!0},notempty:function(a){if(0<a.length)return!0},begin:function(a,
d){if(0==a.indexOf(d))return!0},notbegin:function(a,d){if(0!=a.indexOf(d))return!0},end:function(a,d){var e=a.lastIndexOf(d);if(-1!=e&&e+d.length==a.length)return!0},notend:function(a,d){var e=a.lastIndexOf(d);if(-1==e||e+d.length!=a.length)return!0},regexp:function(a,d){if(d.test(a))return d.lastIndex=0,!0},notequal:function(a,d){if(a!=d)return!0},great:function(a,d){if(a>d)return!0},gte:function(a,d){if(a>=d)return!0},between:function(a,d,e){if(a>=d&&a<=e)return!0},range:function(a,d){if(-1!=h.inArray(a,
d))return!0},less:function(a,d){if(a<d)return!0},lte:function(a,d){if(a<=d)return!0}};a.convert=function(a,d){a=null==a?"":a;"string"==d?a=h.trim(a).toUpperCase():"date"==d?a=Date.parse(a):"integer"==d?a=parseInt(a):"float"==d?a=parseFloat(a):"bool"==d&&(a=String(a).toLowerCase());return a};r.isMatchCellSingle=function(c,d){var e=c.dataType,b=c.value,g=c.value2,k=c.cbFn,l=d[c.dataIndx],l="regexp"==c.condition?null==l?"":l:a.convert(l,e);return k(l,b,g)?!0:!1};r.isMatchCellMultiple=function(a,d){var e=
a.dataIndx,b=a.dataType,g=a.mode,k=a.filters,l=k.length;if(0==l)return!0;for(var m=0;m<l;m++){var h=k[m],h=this.isMatchRule(d[e],h.condition,h.value,b);if("OR"==g&&h)return!0;if("AND"==g&&!h)return!1}if(1===l)return h;if("AND"==g)return!0;if("OR"==g)return!1};r.isMatchRow=function(a,d,e){if(0==d.length)return!0;for(var b=0;b<d.length;b++){var g=this.isMatchCell(d[b],a);if("OR"==e&&g)return!0;if("AND"==e&&!g)return!1}if("AND"==e)return!0;if("OR"==e)return!1};k.filterLocalData=function(c){c=c?c:{};
var d=c.apply;c=!1===d?c.CM:this.colModel;var e=this.getFilterData({CM:c}),b=this.options,g=b.dataModel,k=g.data,l=g.dataUF,m=[],h=[],b=b.filterModel,n=b.multiple,r=b?b.mode:null,z=new a;z.isMatchCell=n?z.isMatchCellMultiple:z.isMatchCellSingle;if(b.on&&r){if(k)for(var n=0,t=k.length;n<t;n++){var u=k[n];z.isMatchRow(u,e,r)?m.push(u):h.push(u)}if(l)for(n=0,t=l.length;n<t;n++)u=l[n],z.isMatchRow(u,e,r)?m.push(u):h.push(u)}else{if(k)for(n=0,t=k.length;n<t;n++)u=k[n],m.push(u);if(l)for(n=0,t=l.length;n<
t;n++)u=l[n],m.push(u)}d&&(g.data=m,g.dataUF=h,this._trigger("filter",null,{type:"local",dataModel:g,colModel:c,filterModel:b}));return{data:m,dataUF:h}};k._onDataAvailable=function(a){a=a?a:{};var d=this.options,e=a.apply,b=a.sort,g=[],g=d.filterModel,d=d.dataModel,k=d.location;!1!==e&&this._trigger("dataAvailable",a.evt,{dataModel:d});g=g&&g.on&&("local"==k&&"remote"!=g.type||"remote"==k&&"local"==g.type)?this.filterLocalData(a).data:d.data;d.sorting&&"local"==d.sorting&&!1!==b&&(g=this.iSort._sortLocalData(g));
if(!1===e)return g;d.data=g;this.refreshView(a)};k.sort=function(a){var d=this,e=this.options,b=a.colIndx,g=e.editModel,k=a.dataIndx,l=a.evt,m=e.dataModel;if(null==b&&null==k&&(k=m.sortIndx,null==k))return;var b=null==b?this.getColIndx({dataIndx:k}):b,h=this.colModel[b],k=null==k?h.dataIndx:k;!1!=d._trigger("beforeSort",l,{dataModel:m,column:h,dataIndx:k})&&(g.indices&&d.blurEditor({force:!0}),this.iSort._refreshSorters(k),"local"==m.sorting?(this.iSort._sortLocalData(m.data),this.refreshView()):
"remote"==m.sorting&&this.remoteRequest({callback:function(){d._trigger("sort",l,{dataModel:m,column:h,dataIndx:k});d._onDataAvailable()}}))};k._setScrollVLength=function(a){a=this.options.groupModel?this.dataGM:a;this._super.call(this,a)};h.widget("paramquery.pqGrid",h.paramquery._pqGrid,k);h.paramquery.pqGrid.regional={};h.paramquery.pqGrid.regional.en=k._regional})(jQuery);
(function(h){h.paramquery=null==h.paramquery?{}:h.paramquery;h.paramquery.pqgrid=null==h.paramquery.pqgrid?{}:h.paramquery.pqgrid;h.paramquery.pqgrid.exportToExcel=function(b){var r=this,k=void 0===b.urlPost?b.url:b.urlPost,n=b.url,e=null==b.sheetName?"pqGrid":b.sheetName;b=b.format;var g=function(){for(var e=r.colModel,b=e.length,a=r.options.dataModel.data,c=a.length,d=[],f=[],g=[],k=0;k<b;k++){var h=e[k];!1!==h.copy&&(h=h.title.replace(/\"/g,'""'),f.push('"'+h+'"'))}d.push(f.join(","));for(k=0;k<
c;k++){for(var f=a[k],n=0;n<b;n++)h=e[n],!1!==h.copy&&(h=f[h.dataIndx]+"",h=h.replace(/\"/g,'""'),g.push('"'+h+'"'));d.push(g.join(","));g=[]}return d.join("\n")},g="xml"==b?function(){for(var b=r.colModel,g=b.length,a=r.options.dataModel.data,c=a.length,d=[],f=[],k=0;k<g;k++){var h=b[k];!1!==h.copy&&f.push('<Column ss:AutoFitWidth="1"  ss:Width="'+h._width+'" />')}f.push("<Row>");for(k=0;k<g;k++)h=b[k],!1!==h.copy&&f.push('<Cell><Data ss:Type="String">'+h.title+"</Data></Cell>");f.push("</Row>");
f=f.join("\n");for(k=0;k<c;k++){var n=a[k];d.push("<Row>");for(var A=0;A<g;A++)h=b[A],!1!==h.copy&&d.push('<Cell><Data ss:Type="String"><![CDATA['+n[h.dataIndx]+"]]\x3e</Data></Cell>");d.push("</Row>")}d=d.join("\n");return['<?xml version="1.0"?>\n<?mso-application progid="Excel.Sheet"?>\n<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"\n xmlns:o="urn:schemas-microsoft-com:office:office"\n xmlns:x="urn:schemas-microsoft-com:office:excel"\n xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"\n xmlns:html="http://www.w3.org/TR/REC-html40">\n<Worksheet ss:Name="',
e,'">\n<Table>',f,d,"</Table>\n</Worksheet>\n</Workbook>"].join("\n")}():g();h.ajax({url:k,type:"POST",cache:!1,data:{extension:b,excel:g},success:function(e){e=n+((0<n.indexOf("?")?"&":"?")+"filename="+e);h(document.body).append("<iframe height='0' width='0' frameborder='0'  src="+e+"></iframe>")}})}})(jQuery);
(function(h){var b=h.paramquery.pqGrid.prototype.options,r={on:!1,dirtyClass:"pq-cell-dirty"};b.trackModel=b.trackModel||r;b=(h.paramquery.cUCData=function(b){this.that=b;this.udata=[];this.ddata=[];this.adata=[];this.options=b.options;var h=this,e=b.eventNamespace,g=b.widgetEventPrefix.toLowerCase();b.element.on(g+"dataavailable"+e,function(e,b){h.belongs(e)&&(h.udata=[],h.ddata=[],h.adata=[])})}).prototype=new h.paramquery.cClass;b.add=function(b){var h=this.that,e=this.adata;b=b.rowData;for(var g=
this.options.trackModel.dirtyClass,l=h.getRecId({rowData:b}),m=0,a=e.length;m<a;m++){var c=e[m];if(null!=l&&c.recId==l)throw"primary key violation";if(c.rowData==b)throw"same data can't be added twice.";}var m=[],d;for(d in b)m.push(d);h.removeClass({rowData:b,dataIndx:m,cls:g});b={recId:l,rowData:b};e.push(b)};b.update=function(b){var n=this.that,e=this.options.trackModel.dirtyClass,g=b.rowData||n.getRowData(b),l=n.getRecId({rowData:g}),m=b.dataIndx,a=b.refresh,c=n.columns,d=h.paramquery.getValueFromDataType;
b=b.row;var f=this.udata,p=f.slice(0),r=!1;if(null!=l){for(var q=0,A=f.length;q<A;q++){var C=f[q],G=C.oldRow;if(C.rowData==g){r=!0;for(m in b)f=c[m].dataType,A=b[m],A=d(A,f),C=G[m],C=d(C,f),G.hasOwnProperty(m)&&C===A?(f={rowData:g,dataIndx:m,refresh:a,cls:e},n.removeClass(f),delete G[m]):(f={rowData:g,dataIndx:m,refresh:a,cls:e},n.addClass(f),G.hasOwnProperty(m)||(G[m]=g[m]));h.isEmptyObject(G)&&p.splice(q,1);break}}if(!r){G={};for(m in b)G[m]=g[m],f={rowData:g,dataIndx:m,refresh:a,cls:e},n.addClass(f);
f={rowData:g,recId:l,oldRow:G};p.push(f)}this.udata=p}};b["delete"]=function(b){var h=this.that,e=b.rowIndx,g=b.rowIndxPage,l=h.rowIndxOffset,e=null==e?g+l:e,g="remote"==h.options.pageModel.type?null==g?e-l:g:e,l=this.adata,m=this.ddata;b=h.getRowData(b);for(var h=0,a=l.length;h<a;h++)if(l[h].rowData==b){l.splice(h,1);return}m.push({indx:g,rowData:b,rowIndx:e})};b.isDirty=function(b){var h=this.udata,e=this.adata,g=this.ddata,l=!1;if(b=this.that.getRowData(b))for(e=0;e<h.length;e++){if(b==h[e].rowData){l=
!0;break}}else if(h.length||e.length||g.length)l=!0;return l};b.getChangesValue=function(){for(var b=this.udata,n=this.adata,e=this.ddata,g={updateList:[],addList:[],deleteList:[]},l=[],m=[],a=[],c=[],d=[],f=0,p=e.length;f<p;f++){var r=e[f],r=r.rowData,q={};c.push(r);for(var A in r)0!=A.indexOf("pq_")&&(q[A]=r[A]);d.push(q)}for(f=0;f<b.length;f++)if(r=b[f],r=r.rowData,-1==h.inArray(r,c)&&-1==h.inArray(r,l)){q={};for(A in r)0!=A.indexOf("pq_")&&(q[A]=r[A]);l.push(r);m.push(q)}for(f=0;f<n.length;f++){r=
n[f];r=r.rowData;q={};for(A in r)0!=A.indexOf("pq_")&&(q[A]=r[A]);a.push(q)}g.updateList=m;g.addList=a;g.deleteList=d;return g};b.getChanges=function(){for(var b=this.udata,n=this.adata,e=this.ddata,g={updateList:[],addList:[],deleteList:[]},l=[],m=[],a=[],c=0,d=e.length;c<d;c++){var f=e[c],f=f.rowData;a.push(f)}c=0;for(d=b.length;c<d;c++)f=b[c],f=f.rowData,-1==h.inArray(f,a)&&-1==h.inArray(f,l)&&l.push(f);c=0;for(d=n.length;c<d;c++)f=n[c],f=f.rowData,m.push(f);g.updateList=l;g.addList=m;g.deleteList=
a;return g};b.getChangesRaw=function(){var b=this.adata,h=this.ddata,e={updateList:[],addList:[],deleteList:[]};e.updateList=this.udata;e.addList=b;e.deleteList=h;return e};b.commitAdd=function(b,n){for(var e=this.that.colModel,g=e.length,l=this.adata,m=h.inArray,a=l.length,c=h.paramquery.getValueFromDataType,d=[],f=b.length,p=[],r=0;r<f;r++)for(var q=b[r],A=0;A<a;A++){var C=l[A].rowData,G=!0;if(-1==m(C,p)){for(var O=0;O<g;O++){var w=e[O],z=w.dataType,t=w.dataIndx;if(!w.hidden&&t!=n&&(w=C[t],w=c(w,
z),t=q[t],t=c(t,z),w!==t)){G=!1;break}}if(G){A={};G={};A[n]=q[n];G[n]=C[n];d.push({type:"update",rowData:C,oldRow:G,newRow:A});p.push(C);break}}}e=[];for(A=0;A<a;A++)C=l[A].rowData,-1==m(C,p)&&e.push(l[A]);this.adata=e;return d};b.commitUpdate=function(b,n){for(var e=this.that,g=this.options.trackModel.dirtyClass,l=e.colModel,m=l.length,a=this.udata,c=a.length,d=b.length,f=[],p=0;p<c;p++){var r=a[p],q=r.rowData,r=r.oldRow;if(-1==h.inArray(q,f))for(var A=0;A<d;A++)if(q[n]==b[A][n]){f.push(q);for(var C=
0;C<m;C++)var G=l[C].dataIndx;for(G in r)e.removeClass({rowData:q,dataIndx:G,cls:g})}}e=[];for(p=0;p<c;p++)q=a[p].rowData,-1==h.inArray(q,f)&&e.push(a[p]);this.udata=e;return[]};b.commitDelete=function(b,n){for(var e=this.ddata,g=e.length,l=b.length,m=[],a=0;a<g;a++)for(var c=e[a].rowData,d=0;d<l;d++)c[n]==b[d][n]&&m.push(c);l=[];for(a=0;a<g;a++)c=e[a].rowData,-1==h.inArray(c,m)&&l.push(e[a]);this.ddata=l};b.commitUpdateAll=function(){for(var b=this.that,h=this.options.trackModel.dirtyClass,e=this.udata,
g=0,l=e.length;g<l;g++){var m=e[g],a=m.oldRow,m=m.rowData,c;for(c in a)b.removeClass({rowData:m,dataIndx:c,cls:h})}this.udata=[]};b.commitAddAll=function(){this.adata=[]};b.commitDeleteAll=function(){this.ddata=[]};b.commit=function(b){var h=this.that,e=b?b.history:null,e=null==e?!1:e,g=[],g=[],l=[],m=h.options.dataModel.recIndx;if(null==b)this.commitAddAll(),this.commitUpdateAll(),this.commitDeleteAll();else{var a=b.type;b=b.rows;"add"==a?b?g=this.commitAdd(b,m):this.commitAddAll():"update"==a?b?
l=this.commitUpdate(b,m):this.commitUpdateAll():"delete"==a&&(b?this.commitDelete(b,m):this.commitDeleteAll())}g=g.concat(l);g.length&&(h._digestData({source:"commit",checkEditable:!1,track:!1,history:e,rowList:g}),h.refreshView())};b.rollbackAdd=function(b,h){for(var e=this.adata,g=[],l=0,m=e.length;l<m;l++)g.push({type:"delete",rowData:e[l].rowData});this.adata=[];return g};b.rollbackDelete=function(b,h){for(var e=this.ddata,g=[],l=e.length-1;0<=l;l--){var m=e[l];g.push({type:"add",rowIndx:m.rowIndx,
newRow:m.rowData})}this.ddata=[];return g};b.rollbackUpdate=function(b,h){for(var e=this.that,g=this.options.trackModel.dirtyClass,l=this.udata,m=[],a=0,c=l.length;a<c;a++){var d=l[a],f=d.rowData,p={},r=d.oldRow;if(null!=d.recId){var d=[],q;for(q in r)p[q]=f[q],d.push(q);e.removeClass({rowData:f,dataIndx:d,cls:g,refresh:!1});m.push({type:"update",rowData:f,newRow:r,oldRow:p})}}this.udata=[];return m};b.rollback=function(b){var h=this.that,e=h.options.pageModel,g=b&&null!=b.refresh?b.refresh:!0;b=
b&&null!=b.type?b.type:null;var l=[],l=[],m=[],a=[],c=h.options.dataModel.data;if(null==b||"update"==b)m=this.rollbackUpdate(e,c);if(null==b||"delete"==b)l=this.rollbackDelete(e,c);if(null==b||"add"==b)a=this.rollbackAdd(e,c);l=l.concat(a,m);h._digestData({history:!1,allowInvalid:!0,checkEditable:!1,source:"rollback",track:!1,rowList:l});g&&h.refreshView()};b=h.paramquery.pqGrid.prototype;b.getChanges=function(b){this.blurEditor({force:!0});if(b&&(b=b.format)){if("byVal"==b)return this.iUCData.getChangesValue();
if("raw"==b)return this.iUCData.getChangesRaw()}return this.iUCData.getChanges()};b.rollback=function(b){this.blurEditor({force:!0});this.iUCData.rollback(b)};b.isDirty=function(b){return this.iUCData.isDirty(b)};b.commit=function(b){this.iUCData.commit(b)};b._getRowIndx=function(){var b=this.selection({type:"row",method:"getSelection"});if(b&&0<b.length){var b=b[0].rowIndx,h=this.options.pageModel,e=b-this.rowIndxOffset,g=h.rPP;if(h.type){if(0<=e&&e<g)return b}else return b}else return null};b.updateRow=
function(b){var h=b.rowIndx,e=b.row,g=b.rowData||this.getRowData({rowIndx:h});if(!g)return!1;var l={},m;for(m in e)l[m]=g[m];if(!1===this._digestData({source:b.source||"update",history:b.history,checkEditable:b.checkEditable,track:b.track,allowInvalid:b.allowInvalid,rowList:[{newRow:e,oldRow:l,rowData:g,rowIndx:h,type:"update"}]}))return!1;!1!==b.refresh&&this.refreshRow({rowIndx:h})};b.updateElseAdd=function(b){var h=b.row;null==this.getRowData({rowIndx:b.rowIndx})?(b.rowData=h,this.addRow(b)):this.updateRow(b)};
b._fillForm=function(b){var h=this.colModel,e=this.rowIndxOffset,g=null==b.rowIndxPage?b.rowIndx-e:b.rowIndxPage;b=null==b.rowIndx?g+e:b.rowIndx;this.rowData=g=this.options.dataModel.data["remote"==this.options.pageModel.type?g:b];this.$crudDialog.dialog("option","title","Edit Record ("+(b+1)+")");b=this.$crudForm;for(e=0;e<h.length;e++){var l=h[e].dataIndx,m=g[l];b.find("*[name='"+l+"']").val(m)}};b.getRecId=function(b){b.dataIndx=this.options.dataModel.recIndx;b=this.getCellData(b);return null==
b?null:b};b.getCellData=function(b){var h=b.rowData||this.getRowData(b);b=b.dataIndx;return h?h[b]:null};b.getRowData=function(b){if(!b)return null;var h=b.rowData;if(null!=h)return h;var e=this.options,h=e.dataModel,e=e.pageModel.type,g=h.recIndx,l=b.recId,h=h.data;if(null!=l)for(b=0,e=h.length;b<e;b++){var m=h[b];if(m[g]==l)return m}else return g=b.rowIndx,b=b.rowIndxPage,l=this.rowIndxOffset,g=null!=g?g:b+l,b="remote"==e?null!=b?b:g-l:g,m=h?h[b]:null};b.deleteRow=function(b){var h=b.rowIndx,e=
b.rowIndxPage,g=this.rowIndxOffset,h=null!=e?e+g:h;null!=h&&(e=b.rowData||this.getRowData({rowIndx:h}),this._digestData({source:b.source||"delete",history:b.history,track:b.track,rowList:[{rowIndx:h,rowData:e,oldRow:e,type:"delete"}]}),!1!==b.refresh&&this.refreshView())};b.addRow=function(b){var h=b.rowData||b.row,e=b.rowIndx,g=b.rowIndxPage,l=this.rowIndxOffset,e=null!=g?g+l:e,g=this.options.dataModel,l=g.data;if(null==h)return null;null==l&&(g.data=[],l=g.data);if(!1===this._digestData({source:b.source||
"add",history:b.history,track:b.track,checkEditable:b.checkEditable,rowList:[{newRow:h,rowIndx:e,type:"add"}]}))return!1;!1!==b.refresh&&this.refreshView();return null==e?l.length-1:e}})(jQuery);
(function(h){h.widget("paramquery.pqToolbar",{options:{items:[],gridInstance:null},_create:function(){var b=this.options,r=b.gridInstance,k=r.colModel,n=b.items,e=this.element;e.closest(".pq-grid");e.addClass("pq-toolbar");for(var g=0,l=n.length;g<l;g++){var m=n[g],b=m.type,a=m.icon,c=m.label,d=m.listener,f=d?[d]:m.listeners,d=m.cls,d="ui-corner-all "+(d?d:""),p=m.style,p=p?'style="'+p+'"':"",s=m.attr,s=s?s:"",q;"textbox"==b?q=h("<input type='text' class='"+d+"' "+s+" "+p+">").appendTo(e):"checkbox"==
b?q=h("<input type='checkbox' class='"+d+"' "+s+" "+p+">").appendTo(e):"separator"==b?h("<span class='pq-separator '"+d+"' "+s+" "+p+"></span>").appendTo(e):"button"==b?(b=m.options?m.options:{},h.extend(b,{text:c?!0:!1,icons:{primary:a}}),q=h("<button type='button' class='"+d+"' "+s+" "+p+">"+c+"</button>").button(b).appendTo(e)):"select"==b?(b=m.options?m.options:[],"function"===typeof b&&(b=b.call(r.element[0],{colModel:k})),q=h.paramquery.select({options:b,attr:" class='"+d+"' "+s+" "+p,prepend:m.prepend,
groupIndx:m.groupIndx,valueIndx:m.valueIndx,labelIndx:m.labelIndx}),q=h(q).appendTo(e)):"string"==typeof b?q=h(b).appendTo(e):"function"==typeof b&&(q=b.call(r.element[0],{colModel:k,cls:d}),q=h(q).appendTo(e));if(f)for(m=0;m<f.length;m++){var d=f[m],A;for(A in d)q.bind(A,d[A])}}},_destroy:function(){this.element.empty().removeClass("pq-toolbar").enableSelection()},_disable:function(){null==this.$disable&&(this.$disable=h("<div class='pq-grid-disable'></div>").css("opacity",.2).appendTo(this.element))},
_enable:function(){this.$disable&&(this.element[0].removeChild(this.$disable[0]),this.$disable=null)},_setOption:function(b,h){"disabled"==b&&(!0==h?this._disable():this._enable())}})})(jQuery);
(function(h){var b=function(){this.focusSelection=null},r=b.prototype;r.triggerSelectChange=function(b){var g=this.that;if(g.options.selectionModel.triggerSelectChange){var l=g.iRows.getSelection(),k=g.iCells.getSelection();g._trigger("selectChange",b,{rows:l,cells:k})}};r.getOldRowSel=function(){var b=this.that,g;if((g=this.focusSelection)&&this.isSelected(g))return b=b.getRowIndx(g),b.rowData=g.rowData,b};r.getOldCellSel=function(){var b=this.that,g;if((g=this.focusSelection)&&this.isSelected(g)){var l=
g.rowData,b=b.getRowIndx({rowData:l});b.rowData=l;b.dataIndx=g.dataIndx;return b}};r.getNewRowSel=function(){var b=this.that,g=document.activeElement?h(document.activeElement):null;if(g&&g.hasClass("pq-grid-row")&&g.closest(".pq-grid")[0]==b.element[0])return b=b.getRowIndx({$tr:g}),b.$tr=g,b};r.getNewCellSel=function(){var b=this.that,g=document.activeElement?h(document.activeElement):null;if(g&&g.hasClass("pq-grid-cell")&&g.closest(".pq-grid")[0]==b.element[0])return b=b.getCellIndices({$td:g}),
b.$td=g,b};r.getFocusSelection=function(b){if(this instanceof k)return b&&!0===b.old?this.getOldRowSel():this.getNewRowSel();if(this instanceof n)return b&&!0===b.old?this.getOldCellSel():this.getNewCellSel()};r.getFirstSelection=function(){var b=this.firstSelection;if(b&&this.isSelected(b))return b;this.refresh();b=this.selection;if(b.length)return this.firstSelection=b[0],b[0]};r.getLastSelection=function(){var b=this.lastSelection;if(b){var g=b.rowData,l=this.that.getRowData({rowIndx:rowIndx});
return g==l&&this.isSelected(b)?b:!1}return null};r.getLastSelectionCurPage=function(){var b=this.lastSelection;if(b&&this.isSelected(b)){var g=b.rowIndx,l=this.that.options.pageModel;if(l.type){var k=l.curPage;return Math.ceil((g+1)/l.rPP)==k?b:null}return b}return null};r.getSelection=function(){this.refresh();return this.selection};r.getSelectionCurPage=function(){var b=this.that,g=this.getSelection(),l=[],k=b.options.pageModel;if(k.type){for(var b=k.curPage,k=k.rPP,a=0;a<g.length;a++){var c=g[a];
Math.ceil((c.rowIndx+1)/k)==b&&l.push(c)}return l}return g};r.inViewRow=function(b){var g=this.that,l=this.options,k=g.rowIndxOffset,a=g.initV,c=g.finalV;if(b<l.freezeRows)return!0;if(l.groupModel){if((g=g.dataGM)&&g.length)for(;a<=c;a++)if(l=g[a].rowIndx-k,null!=l&&l==b)return!0;return!1}return b>=a&&b<=c};r.setDirty=function(){};var k=function(b){this.that=b;this.options=b.options;this.selection=[]};h.paramquery.cRows=k;var n=function(b){this.options=b.options;this.that=b;this.selection=[]};h.paramquery.cCells=
n;r=n.prototype=new b;b=k.prototype=new b;b.extendSelection=function(b){var g=this.that,l=b.rowIndx,k=g.options.selectionModel.mode;b=b.evt;var a=this.getFirstSelection();null==a?g.setSelection({rowIndx:l}):"single"!=k&&(k=g=a.rowIndx,a=l,g>l&&(k=l,a=g),this.selectRange({initRowIndx:k,finalRowIndx:a,evt:b}),this.add({rowIndx:l}))};b.refresh=function(){this.selection=[];var b=this.that,g=b.options,l="remote"==g.pageModel.type?!0:!1,b=b.rowIndxOffset,k=[];if(g=g.dataModel.data){for(var a=0,c=g.length;a<
c;a++){var d=g[a];d.pq_rowselect&&k.push({rowIndx:l?a+b:a,rowData:d})}this.selection=k}};b.replace=function(b){var g=b.rowIndx,l=null==b.offset?this.that.getRowIndxOffset():b.offset;b.offset=l;b.rowIndxPage=g-l;this.removeAll({raiseEvent:!0});this.add(b)};b.indexOf=function(b){this.refresh();b=b.rowIndx;for(var g=this.selection,l=0;l<g.length;l++)if(g[l].rowIndx==b)return l;return-1};b.isSelected=function(b){var g=this.that;return(b=b.rowData||g.getRowData(b))?null==b.pq_rowselect?!1:b.pq_rowselect:
null};b._boundRow=function(b){var g=b.rowIndxPage,l=this.that;b=null==b.$tr?l.getRow({rowIndxPage:g}):b.$tr;if(null==b||0==b.length)return!1;b.addClass("pq-row-select ui-state-highlight");return b};b.selectRange=function(b){var g=b.initRowIndx,l=b.finalRowIndx;b=b.evt;for(var k=this.getSelection().slice(0),a=[],c=0;c<k.length;c++){var d=k[c],f=d.rowIndx;(f<g||f>l)&&a.push({rowIndx:f,rowData:d.rowData})}this.remove({rows:a,evt:b});a=[];g>l&&(k=g,g=l,l=k);for(f=g;f<=l;f++)a.push({rowIndx:f,evt:b});
this.add({rows:a,evt:b})};r._addToData=function(b){var g=b.dataIndx;b=this.that.getRowData(b);b.pq_cellselect||(b.pq_cellselect={});b.pq_cellselect[g]=!0};r.extendSelection=function(b){var g=this.that,l=this.getFirstSelection(),k=b.rowIndx,a=b.colIndx,c=g.options.selectionModel.mode;b=b.evt;if(null==l)g.setSelection({rowIndx:k,colIndx:a});else{var d=l.rowIndx,g=g.getColIndx({dataIndx:l.dataIndx}),l=d,f=k,h=g,n=a;d>k&&(l=k,f=d);"range"==c?(d>k&&(h=a,n=g),k==d&&a<g&&(h=a,n=g),this.selectRange({initRowIndx:l,
initColIndx:h,finalRowIndx:f,finalColIndx:n,evt:b}),this.add({rowIndx:k,colIndx:a})):"block"==c&&(g>a&&(h=a,n=g),this.selectBlock({initRowIndx:l,initColIndx:h,finalRowIndx:f,finalColIndx:n,evt:b}),this.add({rowIndx:k,colIndx:a}))}};r._removeFromData=function(b){var g=b.rowData;g&&g.pq_cellselect&&delete g.pq_cellselect[b.dataIndx]};r.removeAll=function(){this.refresh();var b=this.selection.slice(0),g=this;h.measureTime(function(){g.remove({cells:b})},"removeAll");this.lastSelection=null};b.removeAll=
function(b){var g=this.that,k=b?b.page:!1;this.refresh();b=this.selection.slice(0);if(k){for(var k=[],h=g.rowIndxOffset,g=(g=g.data)?g.length:0,a=0,c=b.length;a<c;a++){var d=b[a],f=d.rowIndx-h;if(0<=f)if(f<g)k.push(d);else break}this.remove({rows:k})}else this.remove({rows:b}),this.lastSelection=null};r.isSelected=function(b){var g=this.that,k=b.rowData||g.getRowData(b),h=b.dataIndx;b=b.colIndx;if(null==b&&null==h||null==k)return null;h=null==h?g.colModel[b].dataIndx:h;return k.pq_cellselect&&k.pq_cellselect[h]?
!0:!1};r.refresh=function(){this.selection=[];var b=this.that,g=b.options.dataModel.data,k=[],h="remote"==b.options.pageModel.type?!0:!1,b=b.rowIndxOffset,a=this.that.colModel,c=a.length;if(g){for(var d=[],f=0;f<c;f++){var n=a[f].dataIndx;d[f]=n}for(var f=0,r=g.length;f<r;f++){var q=g[f],A=q.pq_cellselect;if(A)for(var C=h?f+b:f,G=0;G<c;G++)n=d[G],A[n]&&k.push({rowIndx:C,rowData:q,dataIndx:n,colIndx:G,column:a[G]})}this.selection=k}};r.replace=function(b){var g=b.rowIndx,k=null==b.offset?this.that.getRowIndxOffset():
b.offset;b.rowIndxPage=g-k;b.offset=k;this.removeAll({raiseEvent:!0});this.add(b)};r.inViewCell=function(b,g){var k=this.that,h=this.options.freezeCols;return this.inViewRow(b)?g<h||g>=k.initH&&g<=k.finalH:!1};r._add=function(b){var g=this.that,k=b.rowIndx,h=b.rowIndxPage,a=b.rowData||g.getRowData(b),c=g.rowIndxOffset,d,k=null==k?h+c:k,h=null==h?k-c:h,c=b.colIndx,f=b.dataIndx,c=null==c?g.getColIndx({dataIndx:f}):c,n=g.colModel[c],f=null==f?n.dataIndx:f,r=b.evt,q=this.isSelected({rowData:a,dataIndx:f});
if(null==q)return!1;var A=this.inViewCell(h,c);if(!1===q){if(A){var C=g.getCell({rowIndxPage:h,colIndx:c});C&&C.addClass("pq-cell-select ui-state-highlight")}this._addToData({rowData:a,dataIndx:f});!1!==b.trigger&&g._trigger("cellSelect",r,{rowIndx:k,rowIndxPage:h,colIndx:c,dataIndx:f,column:n,rowData:a});d=!0}this.lastSelection={rowIndx:k,dataIndx:f,rowData:a};!1!==b.focus&&A&&(C&&C.length||(C=g.getCell({rowIndxPage:h,dataIndx:f})),C&&C.length&&(C.attr("tabindex","0"),C.focus(),g._fixTableViewPort(),
this.focusSelection={rowData:a,rowIndx:k,dataIndx:f}));b.setFirst&&(this.firstSelection={rowIndx:k,rowData:a,dataIndx:f});if(d)return{rowIndx:k,rowData:a,dataIndx:f,colIndx:c,column:n}};b._add=function(b){var g=this.that,k,m=b.rowIndx,a=b.rowIndxPage,c=g.rowIndxOffset,m=null==m?a+c:m,a=null==a?m-c:a,d=null==d?g.getRowData(b):d,c=b.$tr,f=b.evt,n=this.isSelected({rowData:d});b.rowIndxPage=a;if(null==n)return!1;var r=this.inViewRow(a);!1===n&&(r&&(c=this._boundRow(b)),d.pq_rowselect=!0,!1!==b.trigger&&
g._trigger("rowSelect",f,{rowIndx:m,rowIndxPage:a,rowData:d,$tr:c}),k=!0);this.lastSelection={rowIndx:m,rowData:d};!1!==b.focus&&r&&(c&&c.length||(c=g.getRow({rowIndxPage:a})),c&&(c=h(c[0]),c.attr("tabindex","0"),c.focus(),g._fixTableViewPort(),this.focusSelection={rowData:d,rowIndx:m}));b.setFirst&&(this.firstSelection={rowIndx:m,rowData:d});if(k)return{rowIndx:m,rowData:d}};r.add=function(b){var g=this.that,k=b.evt,h=b.cells,a=!1,c=[];if(h&&"function"==typeof h.push){b=0;for(var d=h.length;b<d;b++)a=
h[b],a.trigger=!1,(a=this._add(a))&&c.push(a);c.length&&(a=!0,g._trigger("cellSelect",k,{cells:c}))}else a=this._add(b);a&&(g._fixIE(),this.triggerSelectChange(k))};b.add=function(b){var g=this.that,k=b.evt,h=b.rows,a=!1,c=[];if(h&&"function"==typeof h.push){b=0;for(var d=h.length;b<d;b++)a=h[b],a.trigger=!1,(a=this._add(a))&&c.push(a);c.length&&(a=!0,g._trigger("rowSelect",k,{rows:c}))}else a=this._add(b);a&&this.triggerSelectChange()};r._remove=function(b){var g=this.that,k=b.rowIndx,h=b.rowIndxPage,
a=g.rowIndxOffset,k=null==k?h+a:k,h=null==h?k-a:h,a=b.rowData||g.getRowData(b),c=b.colIndx,d=b.dataIndx,c=null==c?g.getColIndx({dataIndx:d}):c,f=b.column,f=null==f?g.colModel[c]:f,d=null==d?f.dataIndx:d,n=b.evt;if(this.isSelected({rowData:a,dataIndx:d}))return this.inViewCell(h,c)&&(h=g.getCell({rowIndxPage:h,colIndx:c,all:!0}))&&(h.removeClass("pq-cell-select ui-state-highlight"),h.removeAttr("tabindex")),this._removeFromData({rowData:a,dataIndx:d}),!1!==b.trigger&&g._trigger("cellUnSelect",n,{rowIndx:k,
colIndx:c,dataIndx:d,rowData:a}),{rowIndx:k,rowData:a,dataIndx:d,colIndx:c,column:f}};b._remove=function(b){var g=this.that,k=b.rowIndx,h=b.rowIndxPage,a=g.rowIndxOffset,k=null==k?h+a:k,h=null==h?k-a:h,a=b.rowData,a=null==a?g.getRowData(b):a,c=b.$tr,d=b.evt;if(this.isSelected({rowData:a}))return this.inViewRow(h)&&(c=g.getRow({rowIndxPage:h}))&&(c.removeClass("pq-row-select ui-state-highlight"),c.removeAttr("tabindex")),a.pq_rowselect=!1,!1!==b.trigger&&g._trigger("rowUnSelect",d,{rowIndx:k,rowData:a,
$tr:c}),{rowIndx:k,rowData:a}};r.remove=function(b){var g=b.cells,k=!1;if(g&&"function"==typeof g.push){for(var h=[],a=0,c=g.length;a<c;a++)k=g[a],k.trigger=!1,(k=this._remove(k))&&h.push(k);h.length&&(k=!0,this.that._trigger("cellUnSelect",b.evt,{cells:h}))}else k=this._remove(b);k&&this.triggerSelectChange()};b.remove=function(b){var g=b.rows,k=!1;if(g&&"function"==typeof g.push){for(var h=[],a=0,c=g.length;a<c;a++)k=g[a],k.trigger=!1,(k=this._remove(k))&&h.push(k);h.length&&(k=!0,this.that._trigger("rowUnSelect",
b.evt,{rows:h}))}else k=this._remove(b);k&&this.triggerSelectChange()};r.indexOf=function(b){this.refresh();var g=b.rowIndx,k=this.that,k=null==b.dataIndx?k.colModel[b.colIndx].dataIndx:b.dataIndx;b.dataIndx=k;b=this.selection;for(var h=0;h<b.length;h++){var a=b[h];if(a.rowIndx==g&&a.dataIndx==k)return h}return-1};r.selectAll=function(b){var g=this.that,k=b&&b.all?!0:!1;b=k?this.options.dataModel.data:g.data;var m=g.rowIndxOffset,a=g.colModel,c=a.length,d=[],g=function(b,e){for(var g=0;g<c;g++){var f=
a[g];f.hidden||d.push({rowIndx:e,rowData:b,colIndx:g,dataIndx:f.dataIndx,focus:!1})}};if(b){for(var f=0,n=b.length;f<n;f++)var r=b[f];if(k)for(k="remote"==this.options.pageModel.type?!0:!1,f=0,n=b.length;f<n;f++){var r=b[f],q=f;k&&(q=f+m);g(r,q)}else for(f=0,n=b.length;f<n;f++)r=b[f],q=f+m,g(r,q);var A=this;h.measureTime(function(){A.add({cells:d})},"selectAll with length = "+d.length)}};b.selectAll=function(b){var g=this.that,k=b&&b.all?!0:!1,g=k?this.options.dataModel.data:g.data;b=[];if(g){if(k)for(var k=
"remote"==this.options.pageModel.type?!0:!1,h=0,a=g.length;h<a;h++){var c={rowData:g[h],focus:!1};k?c.rowIndxPage=h:c.rowIndx=h;b.push(c)}else for(h=0,a=g.length;h<a;h++)b.push({rowIndxPage:h,rowData:g[h],focus:!1});this.add({rows:b})}};r.selectRange=function(b){var g=this.that,k=b.initRowIndx,h=b.initColIndx,a=b.finalRowIndx;b=b.finalColIndx;for(var c=g.colModel,d=c.length,f=this.getSelection().slice(0),n=[],r=0;r<f.length;r++){var q=f[r],A=q.rowIndx,C=q.dataIndx,q=g.getColIndx({dataIndx:C});A<k||
A>a?n.push({rowIndx:A,colIndx:q,dataIndx:C}):A==k&&q<h?n.push({rowIndx:A,colIndx:q,dataIndx:C}):A==a&&q>b&&n.push({rowIndx:A,colIndx:q,dataIndx:C})}this.remove({cells:n});n=[];for(q=0;q<d;q++)if(g=c[q],!g.hidden){C=g.dataIndx;A=k;do{if(!(A==k&&q<h))if(A==a&&q>b)break;else n.push({rowIndx:A,colIndx:q,dataIndx:C,focus:!1});A++}while(A<=a)}this.add({cells:n})};r.selectBlock=function(b){var g=this.that,k=b.initRowIndx,h=b.initColIndx,a=b.finalRowIndx,c=b.finalColIndx;b=b.evt;for(var d=this.getSelection().slice(0),
f=g.colModel,n=[],r=0;r<d.length;r++){var q=d[r],A=q.rowIndx,q=q.dataIndx,C=g.getColIndx({dataIndx:q});C<h||C>c?n.push({rowIndx:A,colIndx:C,dataIndx:q}):(A<k||A>a)&&n.push({rowIndx:A,colIndx:C,dataIndx:q})}this.remove({cells:n});n=[];for(C=h;C<=c;C++)if(g=f[C],q=g.dataIndx,!g.hidden){A=k;do n.push({rowIndx:A,colIndx:C,dataIndx:q,focus:!1}),A++;while(A<=a)}this.add({cells:n,evt:b})}})(jQuery);
(function(h){var b=(h.paramquery.cCheckBoxColumn=function(b,k){var h=this;this.that=b;this.options=b.options;this.type="checkBoxSelection";this.cbDataIndx=k;var e=b.widgetEventPrefix.toLowerCase(),g=b.element,l=b.eventNamespace;g.on(e+"dataavailable"+l,function(b,a){if(h.belongs(b))return h._onDataAvailable(b,a)});g.on(e+"cellclick"+l,function(b,a){if(h.belongs(b))return h.cellClick(b,a)});g.on(e+"rowselect"+l,function(b,a){if(h.belongs(b))return h.rowSelect(b,a)});g.on(e+"rowunselect"+l,function(b,
a){if(h.belongs(b))return h.rowUnSelect(b,a)});g.on(e+"cellkeydown"+l,function(b,a){if(h.belongs(b))return h.cellKeyDown(b,a)});g.on(e+"refresh"+l+" "+e+"refreshrow"+l,function(b,a){if(h.belongs(b))return h.refreshHeader(b,a)})}).prototype=new h.paramquery.cClass;b.hasHeaderChkBox=function(){return!1===this.options.selectionModel.cbHeader?!1:!0};b.setValCBox=function(){if(this.hasHeaderChkBox()){for(var b=this.that,k=this.options,b=k.selectionModel.cbAll?k.dataModel.data:b.data,k=null,h=0,e=0,g=0,
l=b.length;g<l;g++)b[g].pq_rowselect?h++:e++;h==l?k=!0:e==l&&(k=!1);this.$inp.pqval({val:k})}};b.refreshHeader=function(b,k){if(this.hasHeaderChkBox()){var n=this.that;if(n.data){var e=this;if(n=n.getCellHeader({dataIndx:this.cbDataIndx}))n.html("<input type='checkbox'/>"),this.$inp=n.find("input").click(function(b){h(this).is(":checked")?e.selectAllRows():e.unSelectAllRows();b.stopPropagation()}),this.setValCBox()}}};b.selectAllRows=function(){this.that.iRows.selectAll({all:this.options.selectionModel.cbAll})};
b.unSelectAllRows=function(){var b=this.that;this.options.selectionModel.cbAll?b.iRows.removeAll():b.iRows.removeAll({page:!0})};b._onDataAvailable=function(){var b=this.options.dataModel.data,k=this._findSelectionIndx();if(null!=k&&b)for(var h=0,e=b.length;h<e;h++){var g=b[h];g[k]&&(g.pq_rowselect=!0)}};b._findSelectionIndx=function(){if(this.cbDataIndx)return this.cbDataIndx};b.cellClick=function(b,k){var h=this.that,e=k.rowIndx,g=k.rowData,l=k.column,m=this.type;if(l&&l.type===m)return g[l.dataIndx]?
h.iRows.remove({rowIndx:e}):h.iRows.add({rowIndx:e}),b.stopPropagation(),!1};b.rowSelect=function(b,k){var h=this.that,e=k.rows,g=k.rowData,l=this._findSelectionIndx();if(e)for(var m=0,a=e.length;m<a;m++){var g=e[m],c=g.rowIndx,g=g.rowData;g[l]=!0;h.refreshCell({rowIndx:c,dataIndx:l})}else g&&(g[l]=!0,c=k.rowIndx,h.refreshCell({rowIndx:c,dataIndx:l}));this.setValCBox()};b.rowUnSelect=function(b,k){var h=this.that,e=k.rows,g=k.rowData,l=this._findSelectionIndx();if(e)for(var m=0,a=e.length;m<a;m++){var g=
e[m],c=g.rowIndx,g=g.rowData;g[l]=!1;h.refreshCell({rowIndx:c,dataIndx:l})}else g&&(g[l]=!1,c=k.rowIndx,h.refreshCell({rowIndx:c,dataIndx:l}));this.setValCBox()};b.cellKeyDown=function(b,k){var h=this.that,e=k.rowIndx,e=k.column,g,l=this.type;if(e&&e.type===l&&(l=e.dataIndx,e=k.rowIndx,13==b.keyCode||32==b.keyCode))return g[l]?h.selection({type:"row",method:"remove",rowIndx:e}):h.selection({type:"row",method:"add",rowIndx:e}),b.stopPropagation(),b.preventDefault(),!1}})(jQuery);
(function(h){function b(b){this.that=b;var k=this,h=b.element,e=b.widgetEventPrefix.toLowerCase();b=b.eventNamespace;h.on(e+"contmousedown"+b,function(b,e){if(k.belongs(b))return k._onContMouseDown(b,e)});h.on(e+"mousedrag"+b,function(b,e){if(k.belongs(b)&&k.swipedown)return k._onMouseDrag(b,e)});h.on(e+"mousestop"+b,function(b,e){return k._onMouseStop(b,e)});h.on(e+"mousepqup."+b,function(b,e){return k._onMousePQUp(b,e)});h.on(e+"rowmousedown"+b,function(b,e){if(k.belongs(b))return k._onRowMouseDown(b,
e)});h.on(e+"cellmousedown"+b,function(b,e){if(k.belongs(b))return k._onCellMouseDown(b,e)});h.on(e+"beforetableview"+b,function(b,e){if(k.belongs(b))return k._beforeTableView(b,e)});h.on(e+"refresh"+b,function(b,e){if(k.belongs(b))return k._onRefresh(b,e)});h.on(e+"cellmouseenter"+b,function(b,e){if(k.belongs(b))return k._onCellMouseEnter(b,e)});h.on(e+"rowmouseenter"+b,function(b,e){if(k.belongs(b))return k._onRowMouseEnter(b,e)})}h.paramquery.cMouseSelection=b;h=b.prototype=new h.paramquery.cClass;
h._beforeTableView=function(b,k){var h=this.that,e=h.getFocusElement();this.lastFocus=null;e&&e.$grid&&(e=e.$ae,e.hasClass("pq-grid-row")?this.lastFocus=h=h.getRowIndx({$tr:e}):e.hasClass("pq-grid-cell")&&(this.lastFocus=h=h.getCellIndices({$td:e})))};h._onRefresh=function(b,k){var h=this.that,e=this.lastFocus;e&&(e=null!=e.dataIndx?h.getCell(e):h.getRow(e))&&e.length&&h.inViewPort(e)&&e.attr("tabindex","0").focus()};h._onCellMouseDown=function(b,k){var h=this.that,e=k.rowIndx,g=k.colIndx,l=h.options.selectionModel,
m=l.mode;if("cell"==l.type&&null!=g)return b.shiftKey?(h.iCells.extendSelection({rowIndx:e,colIndx:g,mode:m,evt:b}),b.preventDefault()):b.ctrlKey&&"single"!=m?h.iCells.isSelected({rowIndx:e,colIndx:g})?h.iCells.remove({rowIndx:e,colIndx:g}):h.setSelection({rowIndx:e,colIndx:g}):(this.mousedown={rowIndx:e,colIndx:g},h.setSelection(null),h.setSelection({rowIndx:e,colIndx:g,setFirst:!0})),!0};h._onCellMouseEnter=function(b,k){var h=this.that;if("cell"==h.options.selectionModel.type&&this.mousedown){var e=
this.mousedown,g=e.c1,l=k.rowIndx,m=k.colIndx;if(e.r1!=l||g!=m)if(e.r2!=l||e.c2!=m)this.mousedown.r2=l,this.mousedown.c2=m,h.iCells.extendSelection({rowIndx:l,colIndx:m,evt:b})}};h._onRowMouseEnter=function(b,k){var h=this.that;if("row"==h.options.selectionModel.type&&this.mousedown){var e=k.rowIndx;this.mousedown.r1!=e&&this.mousedown.r2!=e&&(this.mousedown.r2=e,h.iRows.extendSelection({rowIndx:e,evt:b}))}};h._onRowMouseDown=function(b,k){var h=this.that,e=k.rowIndx,g=h.options.selectionModel,l=
g.mode;if("row"==g.type&&null!=e)return b.shiftKey?(h.iRows.extendSelection({rowIndx:e,evt:b}),b.preventDefault()):b.ctrlKey&&"single"!=l?h.iRows.isSelected({rowIndx:e})?h.iRows.remove({rowIndx:e}):h.setSelection({rowIndx:e}):(this.mousedown={r1:e,y1:b.pageY,x1:b.pageX},h.setSelection(null),h.setSelection({rowIndx:e,setFirst:!0})),!0};h._onContMouseDown=function(b,h){this.that.options.swipeModel.on&&(this._stopSwipe(!0),this.swipedown={x:b.pageX,y:b.pageY});return!0};h._onMousePQUp=function(b,h){this.mousedown=
null};h._stopSwipe=function(b){b&&(this.swipedownPrev=this.swipedown=null);window.clearInterval(this.intID);this.intID=null};h._onMouseStop=function(b,h){var n=this,e=this.that;if(this.swipedownPrev){var g=e.options.swipeModel,e=this.swipedownPrev,l=e.ts,m=(new Date).getTime()-l,a=b.pageX,c=b.pageY,d=a-e.x,f=c-e.y;if(Math.sqrt(d*d+f*f)/m>g.ratio){var p=0,s=g.repeat;n._stopSwipe();n.intID=window.setInterval(function(){p+=g.speed;s--;0>=s&&n._stopSwipe(!0);n._onMouseDrag({pageX:a+p*d/m,pageY:c+p*f/
m})},50)}else n.swipedown=null,n.swipedownPrev=null}};h._onMouseDrag=function(b,h){var n=this.that,e=n.options;if(this.swipedown){var g=this.swipedown,l=g.x,m=g.y,a=b.pageX,c=b.pageY;this.swipedownPrev={x:l,y:m,ts:(new Date).getTime()};n.$td_edit&&n.quitEditMode({silent:!0});e.virtualY||(this._scrollVertSmooth(m,c),n._syncScrollBarVert());e.virtualX||(this._scrollHorSmooth(l,a),n._syncScrollBarHor());g.x=a;g.y=c}return!0};h.updateTableY=function(b){if(0==b)return!1;var h=this.that,n=h.getTableForVertScroll(),
e=h.$cont,h=h._getScollBarHorizontalHeight(),e=e.data("offsetHeight")-h;if(!n||!n.length)return!1;var h=n.data("offsetHeight"),g=parseInt(n.css("marginTop"))+b;0<=g?n.css({marginTop:-1}):0>b&&0<e-h-g?0<e-n[0].offsetHeight-g?(b=e-n[0].offsetHeight,0>b&&n.css({marginTop:b})):n.css({marginTop:g}):n.css({marginTop:g});return!0};h._scrollVertSmooth=function(b,h){b!=h&&this.updateTableY(h-b)};h._scrollHorSmooth=function(b,h){if(b!=h){var n=this.that,e=h-b,g=n.getTableForHorScroll(),l=n.getTableHeaderForHorScroll(),
m=n.$cont,n=n._getSBWidth(),m=m.data("offsetWidth")-n;if(g||l){var a=g?g:l,n=a.data("scrollWidth"),e=parseInt(a.css("marginLeft"))+e;0<e?(g&&g.css({marginLeft:0}),l&&l.css({marginLeft:0})):0<m-n-e?0>=m-n&&(g&&g.css("marginLeft",m-n),l&&l.css("marginLeft",m-n)):(g&&g.css("marginLeft",e),l&&l.css("marginLeft",e))}}}})(jQuery);
(function(h){var b=h.paramquery.pqGrid.prototype.options,r={on:!0,header:!1},k={on:!0,compare:"byVal",select:!0,validate:!0,allowInvalid:!0,type:"replace"};b.pasteModel=b.pasteModel||k;b.copyModel=b.copyModel||r;var n=function(b,e){this.that=b;this.$ae=e;if(e.hasClass("pq-grid-row"))this.rowIndx=b.getRowIndx({$tr:e}).rowIndx,this.dataIndx=null;else if(e.hasClass("pq-grid-cell")){var a=b.getCellIndices({$td:e});this.rowIndx=a.rowIndx;this.dataIndx=a.dataIndx}else this.dataIndx=this.rowIndx=null},b=
n.prototype;b.createClipBoard=function(){var b=this.$ae,e=h("#pq-grid-excel-div"),e=h("#pq-grid-excel");0==e.length&&(e=h("<div id='pq-grid-excel-div'  style='position:fixed;top:20px;left:20px;height:1px;width:1px;overflow:hidden;'/>").appendTo(document.body),e=h("<textarea id='pq-grid-excel' autocomplete='off'  style='overflow:hidden;height:10000px;width:10000px;opacity:0' />").appendTo(e),e.css({opacity:0}));b.offset();h(window).scrollTop();h(window).scrollLeft();e.select()};b.destroyClipBoard=
function(){var b=this.that,e,a=b.iCells.getFocusSelection({old:!0});a?e=b.getCell({rowIndx:a.rowIndx,dataIndx:a.dataIndx}):(a=b.iRows.getFocusSelection({old:!0}))&&(e=b.getRow({rowIndx:a.rowIndx}));var a=h(window).scrollTop(),c=h(window).scrollLeft();e?e.attr("tabindex",0).focus():b.$cont.focus();b=h(window).scrollTop();e=h(window).scrollLeft();a==b&&c==e||window.scrollTo(c,a)};b.clearClipBoard=function(){h("#pq-grid-excel").val("")};b.copy=function(){var b=h("#pq-grid-excel"),e=this.that,a=e.colModel,
c=a.length,d=[],f=[];if(e.options.copyModel.on){for(var d=e.iRows.getSelection(),g=0,k=d.length;g<k;g++){for(var n=d[g],r=n.rowData,C=[],n=0;n<c;n++){var G=a[n];!1!==G.copy&&C.push(r[G.dataIndx])}var O=C.join("\t");f.push(O)}d=e.iCells.getSelection();a=e=r=null;C=[];g=0;for(k=d.length;g<k;g++)n=d[g],e=n.rowIndx,r=n.rowData,G=n.column,n=n.dataIndx,!1!==G.copy&&(null!=a&&e!=a?(O=C.join("\t"),C=[],f.push(O),a=e):null==a&&(a=e),C.push(r[n]));f.push(C.join("\t"));O=f.join("\n");h.measureTime(function(){b.val(O);
b.select()},"copy of text: set text.val and text.select")}};b.paste=function(){var b=this.that,e=h("#pq-grid-excel").val(),e=e.replace(/\n$/,""),a=e.split("\n"),c=a.length,d,f=b.colModel,g=b.options.pasteModel,k="row",n=f.length;if(g.on&&0!=e.length&&0!=c){e={rows:a};if(!1===b._trigger("beforePaste",null,e))return!1;var e=g.type,r,C,G,O,w=b.iRows.getSelectionCurPage();w&&w.length||(k="cell",w=b.iCells.getSelectionCurPage());w&&w.length?(r=w[0].rowIndx,G=w[w.length-1].rowIndx,"cell"==k&&(C=b.getColIndx({dataIndx:w[0].dataIndx}),
O=b.getColIndx({dataIndx:w[w.length-1].dataIndx}))):O=C=G=r=0;var z,t;"replace"==e?(z=r,t=G-r+1<c?"extend":"repeat"):"append"==e?(z=G+1,t="extend"):"prepend"==e&&(z=r,t="extend");var u,c="extend"==t?c:G-r+1,x;r=0;G=[];for(var y=0,w=0;w<c;w++){var D=a[r],v=w+z,B="replace"==e?b.getRowData({rowIndx:v}):null,F=B?{}:null,I={};void 0===D&&"repeat"===t&&(r=0,D=a[r]);r++;D=D.split("\t");if(!x)if("cell"==k){d=D.length;u=O-C+1<D.length?"extend":"repeat";x="extend"==u?d:O-C+1;if(isNaN(x))throw"lenH NaN. assert failed.";
x+C>n&&(x=n-C)}else x=n,C=0;var E=0,H=0,K=0;d=x;for(H=0;H<d;H++){var J=f[H+C],N=D[E],M=J.dataIndx;J.hidden?"extend"==u&&d+C<n&&d++:(void 0===N&&"repeat"===u&&(E=0,N=D[E]),E++,I[M]=N,F&&(F[M]=B[M]))}!1==h.isEmptyObject(I)&&(D="update",null==B&&(D="add"),G.push({newRow:I,rowIndx:v,rowData:B,oldRow:F,type:D}),y++)}e={rowList:G,source:"paste",allowInvalid:g.allowInvalid,validate:g.validate};b._digestData(e);h.measureTime(function(){g.select&&("cell"==k?b.iCells.selectBlock({initRowIndx:z,finalRowIndx:z+
y-1,initColIndx:C,finalColIndx:"extend"==u?C+x-1+K:O}):b.iRows.selectRange({initRowIndx:z,finalRowIndx:z+y-1}))},"selection in paste");b.refreshView();e={rows:a};b._trigger("paste",null,e)}};var e=null,g=!1;h(document).unbind(".pqExcel").bind("keydown.pqExcel",function(b){if(b.ctrlKey){var k=h(b.target);if(k.hasClass("pq-grid-row")||k.hasClass("pq-grid-cell")||k.is("#pq-grid-excel")||k.is("div.pq-cont")){var a=k.closest(".pq-grid");if(e||k.length&&a.length){if(!e){try{var c=a.pqGrid("getInstance").grid}catch(d){return!0}e=
new n(c,k);e.createClipBoard()}"67"==b.keyCode||"99"==b.keyCode?e.copy():"86"==b.keyCode||"118"==b.keyCode?(g=!0,h.measureTime(function(){e.clearClipBoard()},"clearClipBoard"),window.setTimeout(function(){h.measureTime(function(){e&&(e.paste(),e.destroyClipBoard(),e=null);g=!1},"iExcel.paste")},0)):(k=h("#pq-grid-excel"),k.length&&document.activeElement==k[0]&&e.that._onKeyPressDown(b))}}}}).bind("keyup.pqExcel",function(b){g||!e||b.ctrlKey||17!=b.keyCode||(e.destroyClipBoard(),e=null)})})(jQuery);
(function(h){var b=h.paramquery.pqGrid.prototype.options,r={on:!0,checkEditable:!0,checkEditableAdd:!1,allowInvalid:!0};b.historyModel=b.historyModel||r;b=(h.paramquery.cHistory=function(b){var h=this;this.that=b;this.options=b.options;this.records=[];this.id=this.counter=0;var e=b.eventNamespace,g=b.widgetEventPrefix.toLowerCase();b.element.on(g+"keydown"+e,function(b,e){if(h.belongs(b))return h._onKeyDown(b,e)});b.element.on(g+"dataavailable"+e,function(b,e){h.belongs(b)&&h.reset()})}).prototype=
new h.paramquery.cClass;b._onKeyDown=function(b,h){if(b.ctrlKey&&"90"==b.keyCode)return this.undo(),!1;if(b.ctrlKey&&"89"==b.keyCode)return this.redo(),!1};b.resetUndo=function(){if(0==this.counter)return!1;this.counter=0;this.that._trigger("history",null,{type:"resetUndo",num_undo:0,num_redo:this.records.length-this.counter,canUndo:!1,canRedo:!0})};b.reset=function(){if(0==this.counter&&0==this.records.length)return!1;this.records=[];this.id=this.counter=0;this.that._trigger("history",null,{num_undo:0,
num_redo:0,type:"reset",canUndo:!1,canRedo:!1})};b.increment=function(){var b=this.records,h=b.length;this.id=h?b[h-1].id+1:0};b.push=function(b){var n=this.canRedo(),e=this.records,g=this.counter;e.length>g&&e.splice(g,e.length-g);e[g]=h.extend({id:this.id},b);this.counter++;b=this.that;var l,m;1==this.counter&&(l=!0);n&&this.counter==e.length&&(m=!1);b._trigger("history",null,{type:"add",canUndo:l,canRedo:m,num_undo:this.counter,num_redo:0})};b.canUndo=function(){return 0<this.counter?!0:!1};b.canRedo=
function(){return this.counter<this.records.length?!0:!1};b.undo=function(){var b=this.canRedo(),h=this.that,e=this.options.historyModel,g=this.records;if(0<this.counter)this.counter--;else return!1;for(var g=g[this.counter].rowList,l=[],m=0,a=g.length;m<a;m++){var c=g[m],d=c.newRow,f=c.rowData,p=c.type,r=c.oldRow,c=c.rowIndx;"update"==p?(c=h.getRowIndx({rowData:f}).rowIndx,l.push({type:p,rowIndx:c,rowData:f,oldRow:d,newRow:r})):"add"==p?l.push({type:"delete",rowData:d}):"delete"==p&&l.push({type:"add",
rowIndx:c,newRow:f})}h._digestData({history:!1,source:"undo",checkEditable:e.checkEditable,checkEditableAdd:e.checkEditableAdd,allowInvalid:e.allowInvalid,rowList:l});h.refreshView();var q,A;!1===b&&(q=!0);0==this.counter&&(A=!1);h._trigger("history",null,{canUndo:A,canRedo:q,type:"undo",num_undo:this.counter,num_redo:this.records.length-this.counter});return!0};b.redo=function(){var b=this.canUndo(),h=this.that,e=this.options.historyModel,g=this.counter,l=this.records;if(g==l.length)return!1;for(var g=
l[g].rowList,m=[],a=0,c=g.length;a<c;a++){var d=g[a],f=d.newRow,p=d.rowData,r=d.type,q=d.oldRow,d=d.rowIndx;"update"==r?(d=h.getRowIndx({rowData:p}).rowIndx,m.push({type:r,rowIndx:d,rowData:p,oldRow:q,newRow:f})):"add"==r?m.push({type:"add",rowIndx:d,newRow:f}):"delete"==r&&m.push({type:"delete",rowData:p})}h._digestData({history:!1,source:"redo",checkEditable:e.checkEditable,checkEditableAdd:e.checkEditableAdd,allowInvalid:e.allowInvalid,rowList:m});h.refreshView();this.counter<l.length&&this.counter++;
var A,C;!1==b&&(A=!0);this.counter==this.records.length&&(C=!1);h._trigger("history",null,{canUndo:A,canRedo:C,type:"redo",num_undo:this.counter,num_redo:this.records.length-this.counter});return!0};h.paramquery.pqGrid.prototype.history=function(b){return this.iHistory[b.method](b)}})(jQuery);
(function(h){var b=h.ui.autocomplete.prototype,r=b._renderMenu,k=b._renderItem;b._renderMenu=function(b,e){r.call(this,b,e);var g=this.options.selectItem;if(g&&g.on){var g=g.cls,g=void 0===g?"ui-state-highlight":g,k=this.element.val();k&&g&&h("a",b).filter(function(){return h(this).text()===k}).addClass(g)}};b._renderItem=function(b,e){var g=k.call(this,b,e),h=this.options.highlightText;if(h&&h.on){var m=this.element.val();if(m){var m=new RegExp("("+m+")","i"),a=e.label;if(m.test(a)){var c=h.style,
h=h.cls,a=a.replace(m,"<span style='"+(void 0===c?"font-weight:bold;":c)+"' class='"+(void 0===h?"":h)+"'>$1</span>");g.find("a").html(a)}}}return g}})(jQuery);
